(()=>{var js=Object.defineProperty;var ne=(s=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(s,{get:(e,t)=>(typeof require!="undefined"?require:e)[t]}):s)(function(s){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+s+'" is not supported')});var fe=(s,e)=>{for(var t in e)js(s,t,{get:e[t],enumerable:!0})};var Ls=Object.create,ut=Object.defineProperty,Is=Object.getOwnPropertyDescriptor,ht=Object.getOwnPropertyNames,Bs=Object.getPrototypeOf,Ms=Object.prototype.hasOwnProperty,de=(s=>typeof ne<"u"?ne:typeof Proxy<"u"?new Proxy(s,{get:(e,t)=>(typeof ne<"u"?ne:e)[t]}):s)(function(s){if(typeof ne<"u")return ne.apply(this,arguments);throw new Error('Dynamic require of "'+s+'" is not supported')}),He=(s,e)=>function(){return s&&(e=(0,s[ht(s)[0]])(s=0)),e},Fs=(s,e)=>function(){return e||(0,s[ht(s)[0]])((e={exports:{}}).exports,e),e.exports},Ds=(s,e)=>{for(var t in e)ut(s,t,{get:e[t],enumerable:!0})},Rs=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ht(e))!Ms.call(s,i)&&i!==t&&ut(s,i,{get:()=>e[i],enumerable:!(r=Is(e,i))||r.enumerable});return s},Vs=(s,e,t)=>(t=s!=null?Ls(Bs(s)):{},Rs(e||!s||!s.__esModule?ut(t,"default",{value:s,enumerable:!0}):t,s)),Lt,It,et,Js,qs,ue,Le,Bt,Mt,Ft,se,Ht,Us,Gt,pt=He({"ble/node_modules/@capacitor/core/dist/index.js"(){Lt=s=>{let e=new Map;e.set("web",{name:"web"});let t=s.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:e},r=(n,l)=>{t.platforms.set(n,l)},i=n=>{t.platforms.has(n)&&(t.currentPlatform=t.platforms.get(n))};return t.addPlatform=r,t.setPlatform=i,t},It=s=>s.CapacitorPlatforms=Lt(s),et=It(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Js=et.addPlatform,qs=et.setPlatform,function(s){s.Unimplemented="UNIMPLEMENTED",s.Unavailable="UNAVAILABLE"}(ue||(ue={})),Le=class extends Error{constructor(s,e,t){super(s),this.message=s,this.code=e,this.data=t}},Bt=s=>{var e,t;return s?.androidBridge?"android":!((t=(e=s?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},Mt=s=>{var e,t,r,i,n;let l=s.CapacitorCustomPlatform||null,a=s.Capacitor||{},f=a.Plugins=a.Plugins||{},u=s.CapacitorPlatforms,h=()=>l!==null?l.name:Bt(s),_=((e=u?.currentPlatform)===null||e===void 0?void 0:e.getPlatform)||h,b=()=>_()!=="web",m=((t=u?.currentPlatform)===null||t===void 0?void 0:t.isNativePlatform)||b,x=k=>{let S=y.get(k);return!!(S?.platforms.has(_())||d(k))},o=((r=u?.currentPlatform)===null||r===void 0?void 0:r.isPluginAvailable)||x,c=k=>{var S;return(S=a.PluginHeaders)===null||S===void 0?void 0:S.find(C=>C.name===k)},d=((i=u?.currentPlatform)===null||i===void 0?void 0:i.getPluginHeader)||c,p=k=>s.console.error(k),g=(k,S,C)=>Promise.reject(`${C} does not have an implementation of "${S}".`),y=new Map,v=(k,S={})=>{let C=y.get(k);if(C)return console.warn(`Capacitor plugin "${k}" already registered. Cannot register plugins twice.`),C.proxy;let A=_(),N=d(k),T,j=async()=>(!T&&A in S?T=typeof S[A]=="function"?T=await S[A]():T=S[A]:l!==null&&!T&&"web"in S&&(T=typeof S.web=="function"?T=await S.web():T=S.web),T),ce=(L,D)=>{var q,Y;if(N){let X=N?.methods.find(V=>D===V.name);if(X)return X.rtype==="promise"?V=>a.nativePromise(k,D.toString(),V):(V,Pe)=>a.nativeCallback(k,D.toString(),V,Pe);if(L)return(q=L[D])===null||q===void 0?void 0:q.bind(L)}else{if(L)return(Y=L[D])===null||Y===void 0?void 0:Y.bind(L);throw new Le(`"${k}" plugin is not implemented on ${A}`,ue.Unimplemented)}},z=L=>{let D,q=(...Y)=>{let X=j().then(V=>{let Pe=ce(V,L);if(Pe){let je=Pe(...Y);return D=je?.remove,je}else throw new Le(`"${k}.${L}()" is not implemented on ${A}`,ue.Unimplemented)});return L==="addListener"&&(X.remove=async()=>D()),X};return q.toString=()=>`${L.toString()}() { [capacitor code] }`,Object.defineProperty(q,"name",{value:L,writable:!1,configurable:!1}),q},ie=z("addListener"),jt=z("removeListener"),Ps=(L,D)=>{let q=ie({eventName:L},D),Y=async()=>{let V=await q;jt({eventName:L,callbackId:V},D)},X=new Promise(V=>q.then(()=>V({remove:Y})));return X.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await Y()},X},Qe=new Proxy({},{get(L,D){switch(D){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return N?Ps:ie;case"removeListener":return jt;default:return z(D)}}});return f[k]=Qe,y.set(k,{name:k,proxy:Qe,platforms:new Set([...Object.keys(S),...N?[A]:[]])}),Qe},w=((n=u?.currentPlatform)===null||n===void 0?void 0:n.registerPlugin)||v;return a.convertFileSrc||(a.convertFileSrc=k=>k),a.getPlatform=_,a.handleError=p,a.isNativePlatform=m,a.isPluginAvailable=o,a.pluginMethodNoop=g,a.registerPlugin=w,a.Exception=Le,a.DEBUG=!!a.DEBUG,a.isLoggingEnabled=!!a.isLoggingEnabled,a.platform=a.getPlatform(),a.isNative=a.isNativePlatform(),a},Ft=s=>s.Capacitor=Mt(s),se=Ft(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ht=se.registerPlugin,Us=se.Plugins,Gt=class{constructor(s){this.listeners={},this.windowListeners={},s&&(console.warn(`Capacitor WebPlugin "${s.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=s)}addListener(s,e){this.listeners[s]||(this.listeners[s]=[]),this.listeners[s].push(e);let r=this.windowListeners[s];r&&!r.registered&&this.addWindowListener(r);let i=async()=>this.removeListener(s,e),n=Promise.resolve({remove:i});return Object.defineProperty(n,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await i()}}),n}async removeAllListeners(){this.listeners={};for(let s in this.windowListeners)this.removeWindowListener(this.windowListeners[s]);this.windowListeners={}}notifyListeners(s,e){let t=this.listeners[s];t&&t.forEach(r=>r(e))}hasListeners(s){return!!this.listeners[s].length}registerWindowListener(s,e){this.windowListeners[e]={registered:!1,windowEventName:s,pluginEventName:e,handler:t=>{this.notifyListeners(e,t)}}}unimplemented(s="not implemented"){return new se.Exception(s,ue.Unimplemented)}unavailable(s="not available"){return new se.Exception(s,ue.Unavailable)}async removeListener(s,e){let t=this.listeners[s];if(!t)return;let r=t.indexOf(e);this.listeners[s].splice(r,1),this.listeners[s].length||this.removeWindowListener(this.windowListeners[s])}addWindowListener(s){window.addEventListener(s.windowEventName,s.handler),s.registered=!0}removeWindowListener(s){!s||(window.removeEventListener(s.windowEventName,s.handler),s.registered=!1)}}}});function Ws(s){return new DataView(Uint8Array.from(s).buffer)}function Hs(s){return Array.from(new Uint8Array(s.buffer))}function Gs(s){return`0000${s.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`}function Fe(s){let e=s.trim().split(" ").filter(t=>t!=="").map(t=>parseInt(t,16));return Ws(e)}function tt(s){return Hs(s).map(e=>{let t=e.toString(16);return t.length==1&&(t="0"+t),t}).join(" ")}function zs(s){if(typeof s=="string")return s;if(typeof s=="number")return Gs(s);throw new Error("Invalid UUID")}function Dt(s){let e={};if(!!s)return s.forEach((t,r)=>{e[r.toString()]=t}),e}var gt=He({"ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js"(){}});async function Ys(s,e,t){let r;return Promise.race([s,new Promise((i,n)=>{r=setTimeout(()=>n(t),e)})]).finally(()=>clearTimeout(r))}var Xs=He({"ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/timeout.js"(){}}),zt={};Ds(zt,{BluetoothLeWeb:()=>Yt});var Yt,$s=He({"ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/web.js"(){pt(),gt(),Xs(),Yt=class extends Gt{constructor(){super(...arguments),this.deviceMap=new Map,this.discoveredDevices=new Map,this.scan=null,this.DEFAULT_CONNECTION_TIMEOUT=1e4,this.onAdvertisementReceivedCallback=this.onAdvertisementReceived.bind(this),this.onDisconnectedCallback=this.onDisconnected.bind(this),this.onCharacteristicValueChangedCallback=this.onCharacteristicValueChanged.bind(this)}async initialize(){if(typeof navigator>"u"||!navigator.bluetooth)throw this.unavailable("Web Bluetooth API not available in this browser.");if(!await navigator.bluetooth.getAvailability())throw this.unavailable("No Bluetooth radio available.")}async isEnabled(){return{value:!0}}async enable(){throw this.unavailable("enable is not available on web.")}async disable(){throw this.unavailable("disable is not available on web.")}async startEnabledNotifications(){}async stopEnabledNotifications(){}async isLocationEnabled(){throw this.unavailable("isLocationEnabled is not available on web.")}async openLocationSettings(){throw this.unavailable("openLocationSettings is not available on web.")}async openBluetoothSettings(){throw this.unavailable("openBluetoothSettings is not available on web.")}async openAppSettings(){throw this.unavailable("openAppSettings is not available on web.")}async setDisplayStrings(){}async requestDevice(s){let e=this.getFilters(s),t=await navigator.bluetooth.requestDevice({filters:e.length?e:void 0,optionalServices:s?.optionalServices,acceptAllDevices:e.length===0});return this.deviceMap.set(t.id,t),this.getBleDevice(t)}async requestLEScan(s){this.requestBleDeviceOptions=s;let e=this.getFilters(s);await this.stopLEScan(),this.discoveredDevices=new Map,navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),this.scan=await navigator.bluetooth.requestLEScan({filters:e.length?e:void 0,acceptAllAdvertisements:e.length===0,keepRepeatedDevices:s?.allowDuplicates})}onAdvertisementReceived(s){var e,t;let r=s.device.id;if(this.deviceMap.set(r,s.device),!this.discoveredDevices.has(r)||((e=this.requestBleDeviceOptions)===null||e===void 0?void 0:e.allowDuplicates)){this.discoveredDevices.set(r,!0);let n=this.getBleDevice(s.device),l={device:n,localName:n.name,rssi:s.rssi,txPower:s.txPower,manufacturerData:Dt(s.manufacturerData),serviceData:Dt(s.serviceData),uuids:(t=s.uuids)===null||t===void 0?void 0:t.map(zs)};this.notifyListeners("onScanResult",l)}}async stopLEScan(){var s;!((s=this.scan)===null||s===void 0)&&s.active&&this.scan.stop(),this.scan=null}async getDevices(s){return{devices:(await navigator.bluetooth.getDevices()).map(r=>(this.deviceMap.set(r.id,r),this.getBleDevice(r)))}}async getConnectedDevices(s){return{devices:(await navigator.bluetooth.getDevices()).filter(r=>{var i;return(i=r.gatt)===null||i===void 0?void 0:i.connected}).map(r=>(this.deviceMap.set(r.id,r),this.getBleDevice(r)))}}async connect(s){var e,t;let r=this.getDeviceFromMap(s.deviceId);r.removeEventListener("gattserverdisconnected",this.onDisconnectedCallback),r.addEventListener("gattserverdisconnected",this.onDisconnectedCallback);let i=Symbol();if(r.gatt===void 0)throw new Error("No gatt server available.");try{let n=(e=s.timeout)!==null&&e!==void 0?e:this.DEFAULT_CONNECTION_TIMEOUT;await Ys(r.gatt.connect(),n,i)}catch(n){throw await((t=r.gatt)===null||t===void 0?void 0:t.disconnect()),n===i?new Error("Connection timeout"):n}}onDisconnected(s){let t=`disconnected|${s.target.id}`;this.notifyListeners(t,null)}async createBond(s){throw this.unavailable("createBond is not available on web.")}async isBonded(s){throw this.unavailable("isBonded is not available on web.")}async disconnect(s){var e;(e=this.getDeviceFromMap(s.deviceId).gatt)===null||e===void 0||e.disconnect()}async getServices(s){var e,t;let r=(t=await((e=this.getDeviceFromMap(s.deviceId).gatt)===null||e===void 0?void 0:e.getPrimaryServices()))!==null&&t!==void 0?t:[],i=[];for(let n of r){let l=await n.getCharacteristics(),a=[];for(let f of l)a.push({uuid:f.uuid,properties:this.getProperties(f),descriptors:await this.getDescriptors(f)});i.push({uuid:n.uuid,characteristics:a})}return{services:i}}async getDescriptors(s){try{return(await s.getDescriptors()).map(t=>({uuid:t.uuid}))}catch{return[]}}getProperties(s){return{broadcast:s.properties.broadcast,read:s.properties.read,writeWithoutResponse:s.properties.writeWithoutResponse,write:s.properties.write,notify:s.properties.notify,indicate:s.properties.indicate,authenticatedSignedWrites:s.properties.authenticatedSignedWrites,reliableWrite:s.properties.reliableWrite,writableAuxiliaries:s.properties.writableAuxiliaries}}async getCharacteristic(s){var e;let t=await((e=this.getDeviceFromMap(s.deviceId).gatt)===null||e===void 0?void 0:e.getPrimaryService(s?.service));return t?.getCharacteristic(s?.characteristic)}async getDescriptor(s){let e=await this.getCharacteristic(s);return e?.getDescriptor(s?.descriptor)}async readRssi(s){throw this.unavailable("readRssi is not available on web.")}async read(s){let e=await this.getCharacteristic(s);return{value:await e?.readValue()}}async write(s){let e=await this.getCharacteristic(s),t;typeof s.value=="string"?t=Fe(s.value):t=s.value,await e?.writeValueWithResponse(t)}async writeWithoutResponse(s){let e=await this.getCharacteristic(s),t;typeof s.value=="string"?t=Fe(s.value):t=s.value,await e?.writeValueWithoutResponse(t)}async readDescriptor(s){let e=await this.getDescriptor(s);return{value:await e?.readValue()}}async writeDescriptor(s){let e=await this.getDescriptor(s),t;typeof s.value=="string"?t=Fe(s.value):t=s.value,await e?.writeValue(t)}async startNotifications(s){let e=await this.getCharacteristic(s);e?.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),e?.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),await e?.startNotifications()}onCharacteristicValueChanged(s){var e,t;let r=s.target,i=`notification|${(e=r.service)===null||e===void 0?void 0:e.device.id}|${(t=r.service)===null||t===void 0?void 0:t.uuid}|${r.uuid}`;this.notifyListeners(i,{value:r.value})}async stopNotifications(s){let e=await this.getCharacteristic(s);await e?.stopNotifications()}getFilters(s){var e;let t=[];for(let r of(e=s?.services)!==null&&e!==void 0?e:[])t.push({services:[r],name:s?.name,namePrefix:s?.namePrefix});return(s?.name||s?.namePrefix)&&t.length===0&&t.push({name:s.name,namePrefix:s.namePrefix}),t}getDeviceFromMap(s){let e=this.deviceMap.get(s);if(e===void 0)throw new Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.');return e}getBleDevice(s){var e;return{deviceId:s.id,name:(e=s.name)!==null&&e!==void 0?e:void 0}}}}}),Ks=Fs({"ble/node_modules/throat/index.js"(s,e){"use strict";function t(f){var u=new a,h=f|0;function _(c,d,p){return(h|0)!==0?(h=(h|0)-1,new Promise(function(g){g(c.apply(d,p))}).then(m,x)):new Promise(function(g){u.push(new n(g,c,d,p))}).then(b)}function b(c){try{return Promise.resolve(c.fn.apply(c.self,c.args)).then(m,x)}catch(d){x(d)}}function m(c){return o(),c}function x(c){throw o(),c}function o(){var c=u.shift();c?c.resolve(c):h=(h|0)+1}return _}function r(f,u){let h=t(f|0);return function(){for(var _=new Array(arguments.length),b=0;b<arguments.length;b++)_[b]=arguments[b];return h(u,this,_)}}function i(f){let u=t(f|0);return function(h){if(typeof h!="function")throw new TypeError("Expected throat fn to be a function but got "+typeof h);for(var _=new Array(arguments.length-1),b=1;b<arguments.length;b++)_[b-1]=arguments[b];return u(h,this,_)}}e.exports=function(u,h){if(typeof u=="function"){var _=h;h=u,u=_}if(typeof u!="number")throw new TypeError("Expected throat size to be a number but got "+typeof u);if(h!==void 0&&typeof h!="function")throw new TypeError("Expected throat fn to be a function but got "+typeof h);return typeof h=="function"?r(u|0,h):i(u|0)},e.exports.default=e.exports;function n(f,u,h,_){this.resolve=f,this.fn=u,this.self=h||null,this.args=_}var l=64;function a(){this._s1=[],this._s2=[],this._shiftBlock=this._pushBlock=new Array(l),this._pushIndex=0,this._shiftIndex=0}a.prototype.push=function(f){this._pushIndex===l&&(this._pushIndex=0,this._s1[this._s1.length]=this._pushBlock=new Array(l)),this._pushBlock[this._pushIndex++]=f},a.prototype.shift=function(){if(this._shiftIndex===l){this._shiftIndex=0;var f=this._s2;if(f.length===0){var u=this._s1;if(u.length===0)return;this._s1=f,f=this._s2=u.reverse()}this._shiftBlock=f.pop()}if(!(this._pushBlock===this._shiftBlock&&this._pushIndex===this._shiftIndex)){var h=this._shiftBlock[this._shiftIndex];return this._shiftBlock[this._shiftIndex++]=null,h}}}}),Zs=Object.create,Xt=Object.defineProperty,Qs=Object.getOwnPropertyDescriptor,$t=Object.getOwnPropertyNames,er=Object.getPrototypeOf,tr=Object.prototype.hasOwnProperty,sr=(s=>typeof de<"u"?de:typeof Proxy<"u"?new Proxy(s,{get:(e,t)=>(typeof de<"u"?de:e)[t]}):s)(function(s){if(typeof de<"u")return de.apply(this,arguments);throw new Error('Dynamic require of "'+s+'" is not supported')}),Kt=(s,e)=>function(){return e||(0,s[$t(s)[0]])((e={exports:{}}).exports,e),e.exports},rr=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of $t(e))!tr.call(s,i)&&i!==t&&Xt(s,i,{get:()=>e[i],enumerable:!(r=Qs(e,i))||r.enumerable});return s},Zt=(s,e,t)=>(t=s!=null?Zs(er(s)):{},rr(e||!s||!s.__esModule?Xt(t,"default",{value:s,enumerable:!0}):t,s)),ir=Kt({"services/e2ee/sjcl.js"(s,e){"use strict";var t={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(o){this.toString=function(){return"CORRUPT: "+this.message},this.message=o},invalid:function(o){this.toString=function(){return"INVALID: "+this.message},this.message=o},bug:function(o){this.toString=function(){return"BUG: "+this.message},this.message=o},notReady:function(o){this.toString=function(){return"NOT READY: "+this.message},this.message=o}}};t.cipher.aes=function(o){this.s[0][0][0]||this.O();var c,d,p,g,y=this.s[0][4],v=this.s[1];c=o.length;var w=1;if(c!==4&&c!==6&&c!==8)throw new t.exception.invalid("invalid aes key size");for(this.b=[p=o.slice(0),g=[]],o=c;o<4*c+28;o++)d=p[o-1],(o%c===0||c===8&&o%c===4)&&(d=y[d>>>24]<<24^y[d>>16&255]<<16^y[d>>8&255]<<8^y[d&255],o%c===0&&(d=d<<8^d>>>24^w<<24,w=w<<1^283*(w>>7))),p[o]=p[o-c]^d;for(c=0;o;c++,o--)d=p[c&3?o:o-4],g[c]=4>=o||4>c?d:v[0][y[d>>>24]]^v[1][y[d>>16&255]]^v[2][y[d>>8&255]]^v[3][y[d&255]]},t.cipher.aes.prototype={encrypt:function(o){return r(this,o,0)},decrypt:function(o){return r(this,o,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var o=this.s[0],c=this.s[1],d=o[4],p=c[4],g,y,v,w=[],k=[],S,C,A,N;for(g=0;256>g;g++)k[(w[g]=g<<1^283*(g>>7))^g]=g;for(y=v=0;!d[y];y^=S||1,v=k[v]||1)for(A=v^v<<1^v<<2^v<<3^v<<4,A=A>>8^A&255^99,d[y]=A,p[A]=y,C=w[g=w[S=w[y]]],N=16843009*C^65537*g^257*S^16843008*y,C=257*w[A]^16843008*A,g=0;4>g;g++)o[g][y]=C=C<<24^C>>>8,c[g][A]=N=N<<24^N>>>8;for(g=0;5>g;g++)o[g]=o[g].slice(0),c[g]=c[g].slice(0)}};function r(o,c,d){if(c.length!==4)throw new t.exception.invalid("invalid aes block size");var p=o.b[d],g=c[0]^p[0],y=c[d?3:1]^p[1],v=c[2]^p[2];c=c[d?1:3]^p[3];var w,k,S,C=p.length/4-2,A,N=4,T=[0,0,0,0];w=o.s[d],o=w[0];var j=w[1],ce=w[2],z=w[3],ie=w[4];for(A=0;A<C;A++)w=o[g>>>24]^j[y>>16&255]^ce[v>>8&255]^z[c&255]^p[N],k=o[y>>>24]^j[v>>16&255]^ce[c>>8&255]^z[g&255]^p[N+1],S=o[v>>>24]^j[c>>16&255]^ce[g>>8&255]^z[y&255]^p[N+2],c=o[c>>>24]^j[g>>16&255]^ce[y>>8&255]^z[v&255]^p[N+3],N+=4,g=w,y=k,v=S;for(A=0;4>A;A++)T[d?3&-A:A]=ie[g>>>24]<<24^ie[y>>16&255]<<16^ie[v>>8&255]<<8^ie[c&255]^p[N++],w=g,g=y,y=v,v=c,c=w;return T}t.bitArray={bitSlice:function(o,c,d){return o=t.bitArray.$(o.slice(c/32),32-(c&31)).slice(1),d===void 0?o:t.bitArray.clamp(o,d-c)},extract:function(o,c,d){var p=Math.floor(-c-d&31);return((c+d-1^c)&-32?o[c/32|0]<<32-p^o[c/32+1|0]>>>p:o[c/32|0]>>>p)&(1<<d)-1},concat:function(o,c){if(o.length===0||c.length===0)return o.concat(c);var d=o[o.length-1],p=t.bitArray.getPartial(d);return p===32?o.concat(c):t.bitArray.$(c,p,d|0,o.slice(0,o.length-1))},bitLength:function(o){var c=o.length;return c===0?0:32*(c-1)+t.bitArray.getPartial(o[c-1])},clamp:function(o,c){if(32*o.length<c)return o;o=o.slice(0,Math.ceil(c/32));var d=o.length;return c=c&31,0<d&&c&&(o[d-1]=t.bitArray.partial(c,o[d-1]&2147483648>>c-1,1)),o},partial:function(o,c,d){return o===32?c:(d?c|0:c<<32-o)+1099511627776*o},getPartial:function(o){return Math.round(o/1099511627776)||32},equal:function(o,c){if(t.bitArray.bitLength(o)!==t.bitArray.bitLength(c))return!1;var d=0,p;for(p=0;p<o.length;p++)d|=o[p]^c[p];return d===0},$:function(o,c,d,p){var g;for(g=0,p===void 0&&(p=[]);32<=c;c-=32)p.push(d),d=0;if(c===0)return p.concat(o);for(g=0;g<o.length;g++)p.push(d|o[g]>>>c),d=o[g]<<32-c;return g=o.length?o[o.length-1]:0,o=t.bitArray.getPartial(g),p.push(t.bitArray.partial(c+o&31,32<c+o?d:p.pop(),1)),p},i:function(o,c){return[o[0]^c[0],o[1]^c[1],o[2]^c[2],o[3]^c[3]]},byteswapM:function(o){var c,d;for(c=0;c<o.length;++c)d=o[c],o[c]=d>>>24|d>>>8&65280|(d&65280)<<8|d<<24;return o}},t.codec.utf8String={fromBits:function(o){var c="",d=t.bitArray.bitLength(o),p,g;for(p=0;p<d/8;p++)(p&3)===0&&(g=o[p/4]),c+=String.fromCharCode(g>>>8>>>8>>>8),g<<=8;return decodeURIComponent(escape(c))},toBits:function(o){o=unescape(encodeURIComponent(o));var c=[],d,p=0;for(d=0;d<o.length;d++)p=p<<8|o.charCodeAt(d),(d&3)===3&&(c.push(p),p=0);return d&3&&c.push(t.bitArray.partial(8*(d&3),p)),c}},t.codec.hex={fromBits:function(o){var c="",d;for(d=0;d<o.length;d++)c+=((o[d]|0)+0xf00000000000).toString(16).substr(4);return c.substr(0,t.bitArray.bitLength(o)/4)},toBits:function(o){var c,d=[],p;for(o=o.replace(/\s|0x/g,""),p=o.length,o=o+"00000000",c=0;c<o.length;c+=8)d.push(parseInt(o.substr(c,8),16)^0);return t.bitArray.clamp(d,4*p)}},t.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(o,c,d){var p=t.codec.base32.BASE,g=t.codec.base32.REMAINING,y="",v=0,w=t.codec.base32.B,k=0,S=t.bitArray.bitLength(o);for(d&&(w=t.codec.base32.X),d=0;y.length*p<S;)y+=w.charAt((k^o[d]>>>v)>>>g),v<p?(k=o[d]<<p-v,v+=g,d++):(k<<=p,v-=p);for(;y.length&7&&!c;)y+="=";return y},toBits:function(o,c){o=o.replace(/\s|=/g,"").toUpperCase();var d=t.codec.base32.BITS,p=t.codec.base32.BASE,g=t.codec.base32.REMAINING,y=[],v,w=0,k=t.codec.base32.B,S=0,C,A="base32";for(c&&(k=t.codec.base32.X,A="base32hex"),v=0;v<o.length;v++){if(C=k.indexOf(o.charAt(v)),0>C){if(!c)try{return t.codec.base32hex.toBits(o)}catch{}throw new t.exception.invalid("this isn't "+A+"!")}w>g?(w-=g,y.push(S^C>>>w),S=C<<d-w):(w+=p,S^=C<<d-w)}return w&56&&y.push(t.bitArray.partial(w&56,S,1)),y}},t.codec.base32hex={fromBits:function(o,c){return t.codec.base32.fromBits(o,c,1)},toBits:function(o){return t.codec.base32.toBits(o,1)}},t.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(o,c,d){var p="",g=0,y=t.codec.base64.B,v=0,w=t.bitArray.bitLength(o);for(d&&(y=y.substr(0,62)+"-_"),d=0;6*p.length<w;)p+=y.charAt((v^o[d]>>>g)>>>26),6>g?(v=o[d]<<6-g,g+=26,d++):(v<<=6,g-=6);for(;p.length&3&&!c;)p+="=";return p},toBits:function(o,c){o=o.replace(/\s|=/g,"");var d=[],p,g=0,y=t.codec.base64.B,v=0,w;for(c&&(y=y.substr(0,62)+"-_"),p=0;p<o.length;p++){if(w=y.indexOf(o.charAt(p)),0>w)throw new t.exception.invalid("this isn't base64!");26<g?(g-=26,d.push(v^w>>>g),v=w<<32-g):(g+=6,v^=w<<32-g)}return g&56&&d.push(t.bitArray.partial(g&56,v,1)),d}},t.codec.base64url={fromBits:function(o){return t.codec.base64.fromBits(o,1,1)},toBits:function(o){return t.codec.base64.toBits(o,1)}},t.hash.sha256=function(o){this.b[0]||this.O(),o?(this.F=o.F.slice(0),this.A=o.A.slice(0),this.l=o.l):this.reset()},t.hash.sha256.hash=function(o){return new t.hash.sha256().update(o).finalize()},t.hash.sha256.prototype={blockSize:512,reset:function(){return this.F=this.Y.slice(0),this.A=[],this.l=0,this},update:function(o){typeof o=="string"&&(o=t.codec.utf8String.toBits(o));var c,d=this.A=t.bitArray.concat(this.A,o);if(c=this.l,o=this.l=c+t.bitArray.bitLength(o),9007199254740991<o)throw new t.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var p=new Uint32Array(d),g=0;for(c=512+c-(512+c&511);c<=o;c+=512)i(this,p.subarray(16*g,16*(g+1))),g+=1;d.splice(0,16*g)}else for(c=512+c-(512+c&511);c<=o;c+=512)i(this,d.splice(0,16));return this},finalize:function(){var o,d=this.A,c=this.F,d=t.bitArray.concat(d,[t.bitArray.partial(1,1)]);for(o=d.length+2;o&15;o++)d.push(0);for(d.push(Math.floor(this.l/4294967296)),d.push(this.l|0);d.length;)i(this,d.splice(0,16));return this.reset(),c},Y:[],b:[],O:function(){function o(y){return 4294967296*(y-Math.floor(y))|0}for(var c=0,d=2,p,g;64>c;d++){for(g=!0,p=2;p*p<=d;p++)if(d%p===0){g=!1;break}g&&(8>c&&(this.Y[c]=o(Math.pow(d,.5))),this.b[c]=o(Math.pow(d,1/3)),c++)}}};function i(o,c){var d,p,g,y=o.F,v=o.b,w=y[0],k=y[1],S=y[2],C=y[3],A=y[4],N=y[5],T=y[6],j=y[7];for(d=0;64>d;d++)16>d?p=c[d]:(p=c[d+1&15],g=c[d+14&15],p=c[d&15]=(p>>>7^p>>>18^p>>>3^p<<25^p<<14)+(g>>>17^g>>>19^g>>>10^g<<15^g<<13)+c[d&15]+c[d+9&15]|0),p=p+j+(A>>>6^A>>>11^A>>>25^A<<26^A<<21^A<<7)+(T^A&(N^T))+v[d],j=T,T=N,N=A,A=C+p|0,C=S,S=k,k=w,w=p+(k&S^C&(k^S))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;y[0]=y[0]+w|0,y[1]=y[1]+k|0,y[2]=y[2]+S|0,y[3]=y[3]+C|0,y[4]=y[4]+A|0,y[5]=y[5]+N|0,y[6]=y[6]+T|0,y[7]=y[7]+j|0}t.mode.ccm={name:"ccm",G:[],listenProgress:function(o){t.mode.ccm.G.push(o)},unListenProgress:function(o){o=t.mode.ccm.G.indexOf(o),-1<o&&t.mode.ccm.G.splice(o,1)},fa:function(o){var c=t.mode.ccm.G.slice(),d;for(d=0;d<c.length;d+=1)c[d](o)},encrypt:function(o,c,d,p,g){var y,v=c.slice(0),w=t.bitArray,k=w.bitLength(d)/8,S=w.bitLength(v)/8;if(g=g||64,p=p||[],7>k)throw new t.exception.invalid("ccm: iv must be at least 7 bytes");for(y=2;4>y&&S>>>8*y;y++);return y<15-k&&(y=15-k),d=w.clamp(d,8*(15-y)),c=t.mode.ccm.V(o,c,d,p,g,y),v=t.mode.ccm.C(o,v,d,c,g,y),w.concat(v.data,v.tag)},decrypt:function(o,c,d,p,g){g=g||64,p=p||[];var y=t.bitArray,v=y.bitLength(d)/8,S=y.bitLength(c),w=y.clamp(c,S-g),k=y.bitSlice(c,S-g),S=(S-g)/8;if(7>v)throw new t.exception.invalid("ccm: iv must be at least 7 bytes");for(c=2;4>c&&S>>>8*c;c++);if(c<15-v&&(c=15-v),d=y.clamp(d,8*(15-c)),w=t.mode.ccm.C(o,w,d,k,g,c),o=t.mode.ccm.V(o,w.data,d,p,g,c),!y.equal(w.tag,o))throw new t.exception.corrupt("ccm: tag doesn't match");return w.data},na:function(o,c,d,p,g,y){var v=[],w=t.bitArray,k=w.i;if(p=[w.partial(8,(c.length?64:0)|p-2<<2|y-1)],p=w.concat(p,d),p[3]|=g,p=o.encrypt(p),c.length)for(d=w.bitLength(c)/8,65279>=d?v=[w.partial(16,d)]:4294967295>=d&&(v=w.concat([w.partial(16,65534)],[d])),v=w.concat(v,c),c=0;c<v.length;c+=4)p=o.encrypt(k(p,v.slice(c,c+4).concat([0,0,0])));return p},V:function(o,c,d,p,g,y){var v=t.bitArray,w=v.i;if(g/=8,g%2||4>g||16<g)throw new t.exception.invalid("ccm: invalid tag length");if(4294967295<p.length||4294967295<c.length)throw new t.exception.bug("ccm: can't deal with 4GiB or more data");for(d=t.mode.ccm.na(o,p,d,g,v.bitLength(c)/8,y),p=0;p<c.length;p+=4)d=o.encrypt(w(d,c.slice(p,p+4).concat([0,0,0])));return v.clamp(d,8*g)},C:function(o,c,d,p,g,y){var v,w=t.bitArray;v=w.i;var k=c.length,S=w.bitLength(c),C=k/50,A=C;if(d=w.concat([w.partial(8,y-1)],d).concat([0,0,0]).slice(0,4),p=w.bitSlice(v(p,o.encrypt(d)),0,g),!k)return{tag:p,data:[]};for(v=0;v<k;v+=4)v>C&&(t.mode.ccm.fa(v/k),C+=A),d[3]++,g=o.encrypt(d),c[v]^=g[0],c[v+1]^=g[1],c[v+2]^=g[2],c[v+3]^=g[3];return{tag:p,data:w.clamp(c,S)}}},t.mode.ocb2={name:"ocb2",encrypt:function(o,c,d,p,g,y){if(t.bitArray.bitLength(d)!==128)throw new t.exception.invalid("ocb iv must be 128 bits");var v,w=t.mode.ocb2.S,k=t.bitArray,S=k.i,C=[0,0,0,0];d=w(o.encrypt(d));var A,N=[];for(p=p||[],g=g||64,v=0;v+4<c.length;v+=4)A=c.slice(v,v+4),C=S(C,A),N=N.concat(S(d,o.encrypt(S(d,A)))),d=w(d);return A=c.slice(v),c=k.bitLength(A),v=o.encrypt(S(d,[0,0,0,c])),A=k.clamp(S(A.concat([0,0,0]),v),c),C=S(C,S(A.concat([0,0,0]),v)),C=o.encrypt(S(C,S(d,w(d)))),p.length&&(C=S(C,y?p:t.mode.ocb2.pmac(o,p))),N.concat(k.concat(A,k.clamp(C,g)))},decrypt:function(o,c,d,p,g,y){if(t.bitArray.bitLength(d)!==128)throw new t.exception.invalid("ocb iv must be 128 bits");g=g||64;var v=t.mode.ocb2.S,w=t.bitArray,k=w.i,S=[0,0,0,0],C=v(o.encrypt(d)),A,N,T=t.bitArray.bitLength(c)-g,j=[];for(p=p||[],d=0;d+4<T/32;d+=4)A=k(C,o.decrypt(k(C,c.slice(d,d+4)))),S=k(S,A),j=j.concat(A),C=v(C);if(N=T-32*d,A=o.encrypt(k(C,[0,0,0,N])),A=k(A,w.clamp(c.slice(d),N).concat([0,0,0])),S=k(S,A),S=o.encrypt(k(S,k(C,v(C)))),p.length&&(S=k(S,y?p:t.mode.ocb2.pmac(o,p))),!w.equal(w.clamp(S,g),w.bitSlice(c,T)))throw new t.exception.corrupt("ocb: tag doesn't match");return j.concat(w.clamp(A,N))},pmac:function(o,c){var d,p=t.mode.ocb2.S,g=t.bitArray,y=g.i,v=[0,0,0,0],w=o.encrypt([0,0,0,0]),w=y(w,p(p(w)));for(d=0;d+4<c.length;d+=4)w=p(w),v=y(v,o.encrypt(y(w,c.slice(d,d+4))));return d=c.slice(d),128>g.bitLength(d)&&(w=y(w,p(w)),d=g.concat(d,[-2147483648,0,0,0])),v=y(v,d),o.encrypt(y(p(y(w,p(w))),v))},S:function(o){return[o[0]<<1^o[1]>>>31,o[1]<<1^o[2]>>>31,o[2]<<1^o[3]>>>31,o[3]<<1^135*(o[0]>>>31)]}},t.mode.gcm={name:"gcm",encrypt:function(o,c,d,p,g){var y=c.slice(0);return c=t.bitArray,p=p||[],o=t.mode.gcm.C(!0,o,y,p,d,g||128),c.concat(o.data,o.tag)},decrypt:function(o,c,d,p,g){var y=c.slice(0),v=t.bitArray,w=v.bitLength(y);if(g=g||128,p=p||[],g<=w?(c=v.bitSlice(y,w-g),y=v.bitSlice(y,0,w-g)):(c=y,y=[]),o=t.mode.gcm.C(!1,o,y,p,d,g),!v.equal(o.tag,c))throw new t.exception.corrupt("gcm: tag doesn't match");return o.data},ka:function(o,c){var d,p,g,y,v,w=t.bitArray.i;for(g=[0,0,0,0],y=c.slice(0),d=0;128>d;d++){for((p=(o[Math.floor(d/32)]&1<<31-d%32)!==0)&&(g=w(g,y)),v=(y[3]&1)!==0,p=3;0<p;p--)y[p]=y[p]>>>1|(y[p-1]&1)<<31;y[0]>>>=1,v&&(y[0]^=-520093696)}return g},j:function(o,c,d){var p,g=d.length;for(c=c.slice(0),p=0;p<g;p+=4)c[0]^=4294967295&d[p],c[1]^=4294967295&d[p+1],c[2]^=4294967295&d[p+2],c[3]^=4294967295&d[p+3],c=t.mode.gcm.ka(c,o);return c},C:function(o,c,d,p,g,y){var v,w,k,S,C,A,N,T,j=t.bitArray;for(A=d.length,N=j.bitLength(d),T=j.bitLength(p),w=j.bitLength(g),v=c.encrypt([0,0,0,0]),w===96?(g=g.slice(0),g=j.concat(g,[1])):(g=t.mode.gcm.j(v,[0,0,0,0],g),g=t.mode.gcm.j(v,g,[0,0,Math.floor(w/4294967296),w&4294967295])),w=t.mode.gcm.j(v,[0,0,0,0],p),C=g.slice(0),p=w.slice(0),o||(p=t.mode.gcm.j(v,w,d)),S=0;S<A;S+=4)C[3]++,k=c.encrypt(C),d[S]^=k[0],d[S+1]^=k[1],d[S+2]^=k[2],d[S+3]^=k[3];return d=j.clamp(d,N),o&&(p=t.mode.gcm.j(v,w,d)),o=[Math.floor(T/4294967296),T&4294967295,Math.floor(N/4294967296),N&4294967295],p=t.mode.gcm.j(v,p,o),k=c.encrypt(g),p[0]^=k[0],p[1]^=k[1],p[2]^=k[2],p[3]^=k[3],{tag:j.bitSlice(p,0,y),data:d}}},t.misc.hmac=function(o,c){this.W=c=c||t.hash.sha256;var d=[[],[]],p,g=c.prototype.blockSize/32;for(this.w=[new c,new c],o.length>g&&(o=c.hash(o)),p=0;p<g;p++)d[0][p]=o[p]^909522486,d[1][p]=o[p]^1549556828;this.w[0].update(d[0]),this.w[1].update(d[1]),this.R=new c(this.w[0])},t.misc.hmac.prototype.encrypt=t.misc.hmac.prototype.mac=function(o){if(this.aa)throw new t.exception.invalid("encrypt on already updated hmac called!");return this.update(o),this.digest(o)},t.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]),this.aa=!1},t.misc.hmac.prototype.update=function(o){this.aa=!0,this.R.update(o)},t.misc.hmac.prototype.digest=function(){var o=this.R.finalize(),o=new this.W(this.w[1]).update(o).finalize();return this.reset(),o},t.misc.pbkdf2=function(o,c,d,p,g){if(d=d||1e4,0>p||0>d)throw new t.exception.invalid("invalid params to pbkdf2");typeof o=="string"&&(o=t.codec.utf8String.toBits(o)),typeof c=="string"&&(c=t.codec.utf8String.toBits(c)),g=g||t.misc.hmac,o=new g(o);var y,v,w,k,S=[],C=t.bitArray;for(k=1;32*S.length<(p||1);k++){for(g=y=o.encrypt(C.concat(c,[k])),v=1;v<d;v++)for(y=o.encrypt(y),w=0;w<y.length;w++)g[w]^=y[w];S=S.concat(g)}return p&&(S=C.clamp(S,p)),S},t.prng=function(o){this.c=[new t.hash.sha256],this.m=[0],this.P=0,this.H={},this.N=0,this.U={},this.Z=this.f=this.o=this.ha=0,this.b=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.L=void 0,this.M=o,this.D=!1,this.K={progress:{},seeded:{}},this.u=this.ga=0,this.I=1,this.J=2,this.ca=65536,this.T=[0,48,64,96,128,192,256,384,512,768,1024],this.da=3e4,this.ba=80},t.prng.prototype={randomWords:function(o,c){var d=[],p;p=this.isReady(c);var g;if(p===this.u)throw new t.exception.notReady("generator isn't seeded");if(p&this.J){p=!(p&this.I),g=[];var y=0,v;for(this.Z=g[0]=new Date().valueOf()+this.da,v=0;16>v;v++)g.push(4294967296*Math.random()|0);for(v=0;v<this.c.length&&(g=g.concat(this.c[v].finalize()),y+=this.m[v],this.m[v]=0,p||!(this.P&1<<v));v++);for(this.P>=1<<this.c.length&&(this.c.push(new t.hash.sha256),this.m.push(0)),this.f-=y,y>this.o&&(this.o=y),this.P++,this.b=t.hash.sha256.hash(this.b.concat(g)),this.L=new t.cipher.aes(this.b),p=0;4>p&&(this.h[p]=this.h[p]+1|0,!this.h[p]);p++);}for(p=0;p<o;p+=4)(p+1)%this.ca===0&&a(this),g=f(this),d.push(g[0],g[1],g[2],g[3]);return a(this),d.slice(0,o)},setDefaultParanoia:function(o,c){if(o===0&&c!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new t.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=o},addEntropy:function(o,c,d){d=d||"user";var p,g,y=new Date().valueOf(),v=this.H[d],w=this.isReady(),k=0;switch(p=this.U[d],p===void 0&&(p=this.U[d]=this.ha++),v===void 0&&(v=this.H[d]=0),this.H[d]=(this.H[d]+1)%this.c.length,typeof o){case"number":c===void 0&&(c=1),this.c[v].update([p,this.N++,1,c,y,1,o|0]);break;case"object":if(d=Object.prototype.toString.call(o),d==="[object Uint32Array]"){for(g=[],d=0;d<o.length;d++)g.push(o[d]);o=g}else for(d!=="[object Array]"&&(k=1),d=0;d<o.length&&!k;d++)typeof o[d]!="number"&&(k=1);if(!k){if(c===void 0)for(d=c=0;d<o.length;d++)for(g=o[d];0<g;)c++,g=g>>>1;this.c[v].update([p,this.N++,2,c,y,o.length].concat(o))}break;case"string":c===void 0&&(c=o.length),this.c[v].update([p,this.N++,3,c,y,o.length]),this.c[v].update(o);break;default:k=1}if(k)throw new t.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[v]+=c,this.f+=c,w===this.u&&(this.isReady()!==this.u&&n("seeded",Math.max(this.o,this.f)),n("progress",this.getProgress()))},isReady:function(o){return o=this.T[o!==void 0?o:this.M],this.o&&this.o>=o?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=o?this.J|this.u:this.u},getProgress:function(o){return o=this.T[o||this.M],this.o>=o||this.f>o?1:this.f/o},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:u(this,this.ma),mouseCollector:u(this,this.oa),keyboardCollector:u(this,this.la),accelerometerCollector:u(this,this.ea),touchCollector:u(this,this.qa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new t.exception.bug("can't attach event");this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(o,c){this.K[o][this.ga++]=c},removeEventListener:function(o,c){var d,p,g=this.K[o],y=[];for(p in g)g.hasOwnProperty(p)&&g[p]===c&&y.push(p);for(d=0;d<y.length;d++)p=y[d],delete g[p]},la:function(){l(this,1)},oa:function(o){var c,d;try{c=o.x||o.clientX||o.offsetX||0,d=o.y||o.clientY||o.offsetY||0}catch{d=c=0}c!=0&&d!=0&&this.addEntropy([c,d],2,"mouse"),l(this,0)},qa:function(o){o=o.touches[0]||o.changedTouches[0],this.addEntropy([o.pageX||o.clientX,o.pageY||o.clientY],1,"touch"),l(this,0)},ma:function(){l(this,2)},ea:function(o){if(o=o.accelerationIncludingGravity.x||o.accelerationIncludingGravity.y||o.accelerationIncludingGravity.z,window.orientation){var c=window.orientation;typeof c=="number"&&this.addEntropy(c,1,"accelerometer")}o&&this.addEntropy(o,2,"accelerometer"),l(this,0)}};function n(o,c){var d,p=t.random.K[o],g=[];for(d in p)p.hasOwnProperty(d)&&g.push(p[d]);for(d=0;d<g.length;d++)g[d](c)}function l(o,c){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?o.addEntropy(window.performance.now(),c,"loadtime"):o.addEntropy(new Date().valueOf(),c,"loadtime")}function a(o){o.b=f(o).concat(f(o)),o.L=new t.cipher.aes(o.b)}function f(o){for(var c=0;4>c&&(o.h[c]=o.h[c]+1|0,!o.h[c]);c++);return o.L.encrypt(o.h)}function u(o,c){return function(){c.apply(o,arguments)}}t.random=new t.prng(6);e:try{if(m=typeof e<"u"&&e.exports){try{x=sr("crypto")}catch{x=null}m=_=x}if(m&&_.randomBytes)h=_.randomBytes(128),h=new Uint32Array(new Uint8Array(h).buffer),t.random.addEntropy(h,1024,"crypto['randomBytes']");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(b=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(b);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(b);else break e;t.random.addEntropy(b,1024,"crypto['getRandomValues']")}}catch(o){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(o))}var h,_,b,m,x;t.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(o,c,d,p){d=d||{},p=p||{};var g=t.json,y=g.g({iv:t.random.randomWords(4,0)},g.defaults),v;if(g.g(y,d),d=y.adata,typeof y.salt=="string"&&(y.salt=t.codec.base64.toBits(y.salt)),typeof y.iv=="string"&&(y.iv=t.codec.base64.toBits(y.iv)),!t.mode[y.mode]||!t.cipher[y.cipher]||typeof o=="string"&&100>=y.iter||y.ts!==64&&y.ts!==96&&y.ts!==128||y.ks!==128&&y.ks!==192&&y.ks!==256||2>y.iv.length||4<y.iv.length)throw new t.exception.invalid("json encrypt: invalid parameters");return typeof o=="string"?(v=t.misc.cachedPbkdf2(o,y),o=v.key.slice(0,y.ks/32),y.salt=v.salt):t.ecc&&o instanceof t.ecc.elGamal.publicKey&&(v=o.kem(),y.kemtag=v.tag,o=v.key.slice(0,y.ks/32)),typeof c=="string"&&(c=t.codec.utf8String.toBits(c)),typeof d=="string"&&(y.adata=d=t.codec.utf8String.toBits(d)),v=new t.cipher[y.cipher](o),g.g(p,y),p.key=o,y.ct=y.mode==="ccm"&&t.arrayBuffer&&t.arrayBuffer.ccm&&c instanceof ArrayBuffer?t.arrayBuffer.ccm.encrypt(v,c,y.iv,d,y.ts):t.mode[y.mode].encrypt(v,c,y.iv,d,y.ts),y},encrypt:function(o,c,d,p){var g=t.json,y=g.ja.apply(g,arguments);return g.encode(y)},ia:function(o,c,d,p){d=d||{},p=p||{};var g=t.json;c=g.g(g.g(g.g({},g.defaults),c),d,!0);var y,v;if(y=c.adata,typeof c.salt=="string"&&(c.salt=t.codec.base64.toBits(c.salt)),typeof c.iv=="string"&&(c.iv=t.codec.base64.toBits(c.iv)),!t.mode[c.mode]||!t.cipher[c.cipher]||typeof o=="string"&&100>=c.iter||c.ts!==64&&c.ts!==96&&c.ts!==128||c.ks!==128&&c.ks!==192&&c.ks!==256||!c.iv||2>c.iv.length||4<c.iv.length)throw new t.exception.invalid("json decrypt: invalid parameters");return typeof o=="string"?(v=t.misc.cachedPbkdf2(o,c),o=v.key.slice(0,c.ks/32),c.salt=v.salt):t.ecc&&o instanceof t.ecc.elGamal.secretKey&&(o=o.unkem(t.codec.base64.toBits(c.kemtag)).slice(0,c.ks/32)),typeof y=="string"&&(y=t.codec.utf8String.toBits(y)),v=new t.cipher[c.cipher](o),y=c.mode==="ccm"&&t.arrayBuffer&&t.arrayBuffer.ccm&&c.ct instanceof ArrayBuffer?t.arrayBuffer.ccm.decrypt(v,c.ct,c.iv,c.tag,y,c.ts):t.mode[c.mode].decrypt(v,c.ct,c.iv,y,c.ts),g.g(p,c),p.key=o,d.raw===1?y:t.codec.utf8String.fromBits(y)},decrypt:function(o,c,d,p){var g=t.json;return g.ia(o,g.decode(c),d,p)},encode:function(o){var c,d="{",p="";for(c in o)if(o.hasOwnProperty(c)){if(!c.match(/^[a-z0-9]+$/i))throw new t.exception.invalid("json encode: invalid property name");switch(d+=p+'"'+c+'":',p=",",typeof o[c]){case"number":case"boolean":d+=o[c];break;case"string":d+='"'+escape(o[c])+'"';break;case"object":d+='"'+t.codec.base64.fromBits(o[c],0)+'"';break;default:throw new t.exception.bug("json encode: unsupported type")}}return d+"}"},decode:function(o){if(o=o.replace(/\s/g,""),!o.match(/^\{.*\}$/))throw new t.exception.invalid("json decode: this isn't json!");o=o.replace(/^\{|\}$/g,"").split(/,/);var c={},d,p;for(d=0;d<o.length;d++){if(!(p=o[d].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new t.exception.invalid("json decode: this isn't json!");p[3]!=null?c[p[2]]=parseInt(p[3],10):p[4]!=null?c[p[2]]=p[2].match(/^(ct|adata|salt|iv)$/)?t.codec.base64.toBits(p[4]):unescape(p[4]):p[5]!=null&&(c[p[2]]=p[5]==="true")}return c},g:function(o,c,d){if(o===void 0&&(o={}),c===void 0)return o;for(var p in c)if(c.hasOwnProperty(p)){if(d&&o[p]!==void 0&&o[p]!==c[p])throw new t.exception.invalid("required parameter overridden");o[p]=c[p]}return o},sa:function(o,c){var d={},p;for(p in o)o.hasOwnProperty(p)&&o[p]!==c[p]&&(d[p]=o[p]);return d},ra:function(o,c){var d={},p;for(p=0;p<c.length;p++)o[c[p]]!==void 0&&(d[c[p]]=o[c[p]]);return d}},t.encrypt=t.json.encrypt,t.decrypt=t.json.decrypt,t.misc.pa={},t.misc.cachedPbkdf2=function(o,c){var d=t.misc.pa,p;return c=c||{},p=c.iter||1e3,d=d[o]=d[o]||{},p=d[p]=d[p]||{firstSalt:c.salt&&c.salt.length?c.salt.slice(0):t.random.randomWords(2,0)},d=c.salt===void 0?p.firstSalt:c.salt,p[d]=p[d]||t.misc.pbkdf2(o,d,c.iter),{key:p[d].slice(0),salt:d.slice(0)}},typeof e<"u"&&e.exports&&(e.exports=t),typeof define=="function"&&define([],function(){return t})}}),nr=Kt({"node_modules/web-worker/cjs/browser.js"(s,e){e.exports=Worker}}),ar=class{constructor(s){this.pushToState={},this.data={},this.triggers={},this.setState=e=>{Object.assign(this.data,e);for(let t of Object.getOwnPropertyNames(e))this.triggers[t]&&this.triggers[t].forEach(r=>r.onchange(this.data[t]));return this.data},this.setValue=(e,t)=>{this.data[e]=t,this.triggers[e]&&this.triggers[e].forEach(r=>r.onchange(this.data[e]))},this.subscribeTrigger=(e,t)=>{if(e){this.triggers[e]||(this.triggers[e]=[]);let r=this.triggers[e].length;return this.triggers[e].push({sub:r,onchange:t}),this.triggers[e].length-1}else return},this.unsubscribeTrigger=(e,t)=>{let r=this.triggers[e];if(r)if(!t)delete this.triggers[e];else{let i,n=r.find((l,a)=>{if(l.sub===i)return i=a,!0});return n&&r.splice(i,1),this.onRemoved&&this.onRemoved(n),!0}},this.subscribeTriggerOnce=(e,t)=>{let r,i=n=>{t(n),this.unsubscribeTrigger(e,r)};r=this.subscribeTrigger(e,i)},this.getTrigger=(e,t)=>{for(let r in this.triggers[e])if(this.triggers[e][r].sub===t)return this.triggers[e][r]},typeof s=="object"&&(this.data=s)}},Qt=new ar,F=class{constructor(s,e,t){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,state:Qt},this.__subscribe=(i,n,l,a,f)=>{let u=(_,b=(x,o)=>x,m=i)=>{let x=this.__node.state.subscribeTrigger(_,m),o=this.__node.state.getTrigger(_,x);return o.source=this.__node.tag,n&&(o.key=n),o.target=b(i),a&&(o.bound=a),x},h=_=>{if(!this.__node.graph.get(_)&&_.includes(".")){let m=this.__node.graph.get(_.substring(0,_.lastIndexOf("."))),x=_.substring(_.lastIndexOf(".")+1);m&&typeof m[x]=="function"&&(_=(...o)=>m[x](...o))}};if(n){this.__node.localState||this.__addLocalState(this),typeof i=="string"&&(typeof this[i]=="function"?i=this[i]:this.__node.graph&&h(i));let _,b=l?this.__node.unique+"."+n+"input":this.__node.unique+"."+n;return typeof i=="function"?_=u(b):i?.__node&&(_=u(b,(m,x)=>x||m.__node.unique,m=>{i.__operator&&i.__operator(m)})),_}else{typeof i=="string"&&(this.__node.graph?i=this.__node.graph.get(i):i=this.__node.graph.nodes.get(i));let _,b=l?this.__node.unique+"input":this.__node.unique;return typeof i=="function"?_=u(b):i?.__node&&(_=u(b,(m,x)=>x||m.__node.unique,m=>{i.__operator&&i.__operator(m)})),_}},this.__unsubscribe=(i,n,l)=>n?this.__node.state.unsubscribeTrigger(l?this.__node.unique+"."+n+"input":this.__node.unique+"."+n,i):this.__node.state.unsubscribeTrigger(l?this.__node.unique+"input":this.__node.unique,i),this.__setOperator=i=>{if(i=i.bind(this),this.__operator=(...n)=>{this.__node.inputState&&this.__node.state.setValue(this.__node.unique+"input",n);let l=i(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof l?.then=="function"?l.then(a=>{a!==void 0&&this.__node.state.setValue(this.__node.unique,a)}).catch(console.error):l!==void 0&&this.__node.state.setValue(this.__node.unique,l)),l},!this.__subscribedToParent&&this.__parent instanceof F&&this.__parent.__operator){let n=this.__parent.__subscribe(this),l=()=>{this.__parent?.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(l),this.__subscribedToParent=!0}return this.__operator},this.__proxyObject=i=>{let n=or(i);for(let l of n)typeof this[l]>"u"&&(typeof i[l]=="function"?this[l]=(...a)=>{this.__node.inputState&&this.__node.state.setValue(this.__node.unique+"."+l+"input",a);let f=i[l](...a);return this.__node.state.triggers[this.__node.unique+"."+l]&&(typeof f?.then=="function"?f.then(u=>{this.__node.state.setValue(this.__node.unique+"."+l,u)}).catch(console.error):this.__node.state.setValue(this.__node.unique+"."+l,f)),f}:Object.defineProperty(this,l,{get:()=>i[l],set:f=>{i[l]=f,this.__node.state.triggers[this.__node.unique+"."+l]&&this.__node.state.setValue(this.__node.unique+"."+l,f)},enumerable:!0,configurable:!0}))};let r=s;if(typeof s=="function"?s={__operator:s,__node:{forward:!0,tag:s.name}}:typeof s=="string"&&t?.get(s)&&(s=t.get(s)),s.__node.initial||(s.__node.initial=r),typeof s=="object"){if(s.__props&&(typeof s.__props=="function"&&(s.__props=new s.__props),typeof s.__props=="object"&&this.__proxyObject(s.__props)),typeof s.__node=="string"?t?.get(s.__node.tag)?s=t.get(s.__node.tag):s.__node={}:s.__node||(s.__node={}),!s.__parent&&e&&(s.__parent=e),t&&(s.__node.graph=t),s.__operator){if(typeof s.__operator=="string"&&t){let n=t.get(s.__operator);n&&(s.__operator=n.__operator),!s.__node.tag&&s.__operator.name&&(s.__node.tag=s.__operator.name)}typeof s.__operator=="function"&&(s.__operator=this.__setOperator(s.__operator))}if(s.__node.tag||(s.__operator?.name?s.__node.tag=s.__operator.name:s.__node.tag=`node${Math.floor(Math.random()*1e15)}`),e?.__node&&!(e instanceof ye||s instanceof ye)&&(s.__node.tag=e.__node.tag+"."+s.__node.tag),e instanceof ye&&s instanceof ye&&(s.__node.loaders&&Object.assign(e.__node.loaders?e.__node.loaders:{},s.__node.loaders),e.__node.mapGraphs)){s.__node.nodes.forEach(l=>{e.set(s.__node.tag+"."+l.__node.tag,l)});let n=()=>{s.__node.nodes.forEach(l=>{e.__node.nodes.delete(s.__node.tag+"."+l.__node.tag)})};this.__addOndisconnected(n)}s.__node=Object.assign(this.__node,s.__node);let i=Object.getOwnPropertyNames(s);for(let n of i)this[n]=s[n];if(typeof s.default=="function"&&!s.__operator){let n=s.default.bind(this);this.default=(...l)=>{this.__node.inputState&&this.__node.state.setValue(this.__node.unique+"input",l);let a=n(...l);return typeof a?.then=="function"?a.then(f=>{f!==void 0&&this.__node.state.setValue(this.__node.unique,f)}).catch(console.error):a!==void 0&&this.__node.state.setValue(this.__node.unique,a),a},s.default=this.default}s instanceof ye&&(this.__node.source=s)}}__addLocalState(s){if(!s)return;this.__node.localState||(this.__node.localState={});let e=this.__node.localState;for(let t in s)if(!(this.__props&&this.__props[t]))if(typeof s[t]=="function"){if(!t.startsWith("_")){let r=s[t].bind(this);s[t]=(...i)=>{this.__node.inputState&&this.__node.state.setValue(this.__node.unique+"."+t+"input",i);let n=r(...i);return typeof n?.then=="function"?this.__node.state.triggers[this.__node.unique+"."+t]&&n.then(l=>{this.__node.state.setValue(this.__node.unique+"."+t,l)}).catch(console.error):this.__node.state.triggers[this.__node.unique+"."+t]&&this.__node.state.setValue(this.__node.unique+"."+t,n),n},this[t]=s[t]}}else{e[t]=s[t];let r={get:()=>e[t],set:i=>{e[t]=i,this.__node.state.triggers[this.__node.unique+"."+t]&&this.__node.state.setValue(this.__node.unique+"."+t,i)},enumerable:!0,configurable:!0};if(Object.defineProperty(this,t,r),typeof this.__node.initial=="object"){let i=Object.getOwnPropertyDescriptor(this.__node.initial,t);(i===void 0||i?.configurable)&&Object.defineProperty(this.__node.initial,t,r)}}}__addOnconnected(s){Array.isArray(this.__ondisconnected)?this.__onconnected.push(s):typeof this.__onconnected=="function"?this.__onconnected=[s,this.__onconnected]:this.__onconnected=s}__addOndisconnected(s){Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(s):typeof this.__ondisconnected=="function"?this.__ondisconnected=[s,this.__ondisconnected]:this.__ondisconnected=s}__callConnected(s=this){typeof this.__onconnected=="function"?this.__onconnected(this):Array.isArray(this.__onconnected)&&this.__onconnected.forEach(e=>{e(this)})}__callDisconnected(s=this){typeof this.__ondisconnected=="function"?this.__ondisconnected(this):Array.isArray(this.__ondisconnected)&&this.__ondisconnected.forEach(e=>{e(this)})}},ye=class{constructor(s){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,nodes:new Map,state:Qt},this.init=e=>{e&&(nt(this.__node,e),e.tree&&this.setTree(e.tree))},this.setTree=e=>{this.__node.tree=Object.assign(this.__node.tree?this.__node.tree:{},e);let t=Object.assign({},e);t.__node&&delete t.__node;let r=this.recursiveSet(t,this,void 0,e);if(e.__node){if(!e.__node.tag)e.__node._tag=`tree${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let i=new F(e,this,this);this.set(i.__node.tag,i);for(let n in this.__node.loaders)typeof this.__node.loaders[n]=="object"?(this.__node.loaders[n].init&&this.__node.loaders[n](i,parent,this,this.__node.tree,e),this.__node.loaders[n].connected&&i.__addOnconnected(this.__node.loaders[n].connect),this.__node.loaders[n].disconnected&&i.__addOndisconnected(this.__node.loaders[n].disconnect)):typeof this.__node.loaders=="function"&&this.__node.loaders[n](i,this,this,e,e,e.__node.tag);i.__listeners&&(r[i.__node.tag]=i.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(r),t},this.setLoaders=(e,t)=>(t?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders),this.add=(e,t)=>{let r={};typeof t=="string"&&(t=this.get(t)),typeof e=="function"?e={__operator:e}:typeof e=="string"&&(e=this.__node.tree[e]);let i=Object.assign({},e);if(i.__node||(i.__node={}),i.__node.initial=e,typeof e=="object"&&(!i?.__node?.tag||!this.get(i.__node.tag))){let n=new F(i,t,this);this.set(n.__node.tag,n);for(let l in this.__node.loaders)typeof this.__node.loaders[l]=="object"?(this.__node.loaders[l].init&&this.__node.loaders[l](n,t,this,this.__node.tree,e,n.__node.tag),this.__node.loaders[l].connected&&n.__addOnconnected(this.__node.loaders[l].connect),this.__node.loaders[l].disconnected&&n.__addOndisconnected(this.__node.loaders[l].disconnect)):typeof this.__node.loaders=="function"&&this.__node.loaders[l](n,t,this,this.__node.tree,e,n.__node.tag);return this.__node.tree[n.__node.tag]=e,n.__listeners&&(r[n.__node.tag]=n.__listeners),n.__children&&(n.__children=Object.assign({},n.__children),this.recursiveSet(n.__children,n,r,n.__children)),this.setListeners(r),n.__callConnected(),n}},this.recursiveSet=(e,t,r={},i)=>{let n=Object.getOwnPropertyNames(i);for(let l of n){if(l.includes("__"))continue;let a=i[l];if(!Array.isArray(a)&&(typeof a=="function"?a={__operator:a}:typeof a=="string"?a=this.__node.tree[a]:typeof a=="boolean"&&(a=this.__node.tree[l]),typeof a=="object")){if(a=Object.assign({},a),a.__node||(a.__node={}),a.__node.tag||(a.__node.tag=l),a.__node.initial=e[l],this.get(a.__node.tag)&&!(t?.__node&&this.get(t.__node.tag+"."+a.__node.tag))||t?.__node&&this.get(t.__node.tag+"."+a.__node.tag))continue;let f=new F(a,t,this);this.set(f.__node.tag,f);for(let u in this.__node.loaders)this.__node.loaders[u](f,t,this,e,e[l],l);e[l]=f,this.__node.tree[f.__node.tag]=a,f.__listeners&&(r[f.__node.tag]=f.__listeners),f.__children&&(f.__children=Object.assign({},f.__children),this.recursiveSet(f.__children,f,r,f.__children)),f.__callConnected()}}return r},this.remove=(e,t=!0)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof F){this.delete(e.__node.tag),delete this.__node.tree[e.__node.tag],t&&this.clearListeners(e),e.__callDisconnected();let r=i=>{for(let n in i)this.unsubscribe(i[n]),this.delete(i[n].__node.tag),delete this.__node.tree[i[n].__node.tag],this.delete(n),delete this.__node.tree[n],i[n].__node.tag=i[n].__node.tag.substring(i[n].__node.tag.lastIndexOf(".")+1),t&&this.clearListeners(i[n]),i[n].__callDisconnected(),i[n].__children&&r(i[n].__children)};e.__children&&r(e.__children)}return e?.__node.tag&&e?.__parent&&(delete e?.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e},this.run=(e,...t)=>{if(typeof e=="string"){let r=this.get(e);if(!r&&e.includes(".")){if(r=this.get(e.substring(0,e.lastIndexOf("."))),typeof r?.[e.substring(e.lastIndexOf(".")+1)]=="function")return r[e.substring(e.lastIndexOf(".")+1)](...t)}else if(r?.__operator)return r.__operator(...t)}if(e?.__operator)return e?.__operator(...t)},this.setListeners=e=>{for(let t in e){let r=this.get(t);if(typeof e[t]=="object")for(let i in e[t]){let n=this.get(i),l;if(typeof e[t][i]!="object")e[t][i]={__callback:e[t][i]};else if(!e[t][i].__callback)for(let a in e[t][i]){typeof e[t][i][a]!="object"&&(e[t][i][a]={__callback:e[t][i][a]},e[t][i][a].__callback===!0&&(e[t][i][a].__callback=r.__operator));let f=this.get(a);if(f)if(f)l=this.subscribe(f,e[t][i][a].__callback,void 0,e[t][i].inputState,t,i),typeof r.__listeners[i][a]!="object"&&(r.__listeners[i][a]={__callback:e[t][i][a].__callback,inputState:e[t][i][a]?.inputState}),r.__listeners[i][a].sub=l;else{let u=i.substring(0,i.lastIndexOf("."));f=this.get(u),n&&(l=this.subscribe(f,e[t][i][a].__callback,i.substring(i.lastIndexOf(".")+1),e[t][i][a].inputState,t,i),typeof r.__listeners[i][a]!="object"&&(r.__listeners[i][a]={__callback:e[t][i][a].__callback,inputState:e[t][i][a]?.inputState}),r.__listeners[i][a].sub=l)}}if(e[t][i].__callback)if(e[t][i].__callback===!0&&(e[t][i].__callback=r.__operator),typeof e[t][i].__callback=="function"&&(e[t][i].__callback=e[t][i].__callback.bind(r)),typeof r.__listeners!="object"&&(r.__listeners={}),n)l=this.subscribe(n,e[t][i].__callback,void 0,e[t][i].inputState,t,i),typeof r.__listeners[i]!="object"&&(r.__listeners[i]={__callback:e[t][i].__callback,inputState:e[t][i]?.inputState}),r.__listeners[i].sub=l;else{let a=i.substring(0,i.lastIndexOf("."));n=this.get(a),n&&(l=this.subscribe(n,e[t][i].__callback,i.substring(i.lastIndexOf(".")+1),e[t][i].inputState,t,i),typeof r.__listeners[i]!="object"&&(r.__listeners[i]={__callback:e[t][i].__callback,inputState:e[t][i]?.inputState}),r.__listeners[i].sub=l)}}}},this.clearListeners=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e?.__listeners)for(let r in e.__listeners){if(t&&r!==t||typeof e.__listeners[r].sub!="number")continue;let i=this.get(r);if(i)if(e.__listeners[r].__callback)this.unsubscribe(i,e.__listeners[r].sub,void 0,e.__listeners[r].inputState);else for(let n in e.__listeners[r])this.unsubscribe(i,e.__listeners[r][n].sub,void 0,e.__listeners[r][n].inputState);else if(i=this.get(r.substring(0,r.lastIndexOf("."))),i)if(e.__listeners[r].__callback)this.unsubscribe(i,e.__listeners[r].sub,r.substring(r.lastIndexOf(".")+1),e.__listeners[r].inputState);else for(let n in e.__listeners[r])this.unsubscribe(i,e.__listeners[r][n].sub,r.substring(r.lastIndexOf(".")+1),e.__listeners[r][n].inputState);delete e.__listeners[r]}},this.get=e=>this.__node.nodes.get(e),this.set=(e,t)=>this.__node.nodes.set(e,t),this.delete=e=>this.__node.nodes.delete(e),this.getProps=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof F){let r;t?r=Object.assign({},this.__node.tree[e.__node.tag]):(r=Object.assign({},e),delete r.__unsubscribe,delete r.__setOperator,delete r.__node,delete r.__subscribeState,delete r.__subscribe)}},this.subscribe=(e,t,r,i,n,l)=>{let a=e;e instanceof F||(a=this.get(e));let f;if(typeof t=="string")if(n){let u=this.get(n)?.[t];typeof u=="function"&&(t=u)}else t=this.get(t)?.__operator;if(a instanceof F){f=a.__subscribe(t,r,i,n,l);let u=()=>{a.__unsubscribe(f,r,i)};a.__addOndisconnected(u)}else if(typeof e=="string")if(this.get(e))if(t instanceof F&&t.__operator){f=this.get(e).__subscribe(t.__operator,r,i,n,l);let u=()=>{this.get(e).__unsubscribe(f)};t.__addOndisconnected(u)}else(typeof t=="function"||typeof t=="string")&&(f=this.get(e).__subscribe(t,r,i,n,l),this.__node.state.getTrigger(this.get(e).__node.unique,f).source=e);else typeof t=="string"&&(t=this.__node.nodes.get(t).__operator),typeof t=="function"&&(f=this.__node.state.subscribeTrigger(e,t));return f},this.unsubscribe=(e,t,r,i)=>e instanceof F?e.__unsubscribe(t,r,i):this.get(e)?.__unsubscribe(t,r,i),this.setState=e=>{this.__node.state.setState(e)},this.init(s)}};function nt(s,e){for(let t in e)e[t]?.constructor.name==="Object"&&!Array.isArray(e[t])?s[t]?.constructor.name==="Object"&&!Array.isArray(s[t])?nt(s[t],e[t]):s[t]=nt({},e[t]):s[t]=e[t];return s}function or(s){var e=[],t=s;do{var r=Object.getOwnPropertyNames(t);r.forEach(function(i){e.indexOf(i)===-1&&e.push(i)})}while(t=Object.getPrototypeOf(t));return e}var lr=(s,e,t)=>{s.__node.backward&&e instanceof F&&t.setListeners({[e.__node.tag]:{[s.__node.tag]:e}})},cr=(s,e,t)=>{if(s.__operator&&!s.__node.looperSet){if(s.__node.looperSet=!0,typeof s.__node.delay=="number"){let r=s.__operator;s.__operator=(...i)=>new Promise((n,l)=>{setTimeout(async()=>{n(await r(...i))},s.__node.delay)})}else if(s.__node.frame===!0){let r=s.__operator;s.__operator=(...i)=>new Promise((n,l)=>{requestAnimationFrame(async()=>{n(await r(...i))})})}if(typeof s.__node.repeat=="number"||typeof s.__node.recursive=="number"){let r=s.__operator;s.__operator=async(...i)=>{let n=s.__node.repeat?s.__node.repeat:s.__node.recursive,l,a=async(f,...u)=>{for(;f>0;){if(s.__node.delay||s.__node.frame){r(...u).then(async h=>{s.__node.recursive?await a(f,h):await a(f,...u)});break}else l=await r(...i);f--}};return await a(n,...i),l}}if(s.__node.loop&&typeof s.__node.loop=="number"){let r=s.__operator;s.__operator=(...n)=>{"looping"in s.__node||(s.__node.looping=!0),s.__node.looping&&(r(...n),setTimeout(()=>{s.__operator(...n)},s.__node.loop))},s.__node.looping&&s.__operator();let i=n=>{n.__node.looping&&(n.__node.looping=!1)};s.__addOndisconnected(i)}}},fr=(s,e,t)=>{if(s.__node.animate===!0||s.__animation){let r=s.__operator;s.__operator=(...n)=>{"animating"in s.__node||(s.__node.animating=!0),s.__node.animating&&(typeof s.__animation=="function"?s.__animation(...n):r(...n),requestAnimationFrame(()=>{s.__operator(...n)}))},(s.__node.animating||(!("animating"in s.__node)||s.__node.animating)&&s.__animation)&&setTimeout(()=>{requestAnimationFrame(s.__operator())},10);let i=n=>{n.__node.animating&&(n.__node.animating=!1)};s.__addOndisconnected(i)}},dr=(s,e,t)=>{if(typeof s.__node.branch=="object"&&s.__operator&&!s.__node.branchApplied){let r=s.__operator;s.__node.branchApplied=!0,s.__operator=(...i)=>{let n=r(...i);for(let l in s.__node.branch){let a=()=>{typeof s.__node.branch[l].then=="function"?s.__node.branch[l].then(n):s.__node.branch[l].then instanceof F&&s.__node.branch[l].then.__operator?s.__node.branch[l].then.__operator(n):n=s.__node.branch[l].then};typeof s.__node.branch[l].if=="function"?s.__node.branch[l].if(n)&&a():s.__node.branch[l].if===n&&a()}return n}}if(s.__listeners){for(let r in s.__listeners)if(typeof s.__listeners[r]=="object"&&s.__listeners[r].branch&&!s.__listeners[r].branchApplied){let i=s.__listeners[r].callback;s.__listeners[r].branchApplied=!0,s.__listeners.callback=n=>{let l=()=>{typeof s.__listeners[r].branch.then=="function"?n=s.__listeners[r].branch.then(n):s.__listeners[r].branch.then instanceof F&&s.__listeners[r].branch.then.__operator?n=s.__listeners[r].branch.then.__operator(n):n=s.__listeners[r].branch.then};return typeof s.__listeners[r].branch.if=="function"?s.__listeners[r].branch.if(n)&&l():s.__listeners[r].branch.if===n&&l(),i(n)}}}},ur=(s,e,t)=>{if(s.__listeners)for(let r in s.__listeners)typeof s.__listeners[r]=="object"&&s.__listeners[r].oncreate&&s.__listeners[r].callback(s.__listeners[r].oncreate)},hr=(s,e,t)=>{if(s.__listeners)for(let r in s.__listeners)typeof s.__listeners[r]=="object"&&typeof s.__listeners[r].binding=="object"&&(s.__listeners.callback=s.__listeners.callback.bind(s.__listeners[r].binding))},pr=(s,e,t)=>{if(s.__listeners){for(let r in s.__listeners)if(typeof s.__listeners[r]=="object"&&typeof s.__listeners[r].transform=="function"&&!s.__listeners[r].transformApplied){let i=s.__listeners[r].callback;s.__listeners[r].transformApplied=!0,s.__listeners.callback=n=>(n=s.__listeners[r].transform(n),i(n))}}},gr=(s,e,t)=>{s.post&&!s.__operator?s.__setOperator(s.post):!s.__operator&&typeof s.get=="function"&&s.__setOperator(s.get),!s.get&&s.__operator&&(s.get=s.__operator),s.aliases&&s.aliases.forEach(r=>{t.set(r,s);let i=n=>{t.__node.nodes.delete(r)};s.__addOndisconnected(i)}),typeof t.__node.tree[s.__node.tag]=="object"&&s.get&&(t.__node.tree[s.__node.tag].get=s.get)},Rt={backprop:lr,loop:cr,animate:fr,branching:dr,triggerListenerOncreate:ur,bindListener:hr,transformListenerResult:pr,substitute__operator:gr},es=class extends ye{constructor(s){super({...s,loaders:s?.loaders?Object.assign({...Rt},s.loaders):{...Rt}}),this.name=`service${Math.floor(Math.random()*1e15)}`,this.addServices=e=>{for(let t in e)if(typeof e[t]=="function"&&(e[t]=new e[t]),e[t]?.__node?.loaders&&Object.assign(this.__node.loaders,e[t].__node.loaders),e[t]?.__node?.nodes){e[t].__node.nodes.forEach((n,l)=>{this.get(l)?this.set(t+"."+l,n):this.set(l,n)}),this.__node.nodes.forEach((n,l)=>{e[t].__node.nodes.get(l)||e[t].__node.nodes.set(l,n)});let r=this.set;this.set=(n,l)=>(e[t].set(n,l),r(n,l));let i=this.delete;this.delete=n=>(e[t].delete(n),i(n))}else typeof e[t]=="object"&&this.setTree(e[t])},this.handleMethod=(e,t,r)=>{let i=t.toLowerCase(),n=this.__node.nodes.get(e);return n||(n=this.__node.tree[e]),n?.[i]?n[i]instanceof Function?n[i](r):(r&&(n[i]=r),n[i]):this.handleServiceMessage({route:e,args:r,method:t})},this.transmit=(...e)=>typeof e[0]=="object"?e[0].method?this.handleMethod(e[0].route,e[0].method,e[0].args):e[0].route?this.handleServiceMessage(e[0]):e[0].node?this.handleGraphNodeCall(e[0].node,e[0].args):(this.__node.keepState&&(e[0].route&&this.setState({[e[0].route]:e[0].args}),e[0].node&&this.setState({[e[0].node]:e[0].args})),e):e,this.receive=(...e)=>{if(e[0]&&typeof e[0]=="string"){let t=e[0].substring(0,8);(t.includes("{")||t.includes("["))&&(t.includes("\\")&&(e[0]=e[0].replace(/\\/g,"")),e[0][0]==='"'&&(e[0]=e[0].substring(1,e[0].length-1)),e[0]=JSON.parse(e[0]))}return typeof e[0]=="object"?e[0].method?this.handleMethod(e[0].route,e[0].method,e[0].args):e[0].route?this.handleServiceMessage(e[0]):e[0].node?this.handleGraphNodeCall(e[0].node,e[0].args):(this.__node.keepState&&(e[0].route&&this.setState({[e[0].route]:e[0].args}),e[0].node&&this.setState({[e[0].node]:e[0].args})),e):e},this.pipe=(e,t,r,i,n)=>{if(e instanceof F)return n?this.subscribe(e,l=>{let a=n(l);a!==void 0?this.transmit({route:t,args:a,method:i}):this.transmit({route:t,args:l,method:i},r)}):this.subscribe(e,l=>{this.transmit({route:t,args:l,method:i},r)});if(typeof e=="string")return this.subscribe(e,l=>{this.transmit({route:t,args:l,method:i},r)})},this.pipeOnce=(e,t,r,i,n)=>{if(e instanceof F)return n?e.__node.state.subscribeTriggerOnce(e.__node.unique,l=>{let a=n(l);a!==void 0?this.transmit({route:t,args:a,method:i}):this.transmit({route:t,args:l,method:i},r)}):this.__node.state.subscribeTriggerOnce(e.__node.unique,l=>{this.transmit({route:t,args:l,method:i},r)});if(typeof e=="string")return this.__node.state.subscribeTriggerOnce(this.__node.nodes.get(e).__node.unique,l=>{this.transmit({route:t,args:l,method:i},r)})},this.terminate=(...e)=>{},this.isTypedArray=yr,this.recursivelyAssign=at,this.spliceTypedArray=br,this.ping=()=>(console.log("pinged!"),"pong"),this.echo=(...e)=>(this.transmit(...e),e),s?.services&&this.addServices(s.services),this.setTree(this)}handleServiceMessage(s){let e;return typeof s=="object"&&(s.route?e=s.route:s.node&&(e=s.node)),e?Array.isArray(s.args)?this.run(e,...s.args):this.run(e,s.args):s}handleGraphNodeCall(s,e){if(!s)return e;if(e?.args)this.handleServiceMessage(e);else return Array.isArray(e)?this.run(s,...e):this.run(s,e)}};function yr(s){return ArrayBuffer.isView(s)&&Object.prototype.toString.call(s)!=="[object DataView]"}var at=(s,e)=>{for(let t in e)typeof e[t]=="object"&&!Array.isArray(e[t])?typeof s[t]=="object"&&!Array.isArray(s[t])?at(s[t],e[t]):s[t]=at({},e[t]):s[t]=e[t];return s};function br(s,e,t){let r=s.subarray(0,e),i;t&&(i=s.subarray(t+1));let n;return(r.length>0||i?.length>0)&&(n=new s.constructor(r.length+i.length)),n&&(r.length>0&&n.set(r),i&&i.length>0&&n.set(i,r.length)),n}function U(s=""){let e=l=>l.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),r=(l=>{let a=l.indexOf("=>")+1;return a<=0&&(a=l.indexOf("){")),a<=0&&(a=l.indexOf(") {")),l.slice(0,l.indexOf("{",a)+1)})(s),i=e(s),n;if(r.includes("function")){let l=r.split("(")[1].split(")")[0];n=new Function(l,i)}else if(r.substring(0,6)===i.substring(0,6)){let l=r.split("(")[1].split(")")[0];n=new Function(l,i.substring(i.indexOf("{")+1,i.length-1))}else try{n=(0,eval)(r+i+"}")}catch{}return n}var _r=function(){let s=new Map,e=[],t=["this"];function r(){s.clear(),e.length=0,t.length=1}function i(l,a){var f=e.length-1,u=e[f];if(typeof u=="object")if(u[l]===a||f===0)t.push(l),e.push(a.pushed);else for(;f-->=0;){if(u=e[f],typeof u=="object"&&u[l]===a){f+=2,e.length=f,t.length=f,--f,e[f]=a,t[f]=l;break}f--}}function n(l,a){if(a!=null&&typeof a=="object"){l&&i(l,a);let f=s.get(a);if(f)return"[Circular Reference]"+f;s.set(a,t.join("."))}return a}return function(a,f){try{return e.push(a),JSON.stringify(a,n,f)}finally{r()}}}();JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=_r);var vr=function(){let s=new Map,e=[],t=["this"];function r(){s.clear(),e.length=0,t.length=1}function i(l,a){var f=e.length-1;if(e[f]){var u=e[f];if(typeof u=="object")if(u[l]===a||f===0)t.push(l),e.push(a.pushed);else for(;f-->=0;){if(u=e[f],typeof u=="object"&&u[l]===a){f+=2,e.length=f,t.length=f,--f,e[f]=a,t[f]=l;break}f++}}}function n(l,a){let f;if(a!=null)if(typeof a=="object"){let u=a.constructor.name;l&&u==="Object"&&i(l,a);let h=s.get(a);if(h)return"[Circular Reference]"+h;if(s.set(a,t.join(".")),u==="Array")a.length>20?f=a.slice(a.length-20):f=a;else if(u.includes("Set"))f=Array.from(a);else if(u!=="Object"&&u!=="Number"&&u!=="String"&&u!=="Boolean")f="instanceof_"+u;else if(u==="Object"){let _={};for(let b in a)if(a[b]==null)_[b]=a[b];else if(Array.isArray(a[b]))a[b].length>20?_[b]=a[b].slice(a[b].length-20):_[b]=a[b];else if(a[b].constructor.name==="Object"){_[b]={};for(let m in a[b])if(Array.isArray(a[b][m]))a[b][m].length>20?_[b][m]=a[b][m].slice(a[b][m].length-20):_[b][m]=a[b][m];else if(a[b][m]!=null){let x=a[b][m].constructor.name;x.includes("Set")?_[b][m]=Array.from(a[b][m]):x!=="Number"&&x!=="String"&&x!=="Boolean"?_[b][m]="instanceof_"+x:_[b][m]=a[b][m]}else _[b][m]=a[b][m]}else{let m=a[b].constructor.name;m.includes("Set")?_[b]=Array.from(a[b]):m!=="Number"&&m!=="String"&&m!=="Boolean"?_[b]="instanceof_"+m:_[b]=a[b]}f=_}else f=a}else f=a;return f}return function(a,f){e.push(a);let u=JSON.stringify(a,n,f);return r(),u}}();JSON.stringifyFast===void 0&&(JSON.stringifyFast=vr);var mr={setRoute:function(s,e){if(typeof s=="string"&&(s=U(s)),typeof s=="function"){if(e||(e=s.name),this.__node.graph.get(e))this.__node.graph.get(e).__setOperator(s);else{let t=this.__node.graph.add({__node:{tag:e},__operator:s})}return!0}return!1},setNode:function(s,e){return typeof s=="string"&&(s=U(s)),typeof s=="function"?(e||(e=s.name),this.__node.graph.get(e)?this.__node.graph.get(e).__setOperator(s):this.__node.graph.add({__node:{tag:e},__operator:s}),!0):!1},setMethod:function(s,e,t){return typeof e=="string"&&(e=U(e)),typeof e=="function"?(t||(t=e.name),this.__node.graph.get(s)?this.__node.graph.get(s)[t]=e:this.__node.graph.add({__node:{tag:t,[t]:e}}),!0):!1},assignRoute:function(s,e){this.__node.graph.get(s)&&typeof e=="object"&&Object.assign(this.__node.graph.get(s),e)},transferClass:(s,e)=>{if(typeof s=="object"){let t=s.toString();return{route:"receiveClass",args:[t,e]}}return!1},receiveClass:function(s,e){if(typeof s=="string"&&s.indexOf("class")===0){let t=(0,eval)("("+s+")"),r=e;return r||(r=t.name),this.__node.graph[r]=t,!0}return!1},setGlobal:(s,e)=>(globalThis[s]=e,!0),assignGlobalObject:(s,e)=>globalThis[s]?(typeof e=="object"&&Object.assign(globalThis[s],e),!0):!1,setValue:function(s,e){return this.__node.graph[s]=e,!0},assignObject:function(s,e){return this.__node.graph[s]?(typeof e=="object"&&Object.assign(this.__node.graph[s],e),!0):!1},setGlobalFunction:(s,e)=>(typeof s=="string"&&(s=U(s)),typeof s=="function"?(e||(e=s.name),globalThis[e]=s,!0):!1),assignFunctionToGlobalObject:function(s,e,t){return globalThis[s]?(typeof e=="string"&&(e=U(e)),typeof e=="function"?(t||(t=e.name),this.__node.graph[s][t]=e,!0):!1):!1},setFunction:function(s,e){return typeof s=="string"&&(s=U(s)),typeof s=="function"?(e||(e=s.name),this.__node.graph[e]=s,!0):!1},assignFunctionToObject:function(s,e,t){return this.__node.graph[s]?(typeof e=="string"&&(e=U(e)),typeof e=="function"?(t||(t=e.name),this.__node.graph[s][t]=e,!0):!1):!1}},Tn=Zt(ir()),De=class extends es{constructor(s,e,t){super(s),this.name="http",this.fetchProxied=!1,this.listening={},this.GET=(r="http://localhost:8080/ping",i="",n)=>(i==="json"&&(n="application/json"),new Promise((l,a)=>{let f=De.request({method:"GET",url:r,responseType:i,mimeType:n,onload:u=>{let h;f.responseType===""||f.responseType==="text"?h=f.responseText:h=f.response,r instanceof URL&&(r=r.toString()),this.setState({[r]:h}),l(h)},onabort:u=>{a(u)}})}).catch(console.error)),this.POST=(r,i="http://localhost:8080/echo",n="",l)=>(typeof r=="object"&&(n==="json"||n==="text"||!n)&&(r=JSON.stringify(r)),n==="json"&&(l="application/json"),new Promise((a,f)=>{let u=De.request({method:"POST",url:i,data:r,responseType:n,mimeType:l,onload:h=>{let _;u.responseType===""||u.responseType==="text"?_=u.responseText:_=u.response,i instanceof URL&&(i=i.toString()),this.setState({[i]:_}),a(_)},onabort:h=>{f(h)}})}).catch(console.error)),this.transmit=(r,i)=>{let n=r;return typeof n=="object"&&(r=JSON.stringify(n)),n?.method?.toLowerCase()=="get"||r?.toLowerCase()==="get"?this.GET(i):this.POST(r,i)},this.transponder=(r,i,n="",l)=>{typeof i=="object"&&(i=JSON.stringify(i));let a="GET";if(i&&(a="POST"),n==="json")l="application/json";else return new Promise((f,u)=>{let h=De.request({method:a,url:r,data:i,responseType:n,onload:_=>{let b=h.response;if(typeof b=="string"){let m=b.substring(0,8);(m.includes("{")||m.includes("["))&&(m.includes("\\")&&(b=b.replace(/\\/g,"")),b[0]==='"'&&(b=b.substring(1,b.length-1)),b=JSON.parse(b))}return typeof b?.method=="string"?f(this.handleMethod(b.route,b.method,b.args)):typeof b?.route=="string"?f(this.handleServiceMessage(b)):typeof b?.node=="string"||b.node instanceof F?f(this.handleGraphNodeCall(b.node,b.args)):f(b)},onabort:_=>{u(_)}})}).catch(console.error)},this.listen=(r="0",i=async(n,l,a)=>{let f=await n.text(),u=this.receive(f);this.setState({[a.url]:u})})=>{this.listening[r]={};let n=`${r}${Math.floor(Math.random()*1e15)}`;return this.listening[r][n]=i,this.fetchProxied||(globalThis.fetch=new Proxy(globalThis.fetch,{apply(l,a,f){let u=l.apply(a,f);return u.then(h=>{if(!!h.ok){if(this.listening[0])for(let _ in this.listeners){let b=h.clone();this.listening[0][_](b,f,h)}else for(let _ in this.listening)if(h.url.includes(_)){for(let b in this.listening[r]){let m=h.clone();this.listening[r][b](m,f,h)}break}}}).catch(h=>{console.error(h)}),u}}),this.fetchProxied=!0),n},this.stopListening=(r,i)=>{if(!r&&r!==0)for(let n in this.listening)delete this.listening[n];else i?delete this.listening[i]:delete this.listening[r]},this.setTree(this),this.listen(e,t)}},wr=De;wr.request=s=>{let e=new XMLHttpRequest;return s.responseType?e.responseType=s.responseType:s.responseType="json",s.mimeType&&e.overrideMimeType(s.mimeType),s.onload&&e.addEventListener("load",s.onload,!1),s.onprogress&&e.addEventListener("progress",s.onprogress,!1),s.onabort&&e.addEventListener("abort",s.onabort,!1),s.onloadend&&e.addEventListener("loadend",s.onloadend,!1),s.onerror&&e.addEventListener("error",s.onerror,!1),e.open(s.method,s.url,!0,s.user,s.pass),s.onerror||(e.onerror=function(){e.abort()}),e.send(s.data),e};var ae=Zt(nr()),kr=class extends es{constructor(s){super(),this.name="worker",this.workers={},this.threadRot=0,this.loadWorkerRoute=(e,t)=>{e.workerUrl&&(e.url=e.workerUrl),e.workerId&&(e.__node.tag=e.workerId),e.__node.tag||(e.__node.tag=t),e._id=e.__node.tag;let r;if(this.workers[e._id]?r=this.workers[e._id]:e.worker&&(r=e.worker),!r){r=this.addWorker(e);let i=n=>{n.worker?.terminate()};e.__addOndisconnected(i)}if(e.worker=r,e.transferFunctions)for(let i in e.transferFunctions)this.transferFunction(r,e.transferFunctions[i],i);if(e.transferClasses)for(let i in e.transferClasses)this.transferClass(r,e.transferClasses[i],i);if(r)return e.__operator||(e.__operator=(...i)=>{if(e.callback)if(!this.__node.nodes.get(e.__node.tag)?.__children)r.post(e.callback,i);else return r.run(e.callback,i);else if(!this.__node.nodes.get(e.__node.tag)?.__children)r.send(i);else return r.request(i)}),e.init&&r.run(e.init,e.initArgs,e.initTransfer),r},this.workerloader={workers:(e,t,r,i)=>{let n=e;if(!e.parentRoute&&t?.callback&&t?.worker&&(e.parentRoute=t?.callback),n?.worker||n?.workerId||n?.workerUrl){let l=this.loadWorkerRoute(n,n.__node.tag);l&&(!n.parentRoute&&n.__parent?.callback&&(n.parentRoute=n.__parent.callback),n.__parent&&!n.portId&&(typeof n.__parent=="string"?n.__node.tag!==n.__parent&&l._id!==n.__parent&&(n.portId=this.establishMessageChannel(l,n.__parent)):n.__node.tag!==n.__parent?.__node?.tag&&l._id!==n.__parent.tag&&(n.portId=this.establishMessageChannel(l,n.__parent.worker))),n.parentRoute?(n.stopped||(typeof n.__parent=="string"&&n.__parent===l._id?l.run("subscribe",[n.parentRoute,void 0,n.callback]):n.__node.tag===n.__parent?.__node?.tag||l._id===n.__parent?.__node?.tag?l.run("subscribe",[n.parentRoute,void 0,n.callback]):l.run("subscribeToWorker",[n.parentRoute,n.portId,n.callback,n.blocking]).then(a=>{l.workerSubs[n.parentRoute+n.portId].sub=a})),!(typeof n.__parent=="string"&&n.__parent===l._id)&&!(n.__node.tag===n.__parent?.__node?.tag||l._id===n.__parent?.__node?.tag)&&(l.workerSubs[n.parentRoute+n.portId]={sub:null,route:n.parentRoute,portId:n.portId,callback:n.callback,blocking:n.blocking})):n.__parent&&(typeof n.__parent=="string"?(n.stopped||(n.__parent===l._id?l.run("subscribe",[n.__parent,void 0,n.callback]):l.run("subscribeToWorker",[n.__parent,n.portId,n.callback,n.blocking]).then(a=>{l.workerSubs[n.__parent+n.portId].sub=a})),typeof n.__parent=="string"&&n.__parent===l._id||(l.workerSubs[n+n.portId]={sub:null,route:l._id,portId:n.portId,callback:n.callback,blocking:n.blocking})):n.__parent?.__node?.tag&&n.__parent?.worker&&(n.stopped||(n.__node.tag===n.__parent.__node.tag||l._id===n.__parent.__node.tag?l.run("subscribe",[n.__parent.__node.tag,void 0,n.callback]):l.run("subscribeToWorker",[n.__parent.__node.tag,n.portId,n.callback,n.blocking]).then(a=>{l.workerSubs[n.__parent.__node.tag+n.portId].sub=a})),n.__node.tag===n.__parent?.__node?.tag||l._id===n.__parent?.__node?.tag||(l.workerSubs[n.__parent.__node.tag+n.portId]={sub:null,route:n.__parent.__node.tag,portId:n.portId,callback:n.callback,blocking:n.blocking}))))}else n.__parent&&n.parentRoute&&(console.log(n),typeof n.__parent=="string"&&i[n.__parent]?.worker?i[n.__parent].worker.subscribe(n.parentRoute,n.__operator,n.blocking):n.__parent?.worker&&n.__parent.worker.subscribe(n.parentRoute,n.__operator,n.blocking));return n}},this.addDefaultMessageListener=()=>{globalThis.onmessage=e=>{let t=this.receive(e.data);this.__node.keepState&&this.setState({[this.name]:t})}},this.postMessage=(e,t,r)=>{this.workers[t]?this.workers[t].send(e,r):globalThis.postMessage(e,t,r)},this.addWorker=e=>{let t;if(e._id||(e._id=`worker${Math.floor(Math.random()*1e15)}`),e.url?t=new ae.default(e.url):e.port?t=e.port:this.workers[e._id]&&(this.workers[e._id].port?t=this.workers[e._id].port:t=this.workers[e._id].worker),!t)return;let r=(m,x)=>this.transmit(m,t,x),i=(m,x,o,c)=>{let d={route:m,args:x};return c&&(d.method=c),this.transmit(d,t,o)},n=(m,x,o,c)=>new Promise((d,p)=>{let g=Math.random(),y={route:"runRequest",args:[{route:m,args:x},e._id,g]};c&&(y.args[0].method=c);let v=w=>{typeof w.data=="object"&&w.data.callbackId===g&&(t.removeEventListener("message",v),d(w.data.args))};t.addEventListener("message",v),this.transmit(y,t,o)}),l=(m,x,o)=>new Promise((c,d)=>{let p=Math.random(),g={route:"runRequest",args:[m,e._id,p]};o&&(g.method=o);let y=v=>{typeof v.data=="object"&&v.data.callbackId===p&&(t.removeEventListener("message",y),c(v.data.args))};t.addEventListener("message",y),this.transmit(g,t,x)}),a={},f=(m,x,o)=>this.subscribeToWorker(m,e._id,x,o),u=(m,x)=>n("unsubscribe",[m,x]),h=async(m,x,o,c)=>{if(m)await n("subscribeToWorker",[m,x,o,c]).then(d=>{d&&(a[m+x]={sub:d,route:m,portId:x,callback:o,blocking:c})});else for(let d in a)typeof a[d].sub!="number"&&await n("subscribeToWorker",[a[d].route,a[d].portId,a[d].callback,a[d].blocking]).then(p=>{a[d].sub=p});return!0},_=async(m,x)=>{if(m&&x&&a[m+x])await n("unsubscribe",[m,a[m+x].sub]),a[m+x].sub=!1;else for(let o in a)typeof a[o].sub=="number"&&await n("unpipeWorkers",[a[o].route,a[o].portId,a[o].sub]),a[o].sub=!1;return!0},b=()=>{for(let m in a)typeof a[m].sub=="number"&&n("unpipeWorkers",[a[m].route,a[m].portId,a[m].sub]),a[m].sub=!1;return this.terminate(e._id)};return e.onmessage||(e.onmessage=m=>{this.receive(m.data),this.setState({[e._id]:m.data})}),e.onerror||(e.onerror=m=>{console.error(m.data)}),t.onmessage=e.onmessage,t.onerror=e.onerror,this.workers[e._id]={worker:t,send:r,post:i,run:n,request:l,subscribe:f,unsubscribe:u,terminate:b,start:h,stop:_,postMessage:t.postMessage,workerSubs:a,graph:this,...e},this.workers[e._id]},this.toObjectURL=e=>{let t=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(t)},this.transmit=(e,t,r)=>{if(r||(r=this.getTransferable(e)),t instanceof ae.default||t instanceof MessagePort)t.postMessage(e,r);else if(typeof t=="string")this.workers[t]&&(this.workers[t].port?this.workers[t].port.postMessage(e,r):this.workers[t].worker&&this.workers[t].worker.postMessage(e,r));else{let i=Object.keys(this.workers);this.workers[i[this.threadRot]].worker.postMessage(e,r),this.threadRot++,this.threadRot===i.length&&(this.threadRot=0)}return e},this.terminate=e=>{let t;if(typeof e=="string"){let r=this.workers[e];r&&(delete this.workers[e],e=r.worker,r.onclose&&(t=r.onclose))}return e instanceof ae.default?(e.terminate(),t&&t(e),!0):e instanceof MessagePort?(e.close(),t&&t(e),!0):!1},this.establishMessageChannel=(e,t)=>{let r;if(typeof e=="string"?(r=e,this.workers[e]&&(this.workers[e].port?e=this.workers[e].port:t=this.workers[e].worker)):e?.worker&&(e=e.worker),typeof t=="string"?this.workers[t]&&(this.workers[t].port?t=this.workers[t].port:t=this.workers[t].worker):t?.worker&&(t=t.worker),e instanceof ae.default||e instanceof MessagePort){let i=new MessageChannel,n=`port${Math.floor(Math.random()*1e15)}`;return e.postMessage({route:"addWorker",args:{port:i.port1,_id:n}},[i.port1]),t instanceof ae.default||t instanceof MessagePort?t.postMessage({route:"addWorker",args:{port:i.port2,_id:n}},[i.port2]):r&&this.workers[r]&&(i.port2.onmessage=this.workers[r].onmessage,this.workers[r].port=i.port2),n}return!1},this.request=(e,t,r,i)=>{let n=this.workers[t].worker;return new Promise((l,a)=>{let f=Math.random(),u={route:"runRequest",args:[e,f]};i&&(u.method=i);let h=_=>{typeof _.data=="object"&&_.data.callbackId===f&&(n.removeEventListener("message",h),l(_.data.args))};n.addEventListener("message",h),this.transmit(u,n,r)})},this.runRequest=(e,t,r)=>{let i=this.receive(e);return typeof t=="string"&&this.workers[t]&&(this.workers[t].port?t=this.workers[t].port:t=this.workers[t].worker),i instanceof Promise?i.then(n=>{t instanceof ae.default||t instanceof MessagePort?t.postMessage({args:n,callbackId:r}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&globalThis.postMessage({args:n,callbackId:r})}):t instanceof ae.default||t instanceof MessagePort?t.postMessage({args:i,callbackId:r}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&globalThis.postMessage({args:i,callbackId:r}),i},this.subscribeWorker=(e,t,r,i,n)=>{let l;if(r){let a=!1;l=f=>{a||(a=!0,f instanceof Promise?f.then(u=>{t?.run&&t.run("triggerSubscription",[e,t._id,u]).then(h=>{a=!1})}):t?.run&&t.run("triggerSubscription",[e,t._id,f]).then(u=>{a=!1}))}}else l=a=>{a instanceof Promise?a.then(f=>{t?.postMessage?t.postMessage({args:f,callbackId:e}):globalThis.postMessage&&globalThis.postMessage({args:f,callbackId:e})}):t?.postMessage?t.postMessage({args:a,callbackId:e}):globalThis.postMessage&&globalThis.postMessage({args:a,callbackId:e})};return!r&&t?.port?t=t.port:!r&&t?.worker?t=t.worker:typeof t=="string"&&this.workers[t]&&(r?t=this.workers[t]:this.workers[t].port?t=this.workers[t].port:t=this.workers[t].worker),this.subscribe(e,l,i,n)},this.subscribeToWorker=(e,t,r,i,n,l)=>{if(typeof t=="string"&&this.workers[t])return this.__node.state.subscribeTrigger(t,a=>{a?.callbackId===e&&(r?typeof r=="string"?this.run(r,a.args):r(a.args):this.setState({[t]:a.args}))}),this.workers[t].run("subscribeWorker",[e,t,i,n,l])},this.triggerSubscription=async(e,t,r)=>{if(this.__node.state.triggers[t])for(let i=0;i<this.__node.state.triggers[t].length;i++)await this.__node.state.triggers[t][i].onchange({args:r,callbackId:e});return!0},this.pipeWorkers=(e,t,r,i,n,l)=>(typeof e=="string"&&(e=this.workers[e]),typeof t=="string"&&(t=this.workers[t]),n||(n=this.establishMessageChannel(e.worker,t.worker)),t.run("subscribeToWorker",[r,n,i,l])),this.unpipeWorkers=(e,t,r)=>{if(typeof t=="string"&&(t=this.workers[t]),t)return t.run("unsubscribe",[e,r])},this.connections={workers:this.workers},s?.services&&this.addServices(s.services),this.setTree(this),this.setLoaders(this.workerloader),s&&this.init(s),typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope&&this.addDefaultMessageListener()}getTransferable(s){let e;if(typeof s=="object")if(s.args)if(s.args?.constructor?.name==="Object")for(let t in s.args)ArrayBuffer.isView(s.args[t])?e?e.push(s.args[t].buffer):e=[s.args[t].buffer]:s.args[t]?.constructor?.name==="ArrayBuffer"&&(e?e.push(s.args[t]):e=[s.args[t]]);else Array.isArray(s.args)&&s.args.length<11?s.args.forEach(t=>{ArrayBuffer.isView(t)?e=[t.buffer]:t?.constructor?.name==="ArrayBuffer"&&(e=[t])}):ArrayBuffer.isView(s.args)?e=[s.args.buffer]:s.args?.constructor?.name==="ArrayBuffer"&&(e=[s]);else if(s?.constructor?.name==="Object")for(let t in s)ArrayBuffer.isView(s[t])?e?e.push(s[t].buffer):e=[s[t].buffer]:s[t]?.constructor?.name==="ArrayBuffer"&&(e?e.push(s[t]):e=[s[t]]);else Array.isArray(s)&&s.length<11?s.forEach(t=>{ArrayBuffer.isView(t)?e=[t.buffer]:t.constructor?.name==="ArrayBuffer"&&(e=[t])}):ArrayBuffer.isView(s)?e=[s.buffer]:s.constructor?.name==="ArrayBuffer"&&(e=[s]);return e}transferFunction(s,e,t){return t||(t=e.name),s.request({route:"setRoute",args:[e.toString(),t]})}transferClass(s,e,t){return t||(t=e.name),s.request({route:"receiveClass",args:[e.toString(),t]})}},he=yt(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY"]),Sr=yt(["deltaX","deltaY"]),xr=yt(["ctrlKey","metaKey","shiftKey","keyCode"]);function Ar(s,e){s.preventDefault(),Sr(s,e)}function Or(s){s.preventDefault()}function Cr(s,e,t){for(let r of e)t[r]=s[r]}function yt(s){return function(t,r){let i={type:t.type};Cr(t,s,i),r(i)}}function st(s,e){let t=[],r={type:s.type,touches:t};for(let i=0;i<s.touches.length;++i){let n=s.touches[i];t.push({pageX:n.pageX,pageY:n.pageY})}e(r)}var Nr={37:!0,38:!0,39:!0,40:!0};function Er(s,e){let{keyCode:t}=s;Nr[t]&&(s.preventDefault(),xr(s,e))}var Tr={contextmenu:Or,mousedown:he,mousemove:he,mouseup:he,pointerdown:he,pointermove:he,pointerup:he,touchstart:st,touchmove:st,touchend:st,wheel:Ar,keydown:Er};function bt(s,e,t){t||(t="proxy"+Math.floor(Math.random()*1e15));let r=l=>{e?e.postMessage({route:"handleProxyEvent",args:[l,t]}):ts(l,t)},i=Object.entries(Tr);for(let[l,a]of i)s.addEventListener(l,function(f){a(f,r)});let n=()=>{let l=s.getBoundingClientRect();r({type:"resize",left:l.left,top:l.top,width:s.clientWidth,height:s.clientHeight})};return n(),globalThis.addEventListener("resize",n),t}var Pr=class{addEventListener(s,e){this.__listeners===void 0&&(this.__listeners={});let t=this.__listeners;t[s]===void 0&&(t[s]=[]),t[s].indexOf(e)===-1&&t[s].push(e)}hasEventListener(s,e){if(this.__listeners===void 0)return!1;let t=this.__listeners;return t[s]!==void 0&&t[s].indexOf(e)!==-1}removeEventListener(s,e){if(this.__listeners===void 0)return;let r=this.__listeners[s];if(r!==void 0){let i=r.indexOf(e);i!==-1&&r.splice(i,1)}}dispatchEvent(s,e){if(this.__listeners===void 0)return;let r=this.__listeners[s.type];if(r!==void 0){e?s.target=e:s.target=this;let i=r.slice(0);for(let n=0,l=i.length;n<l;n++)i[n].call(this,s);s.target=null}}};function Vt(){}var jr=class extends Pr{constructor(){super(),this.__listeners={},this.style={},this.setPointerCapture=()=>{},this.releasePointerCapture=()=>{},this.getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}),this.handleEvent=s=>{s.type==="resize"&&(this.left=s.left,this.top=s.top,this.width=s.width,this.height=s.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),s.preventDefault=Vt,s.stopPropagation=Vt,this.dispatchEvent(s,this.proxied)},this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}},Ue=class{constructor(){this.targets={},this.makeProxy=(s,e=void 0)=>{s||(s=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let t;this.targets[s]?t=this.targets[s]:(t=new jr,this.targets[s]=t),typeof e=="object"&&(e.proxy=t,t.proxied=e,typeof WorkerGlobalScope<"u"&&(e.style=t.style),t.width&&(e.style.width=t.width+"px",e.clientWidth=t.width),t.height&&(e.style.height=t.height+"px",e.clientHeight=t.height),e.setPointerCapture=t.setPointerCapture.bind(t),e.releasePointerCapture=t.releasePointerCapture.bind(t),e.getBoundingClientRect=t.getBoundingClientRect.bind(t),e.addEventListener=t.addEventListener.bind(t),e.removeEventListener=t.removeEventListener.bind(t),e.handleEvent=t.handleEvent.bind(t),e.dispatchEvent=t.dispatchEvent.bind(t),e.focus=t.focus.bind(t))},this.getProxy=s=>this.targets[s],this.handleEvent=(s,e)=>{if(this.targets[e]||this.makeProxy(e),this.targets[e])return this.targets[e].handleEvent(s),!0},globalThis.document||(globalThis.document={})}};function Lr(s,e){return this?.__node?.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new Ue),this.__node.graph.ProxyManager.makeProxy(s,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new Ue),globalThis.ProxyManager.makeProxy(s,e)),s}function ts(s,e){if(this?.__node?.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new Ue),this.__node.graph.ProxyManager.handleEvent(s,e))return s}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new Ue),globalThis.ProxyManager.handleEvent(s,e))return s}var _t={initProxyElement:bt,makeProxy:Lr,handleProxyEvent:ts};function Ir(s){if(s.worker){let e=s.worker,t=s.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete s.worker,delete s.route,ss(e,s,t)}else return bt(s.canvas,void 0,s._id),rs(s)}function ss(s,e,t){if(!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let r=e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let i={route:t||"setupCanvas",args:{...e,canvas:r}};this?.__node?.graph?this.__node.graph.run("initProxyElement",e.canvas,s,e._id):bt(e.canvas,s,e._id),e.draw&&(typeof e.draw=="function"?i.args.draw=e.draw.toString():i.args.draw=e.draw),e.update&&(typeof e.update=="function"?i.args.update=e.update.toString():i.args.update=e.update),e.init&&(typeof e.init=="function"?i.args.init=e.init.toString():i.args.init=e.init),e.clear&&(typeof e.clear=="function"?i.args.clear=e.clear.toString():i.args.clear=e.clear);let n=[r];return e.transfer&&(n.push(...e.transfer),delete e.transfer),s.postMessage(i,n),{_id:e._id,width:e.width,height:e.height,worker:s,draw:a=>{s.postMessage({route:"drawFrame",args:[a,e._id]})},update:a=>{s.postMessage({route:"updateCanvas",args:[a,e._id]})},clear:()=>{s.postMessage({route:"clearCanvas",args:e._id})},init:()=>{s.postMessage({route:"initCanvas",args:e._id})},stop:()=>{s.postMessage({route:"stopAnim",args:e._id})},start:()=>{s.postMessage({route:"startAnim",args:e._id})},set:a=>{s.postMessage({route:"setDraw",args:[a,e._id]})},terminate:()=>{s.terminate()}}}function Re(s,e){let t;if(this?.__node?.graph?e?t=this.__node.graph.CANVASES?.[s._id]:s._id?t=this.__node.graph.CANVASES?.[s._id]:t=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e||s._id?t=globalThis.CANVASES?.[s._id]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t)return s.canvas&&(t.canvas=s.canvas,this?.__node?.graph?this.__node.graph.run("makeProxy",t._id,t.canvas):_t.makeProxy(t._id,t.canvas)),typeof s.context=="string"?t.context=t.canvas.getContext(s.context):s.context&&(t.context=s.context),s.width&&(t.canvas.width=s.width),s.height&&(t.canvas.height=s.height),typeof s.draw=="string"&&(s.draw=H(s.draw)),typeof s.draw=="function"&&(t.draw=s.draw),typeof s.update=="string"&&(s.update=H(s.update)),typeof s.update=="function"&&(t.update=s.update),typeof s.init=="string"&&(s.init=H(s.init)),typeof s.init=="function"&&(t.init=s.init),typeof s.clear=="string"&&(s.clear=H(s.clear)),typeof s.clear=="function"&&(t.clear=s.clear),s._id}function rs(s){this?.__node?.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=s;if(s._id?e._id=s._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof s.context=="string"?e.context=s.canvas.getContext(s.context):e.context=s.context,"animating"in s?e.animating=s.animating:e.animating=!0,this?.__node?.graph?.CANVASES[e._id])this.__node.graph.run("setDraw",e);else if(globalThis.CANVASES?.[e._id])Re(e);else if(this?.__node?.graph&&(e.graph=this.__node.graph),this?.__node?.graph?this.__node.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,this?.__node.graph?this.__node.graph.run("makeProxy",e._id,e.canvas):_t.makeProxy(e._id,e.canvas),s.width&&(e.canvas.width=s.width),s.height&&(e.canvas.height=s.height),typeof e.draw=="string"?e.draw=H(e.draw):typeof e.draw=="function"&&(e.draw=e.draw),typeof e.update=="string"?e.update=H(e.update):typeof e.update=="function"&&(e.update=e.update),typeof e.init=="string"?e.init=H(e.init):typeof e.init=="function"&&(e.init=e.init),typeof e.clear=="string"?e.clear=H(e.clear):typeof e.clear=="function"&&(e.clear=e.clear),typeof e.init=="function"&&e.init(e,e.canvas,e.context),e.stop=()=>{Ve(e._id)},e.start=t=>{ot(e._id,t)},e.set=t=>{Re(t,e._id)},typeof e.draw=="function"&&e.animating){let t=(r,i,n)=>{r.animating&&(r.draw(r,i,n),requestAnimationFrame(()=>{t(r,i,n)}))};t(e,e.canvas,e.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?e._id:{_id:s._id,width:s.width,height:s.height,draw:r=>{is(r,s._id)},update:r=>{os(r,s._id)},clear:()=>{ns(s._id)},init:()=>{as(s._id)},stop:()=>{Ve(s._id)},start:()=>{ot(s._id)},set:r=>{Re(r,s._id)},terminate:()=>{Ve(s._id)}}}function is(s,e){let t;if(this?.__node?.graph?e?t=this.__node.graph.CANVASES?.[e]:t=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e?t=globalThis.CANVASES?.[e]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t&&(s&&Object.assign(t,s),t.draw))return t.draw(t,t.canvas,t.context),e}function ns(s){let e;if(this?.__node?.graph?s?e=this.__node.graph.CANVASES?.[s]:e=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:s?e=globalThis.CANVASES?.[s]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e?.clear)return e.clear(e,e.canvas,e.context),s}function as(s){let e;if(this?.__node?.graph?s?e=this.__node.graph.CANVASES?.[s]:e=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:s?e=globalThis.CANVASES?.[s]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e?.init)return e.init(e,e.canvas,e.context),s}function os(s,e){let t;if(this?.__node?.graph?e?t=this.__node.graph.CANVASES?.[e]:t=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e?t=globalThis.CANVASES?.[e]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t?.update)return t.update(t,t.canvas,t.context,s),e}function Br(s,e){let t;if(this?.__node?.graph?e?t=this.__node.graph.CANVASES?.[e]:t=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e?t=globalThis.CANVASES?.[e]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t)return Object.assign(t,s),s.width&&(t.canvas.width=s.width),s.height&&(t.canvas.height=s.height),e}function ot(s,e){let t;if(this?.__node?.graph?s?t=this.__node.graph.CANVASES?.[s]:t=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:s?t=globalThis.CANVASES?.[s]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t.animating=!0,t&&e)return typeof e=="string"&&(e=H(e)),typeof e=="function"&&(t.draw=e),s;if(typeof t?.draw=="function"){let r=(i,n,l)=>{i.animating&&(i.draw(i,n,l),requestAnimationFrame(()=>{r(i,n,l)}))};return typeof t.clear=="function"&&t.clear(t,t.canvas,t.context),typeof t.init=="function"&&t.init(t,t.canvas,t.context),r(t,t.canvas,t.context),s}}function Ve(s){let e;if(this?.__node?.graph?s?e=this.__node.graph.CANVASES?.[s]:e=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:s?e=globalThis.CANVASES?.[s]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e)return e.animating=!1,typeof e.clear=="function"&&e.clear(e,e.canvas,e.context),s}var Mr={..._t,Renderer:Ir,transferCanvas:ss,setupCanvas:rs,setDraw:Re,drawFrame:is,clearCanvas:ns,initCanvas:as,updateCanvas:os,setProps:Br,startAnim:ot,stopAnim:Ve};function H(s=""){let e=l=>l.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),r=(l=>{let a=l.indexOf("=>")+1;return a<=0&&(a=l.indexOf("){")),a<=0&&(a=l.indexOf(") {")),l.slice(0,l.indexOf("{",a)+1)})(s),i=e(s),n;if(r.includes("function")){let l=r.split("(")[1].split(")")[0];n=new Function(l,i)}else if(r.substring(0,6)===i.substring(0,6)){let l=r.split("(")[1].split(")")[0];n=new Function(l,i.substring(i.indexOf("{")+1,i.length-1))}else try{n=(0,eval)(r+i+"}")}catch{}return n}var Je={},Fr=s=>Object.assign(Je,s);function Dr(s,e){let t={_id:s._id?s._id:`algorithm${Math.floor(Math.random()*1e15)}`,ondata:s.ondata,run:r=>t.ondata(t,r)};return s.structs&&We(t,JSON.parse(JSON.stringify(s.structs))),e&&We(t,JSON.parse(JSON.stringify(e))),s.oncreate&&(t.oncreate=s.oncreate),t.oncreate&&t.oncreate(t),t}var We=(s,e)=>{for(let t in e)typeof e[t]=="object"&&!Array.isArray(e[t])?typeof s[t]=="object"&&!Array.isArray(s[t])?We(s[t],e[t]):s[t]=We({},e[t]):s[t]=e[t];return s},Rr={...mr,loadAlgorithms:Fr,initSubprocesses:async function(e,t){if(t||(t=this.__node.graph),!!t){for(let r in e){let i=e[r];if(!i.worker&&i.url&&(i.worker=t.addWorker({url:i.url})),!i.worker)continue;let n=i.worker,l;if(l=t.establishMessageChannel(n.worker,i.source?.worker),i.source||(i.source=t),typeof i.subprocess=="object"){let a=i.subprocess;if(!a.name)continue;typeof a.oncreate=="function"&&(a.oncreate=a.oncreate.toString()),typeof a.ondata=="function"&&(a.ondata=a.ondata.toString()),i.worker.post("addSubprocessTemplate",[a.name,a.structs,a.oncreate,a.ondata,a.props]),i.subprocess=a.name}if(i.init){let a=await n.run(i.init,i.initArgs);i.otherArgs=a}if(i.otherArgs&&n.run("setValue",["otherArgsProxy",Array.isArray(i.otherArgs)?i.otherArgs:[i.otherArgs]]),i.pipeTo){if(n.run("setValue",["routeProxy",i.route]),n.run("setValue",["pipeRoute",i.pipeTo.route]),i.url&&!i.pipeTo.worker){let a=t.addWorker({url:i.url});i.pipeTo.portId=t.establishMessageChannel(n.worker,a.worker),i.pipeTo.worker=a}i.pipeTo.init&&(i.pipeTo.otherArgs=await i.pipeTo.worker.run(i.pipeTo.init,i.pipeTo.initArgs)),n.run("setValue",["pipePort",i.pipeTo.portId]),i.pipeTo.otherArgs&&n.run("setValue",["otherPipeArgs",i.pipeTo.otherArgs]),t.transferFunction(n,function(f){let u=f;this.__node.graph.otherArgsProxy&&(u=[f,...this.__node.graph.otherArgsProxy]);let h=this.__node.graph.run(this.__node.graph.routeProxy,u);if(!i.blocking)return new Promise(_=>{if(h instanceof Promise)h.then(b=>{if(b!==void 0){let m=b;this.__node.graph.otherPipeArgs&&(m=[b,...this.__node.graph.otherPipeArgs]),this.workers[this.__node.graph.pipePort]&&(i.blocking=!0,this.workers[this.__node.graph.pipePort].run(this.__node.graph.pipeRoute,m).then(x=>{i.blocking=!1,_(x)}))}});else if(h!==void 0){let b=h;this.__node.graph.otherPipeArgs&&(b=[h,...this.__node.graph.otherPipeArgs]),this.workers[this.__node.graph.pipePort]&&(i.blocking=!0,this.workers[this.__node.graph.pipePort].run(this.__node.graph.pipeRoute,b).then(m=>{i.blocking=!1,_(m)}))}})},i.route+"_pipeResults"),i.route=i.route+"_pipeResults"}else n.run("setValue",["routeProxy",i.route]),t.transferFunction(n,function(f){let u;return this.__node.graph.otherArgsProxy?u=this.__node.graph.nodes.get(this.__node.graph.routeProxy).__operator(f,...this.__node.graph.otherArgsProxy):u=this.__node.graph.nodes.get(this.__node.graph.routeProxy).__operator(f),this.__node.graph.state.triggers[this.__node.graph.routeProxy]&&(u instanceof Promise?u.then(h=>{this.setState({[this.__node.graph.routeProxy]:h})}):this.setState({[this.__node.graph.routeProxy]:u})),u},i.route+"_routeProxy"),i.route=i.route+"_routeProxy",i.stopped||n.run("subscribeToWorker",[i.subscribeRoute,l,i.route]).then(a=>{i.sub=a});i.stop=async()=>{if(i.source&&typeof i.sub=="number")return i.source.unsubscribe(i.subscribeRoute,i.sub),!0},i.start=async()=>{if(typeof i.sub!="number")return n.run("subscribeToWorker",[i.subscribeRoute,l,i.route,i.blocking]).then(a=>{i.sub=a})},i.setArgs=async a=>{if(Array.isArray(a))await n.run("setValue",["otherArgsProxy",a]);else if(typeof a=="object")for(let f in a)await n.run("setValue",[f,a[f]]);return!0},i.terminate=()=>{n.terminate(),i.source?.worker&&typeof i.sub=="number"&&i.source.post("unsubscribe",i.sub),i.pipeTo?.worker&&i.pipeTo.worker.terminate()},i.callback&&n.subscribe(i.route,a=>{typeof i.callback=="string"?this.__node.graph.run(i.callback,a):i.callback(a)})}return e}},addSubprocessTemplate:function(e,t,r,i,n){if(typeof r=="string"&&(r=U(r)),typeof i=="string"&&(i=U(i)),typeof i=="function")return Je[e]={ondata:i,oncreate:typeof r=="function"?r:null,structs:t},typeof n=="object"&&Object.assign(Je[e],n),!0},updateSubprocess:function(e,t){this.__node.graph.ALGORITHMS||(this.__node.graph.ALGORITHMS={}),t||(t=Object.keys(this.__node.graph.ALGORITHMS)[0]),t&&Object.assign(this.__node.graph.ALGORITHMS[t],e)},createSubprocess:function(e,t){if(this.__node.graph.ALGORITHMS||(this.__node.graph.ALGORITHMS={}),typeof e=="string"&&(e=Je[e]),typeof e=="object"){typeof e.ondata=="string"&&(e.ondata=U(e.ondata));let r;if(typeof e?.ondata=="function"&&(r=Dr(e,t)),r&&(this.__node.graph.ALGORITHMS[r._id]=r),console.log(r,e),r)return r._id}return!1},runSubprocess:function(e,t){if(this.__node.graph.ALGORITHMS||(this.__node.graph.ALGORITHMS={}),t||(t=Object.keys(this.__node.graph.ALGORITHMS)[0]),!t)return;let r=this.__node.graph.ALGORITHMS[t].run(e);if(r!==void 0)if(Array.isArray(r)){let i=[];if(r.forEach(n=>{n!==void 0&&(i.push(n),this.__node.graph.setState({[t]:n}))}),i.length>0)return i}else return this.__node.graph.setState({[t]:r}),r}},Vr=URL.createObjectURL(new Blob([String(`(()=>{var __require=(x=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof require!=="undefined"?require:a)[b]}):x)(function(x){if(typeof require!=="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+x+'" is not supported')});var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __require2=(x=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof __require!=="undefined"?__require:a)[b]}):x)(function(x){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw new Error('Dynamic require of "'+x+'" is not supported')});var __commonJS=(cb,mod)=>function __require22(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod));var require_sjcl=__commonJS({"services/e2ee/sjcl.js"(exports,module){"use strict";var sjcl2={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};sjcl2.cipher.aes=function(a){this.s[0][0][0]||this.O();var b,c,d,e,f=this.s[0][4],g=this.s[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl2.exception.invalid("invalid aes key size");this.b=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&255]]};sjcl2.cipher.aes.prototype={encrypt:function(a){return t(this,a,0)},decrypt:function(a){return t(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var a=this.s[0],b=this.s[1],c=a[4],d=b[4],e,f,g,h=[],k=[],l,n,m,p;for(e=0;256>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,c[f]=m,d[m]=f,n=h[e=h[l=h[f]]],p=16843009*n^65537*e^257*l^16843008*f,n=257*h[m]^16843008*m,e=0;4>e;e++)a[e][f]=n=n<<24^n>>>8,b[e][m]=p=p<<24^p>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};function t(a,b,c){if(4!==b.length)throw new sjcl2.exception.invalid("invalid aes block size");var d=a.b[c],e=b[0]^d[0],f=b[c?3:1]^d[1],g=b[2]^d[2];b=b[c?1:3]^d[3];var h,k,l,n=d.length/4-2,m,p=4,r=[0,0,0,0];h=a.s[c];a=h[0];var q=h[1],v=h[2],w=h[3],x=h[4];for(m=0;m<n;m++)h=a[e>>>24]^q[f>>16&255]^v[g>>8&255]^w[b&255]^d[p],k=a[f>>>24]^q[g>>16&255]^v[b>>8&255]^w[e&255]^d[p+1],l=a[g>>>24]^q[b>>16&255]^v[e>>8&255]^w[f&255]^d[p+2],b=a[b>>>24]^q[e>>16&255]^v[f>>8&255]^w[g&255]^d[p+3],p+=4,e=h,f=k,g=l;for(m=0;4>m;m++)r[c?3&-m:m]=x[e>>>24]<<24^x[f>>16&255]<<16^x[g>>8&255]<<8^x[b&255]^d[p++],h=e,e=f,f=g,g=b,b=h;return r}sjcl2.bitArray={bitSlice:function(a,b,c){a=sjcl2.bitArray.$(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl2.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl2.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl2.bitArray.$(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+sjcl2.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b=b&31;0<c&&b&&(a[c-1]=sjcl2.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl2.bitArray.bitLength(a)!==sjcl2.bitArray.bitLength(b))return false;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},$:function(a,b,c,d){var e;e=0;for(void 0===d&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl2.bitArray.getPartial(e);d.push(sjcl2.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},i:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(c&65280)<<8|c<<24;return a}};sjcl2.codec.utf8String={fromBits:function(a){var b="",c=sjcl2.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl2.bitArray.partial(8*(c&3),d));return b}};sjcl2.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl2.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\\s|0x/g,"");d=a.length;a=a+"00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl2.bitArray.clamp(c,4*d)}};sjcl2.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d=sjcl2.codec.base32.BASE,e=sjcl2.codec.base32.REMAINING,f="",g=0,h=sjcl2.codec.base32.B,k=0,l=sjcl2.bitArray.bitLength(a);c&&(h=sjcl2.codec.base32.X);for(c=0;f.length*d<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d?(k=a[c]<<d-g,g+=e,c++):(k<<=d,g-=d);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\\s|=/g,"").toUpperCase();var c=sjcl2.codec.base32.BITS,d=sjcl2.codec.base32.BASE,e=sjcl2.codec.base32.REMAINING,f=[],g,h=0,k=sjcl2.codec.base32.B,l=0,n,m="base32";b&&(k=sjcl2.codec.base32.X,m="base32hex");for(g=0;g<a.length;g++){n=k.indexOf(a.charAt(g));if(0>n){if(!b)try{return sjcl2.codec.base32hex.toBits(a)}catch(p){}throw new sjcl2.exception.invalid("this isn't "+m+"!")}h>e?(h-=e,f.push(l^n>>>h),l=n<<c-h):(h+=d,l^=n<<c-h)}h&56&&f.push(sjcl2.bitArray.partial(h&56,l,1));return f}};sjcl2.codec.base32hex={fromBits:function(a,b){return sjcl2.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl2.codec.base32.toBits(a,1)}};sjcl2.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl2.codec.base64.B,g=0,h=sjcl2.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\\s|=/g,"");var c=[],d,e=0,f=sjcl2.codec.base64.B,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d=0;d<a.length;d++){h=f.indexOf(a.charAt(d));if(0>h)throw new sjcl2.exception.invalid("this isn't base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl2.bitArray.partial(e&56,g,1));return c}};sjcl2.codec.base64url={fromBits:function(a){return sjcl2.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl2.codec.base64.toBits(a,1)}};sjcl2.hash.sha256=function(a){this.b[0]||this.O();a?(this.F=a.F.slice(0),this.A=a.A.slice(0),this.l=a.l):this.reset()};sjcl2.hash.sha256.hash=function(a){return new sjcl2.hash.sha256().update(a).finalize()};sjcl2.hash.sha256.prototype={blockSize:512,reset:function(){this.F=this.Y.slice(0);this.A=[];this.l=0;return this},update:function(a){"string"===typeof a&&(a=sjcl2.codec.utf8String.toBits(a));var b,c=this.A=sjcl2.bitArray.concat(this.A,a);b=this.l;a=this.l=b+sjcl2.bitArray.bitLength(a);if(9007199254740991<a)throw new sjcl2.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d=new Uint32Array(c),e=0;for(b=512+b-(512+b&511);b<=a;b+=512)u(this,d.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&511);b<=a;b+=512)u(this,c.splice(0,16));return this},finalize:function(){var a,b=this.A,c=this.F,b=sjcl2.bitArray.concat(b,[sjcl2.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.l/4294967296));for(b.push(this.l|0);b.length;)u(this,b.splice(0,16));this.reset();return c},Y:[],b:[],O:function(){function a(a2){return 4294967296*(a2-Math.floor(a2))|0}for(var b=0,c=2,d,e;64>b;c++){e=true;for(d=2;d*d<=c;d++)if(0===c%d){e=false;break}e&&(8>b&&(this.Y[b]=a(Math.pow(c,.5))),this.b[b]=a(Math.pow(c,1/3)),b++)}}};function u(a,b){var c,d,e,f=a.F,g=a.b,h=f[0],k=f[1],l=f[2],n=f[3],m=f[4],p=f[5],r=f[6],q=f[7];for(c=0;64>c;c++)16>c?d=b[c]:(d=b[c+1&15],e=b[c+14&15],d=b[c&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+b[c&15]+b[c+9&15]|0),d=d+q+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(r^m&(p^r))+g[c],q=r,r=p,p=m,m=n+d|0,n=l,l=k,k=h,h=d+(k&l^n&(k^l))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+k|0;f[2]=f[2]+l|0;f[3]=f[3]+n|0;f[4]=f[4]+m|0;f[5]=f[5]+p|0;f[6]=f[6]+r|0;f[7]=f[7]+q|0}sjcl2.mode.ccm={name:"ccm",G:[],listenProgress:function(a){sjcl2.mode.ccm.G.push(a)},unListenProgress:function(a){a=sjcl2.mode.ccm.G.indexOf(a);-1<a&&sjcl2.mode.ccm.G.splice(a,1)},fa:function(a){var b=sjcl2.mode.ccm.G.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl2.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d=d||[];if(7>k)throw new sjcl2.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sjcl2.mode.ccm.V(a,b,c,d,e,f);g=sjcl2.mode.ccm.C(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl2.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl2.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl2.mode.ccm.C(a,k,c,l,e,b);a=sjcl2.mode.ccm.V(a,k.data,c,d,e,b);if(!f.equal(k.tag,a))throw new sjcl2.exception.corrupt("ccm: tag doesn't match");return k.data},na:function(a,b,c,d,e,f){var g=[],h=sjcl2.bitArray,k=h.i;d=[h.partial(8,(b.length?64:0)|d-2<<2|f-1)];d=h.concat(d,c);d[3]|=e;d=a.encrypt(d);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d=a.encrypt(k(d,g.slice(b,b+4).concat([0,0,0])));return d},V:function(a,b,c,d,e,f){var g=sjcl2.bitArray,h=g.i;e/=8;if(e%2||4>e||16<e)throw new sjcl2.exception.invalid("ccm: invalid tag length");if(4294967295<d.length||4294967295<b.length)throw new sjcl2.exception.bug("ccm: can't deal with 4GiB or more data");c=sjcl2.mode.ccm.na(a,d,c,e,g.bitLength(b)/8,f);for(d=0;d<b.length;d+=4)c=a.encrypt(h(c,b.slice(d,d+4).concat([0,0,0])));return g.clamp(c,8*e)},C:function(a,b,c,d,e,f){var g,h=sjcl2.bitArray;g=h.i;var k=b.length,l=h.bitLength(b),n=k/50,m=n;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!k)return{tag:d,data:[]};for(g=0;g<k;g+=4)g>n&&(sjcl2.mode.ccm.fa(g/k),n+=m),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,l)}}};sjcl2.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(128!==sjcl2.bitArray.bitLength(c))throw new sjcl2.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl2.mode.ocb2.S,k=sjcl2.bitArray,l=k.i,n=[0,0,0,0];c=h(a.encrypt(c));var m,p=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),n=l(n,m),p=p.concat(l(c,a.encrypt(l(c,m)))),c=h(c);m=b.slice(g);b=k.bitLength(m);g=a.encrypt(l(c,[0,0,0,b]));m=k.clamp(l(m.concat([0,0,0]),g),b);n=l(n,l(m.concat([0,0,0]),g));n=a.encrypt(l(n,l(c,h(c))));d.length&&(n=l(n,f?d:sjcl2.mode.ocb2.pmac(a,d)));return p.concat(k.concat(m,k.clamp(n,e)))},decrypt:function(a,b,c,d,e,f){if(128!==sjcl2.bitArray.bitLength(c))throw new sjcl2.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl2.mode.ocb2.S,h=sjcl2.bitArray,k=h.i,l=[0,0,0,0],n=g(a.encrypt(c)),m,p,r=sjcl2.bitArray.bitLength(b)-e,q=[];d=d||[];for(c=0;c+4<r/32;c+=4)m=k(n,a.decrypt(k(n,b.slice(c,c+4)))),l=k(l,m),q=q.concat(m),n=g(n);p=r-32*c;m=a.encrypt(k(n,[0,0,0,p]));m=k(m,h.clamp(b.slice(c),p).concat([0,0,0]));l=k(l,m);l=a.encrypt(k(l,k(n,g(n))));d.length&&(l=k(l,f?d:sjcl2.mode.ocb2.pmac(a,d)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl2.exception.corrupt("ocb: tag doesn't match");return q.concat(h.clamp(m,p))},pmac:function(a,b){var c,d=sjcl2.mode.ocb2.S,e=sjcl2.bitArray,f=e.i,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d(h)),c=e.concat(c,[-2147483648,0,0,0]));g=f(g,c);return a.encrypt(f(d(f(h,d(h))),g))},S:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl2.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl2.bitArray;d=d||[];a=sjcl2.mode.gcm.C(true,a,f,d,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl2.bitArray,h=g.bitLength(f);e=e||128;d=d||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl2.mode.gcm.C(false,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl2.exception.corrupt("gcm: tag doesn't match");return a.data},ka:function(a,b){var c,d,e,f,g,h=sjcl2.bitArray.i;e=[0,0,0,0];f=b.slice(0);for(c=0;128>c;c++){(d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d=3;0<d;d--)f[d]=f[d]>>>1|(f[d-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-520093696)}return e},j:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4)b[0]^=4294967295&c[d],b[1]^=4294967295&c[d+1],b[2]^=4294967295&c[d+2],b[3]^=4294967295&c[d+3],b=sjcl2.mode.gcm.ka(b,a);return b},C:function(a,b,c,d,e,f){var g,h,k,l,n,m,p,r,q=sjcl2.bitArray;m=c.length;p=q.bitLength(c);r=q.bitLength(d);h=q.bitLength(e);g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl2.mode.gcm.j(g,[0,0,0,0],e),e=sjcl2.mode.gcm.j(g,e,[0,0,Math.floor(h/4294967296),h&4294967295]));h=sjcl2.mode.gcm.j(g,[0,0,0,0],d);n=e.slice(0);d=h.slice(0);a||(d=sjcl2.mode.gcm.j(g,h,c));for(l=0;l<m;l+=4)n[3]++,k=b.encrypt(n),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p);a&&(d=sjcl2.mode.gcm.j(g,h,c));a=[Math.floor(r/4294967296),r&4294967295,Math.floor(p/4294967296),p&4294967295];d=sjcl2.mode.gcm.j(g,d,a);k=b.encrypt(e);d[0]^=k[0];d[1]^=k[1];d[2]^=k[2];d[3]^=k[3];return{tag:q.bitSlice(d,0,f),data:c}}};sjcl2.misc.hmac=function(a,b){this.W=b=b||sjcl2.hash.sha256;var c=[[],[]],d,e=b.prototype.blockSize/32;this.w=[new b,new b];a.length>e&&(a=b.hash(a));for(d=0;d<e;d++)c[0][d]=a[d]^909522486,c[1][d]=a[d]^1549556828;this.w[0].update(c[0]);this.w[1].update(c[1]);this.R=new b(this.w[0])};sjcl2.misc.hmac.prototype.encrypt=sjcl2.misc.hmac.prototype.mac=function(a){if(this.aa)throw new sjcl2.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl2.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]);this.aa=false};sjcl2.misc.hmac.prototype.update=function(a){this.aa=true;this.R.update(a)};sjcl2.misc.hmac.prototype.digest=function(){var a=this.R.finalize(),a=new this.W(this.w[1]).update(a).finalize();this.reset();return a};sjcl2.misc.pbkdf2=function(a,b,c,d,e){c=c||1e4;if(0>d||0>c)throw new sjcl2.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl2.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl2.codec.utf8String.toBits(b));e=e||sjcl2.misc.hmac;a=new e(a);var f,g,h,k,l=[],n=sjcl2.bitArray;for(k=1;32*l.length<(d||1);k++){e=f=a.encrypt(n.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d&&(l=n.clamp(l,d));return l};sjcl2.prng=function(a){this.c=[new sjcl2.hash.sha256];this.m=[0];this.P=0;this.H={};this.N=0;this.U={};this.Z=this.f=this.o=this.ha=0;this.b=[0,0,0,0,0,0,0,0];this.h=[0,0,0,0];this.L=void 0;this.M=a;this.D=false;this.K={progress:{},seeded:{}};this.u=this.ga=0;this.I=1;this.J=2;this.ca=65536;this.T=[0,48,64,96,128,192,256,384,512,768,1024];this.da=3e4;this.ba=80};sjcl2.prng.prototype={randomWords:function(a,b){var c=[],d;d=this.isReady(b);var e;if(d===this.u)throw new sjcl2.exception.notReady("generator isn't seeded");if(d&this.J){d=!(d&this.I);e=[];var f=0,g;this.Z=e[0]=new Date().valueOf()+this.da;for(g=0;16>g;g++)e.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(e=e.concat(this.c[g].finalize()),f+=this.m[g],this.m[g]=0,d||!(this.P&1<<g));g++);this.P>=1<<this.c.length&&(this.c.push(new sjcl2.hash.sha256),this.m.push(0));this.f-=f;f>this.o&&(this.o=f);this.P++;this.b=sjcl2.hash.sha256.hash(this.b.concat(e));this.L=new sjcl2.cipher.aes(this.b);for(d=0;4>d&&(this.h[d]=this.h[d]+1|0,!this.h[d]);d++);}for(d=0;d<a;d+=4)0===(d+1)%this.ca&&y(this),e=z(this),c.push(e[0],e[1],e[2],e[3]);y(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl2.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=new Date().valueOf(),g=this.H[c],h=this.isReady(),k=0;d=this.U[c];void 0===d&&(d=this.U[c]=this.ha++);void 0===g&&(g=this.H[c]=0);this.H[c]=(this.H[c]+1)%this.c.length;switch(typeof a){case"number":void 0===b&&(b=1);this.c[g].update([d,this.N++,1,b,f,1,a|0]);break;case"object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e=e>>>1;this.c[g].update([d,this.N++,2,b,f,a.length].concat(a))}break;case"string":void 0===b&&(b=a.length);this.c[g].update([d,this.N++,3,b,f,a.length]);this.c[g].update(a);break;default:k=1}if(k)throw new sjcl2.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.f+=b;h===this.u&&(this.isReady()!==this.u&&A("seeded",Math.max(this.o,this.f)),A("progress",this.getProgress()))},isReady:function(a){a=this.T[void 0!==a?a:this.M];return this.o&&this.o>=a?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=a?this.J|this.u:this.u},getProgress:function(a){a=this.T[a?a:this.M];return this.o>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.D){this.a={loadTimeCollector:B(this,this.ma),mouseCollector:B(this,this.oa),keyboardCollector:B(this,this.la),accelerometerCollector:B(this,this.ea),touchCollector:B(this,this.qa)};if(window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,false),window.addEventListener("mousemove",this.a.mouseCollector,false),window.addEventListener("keypress",this.a.keyboardCollector,false),window.addEventListener("devicemotion",this.a.accelerometerCollector,false),window.addEventListener("touchmove",this.a.touchCollector,false);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new sjcl2.exception.bug("can't attach event");this.D=true}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,false),window.removeEventListener("mousemove",this.a.mouseCollector,false),window.removeEventListener("keypress",this.a.keyboardCollector,false),window.removeEventListener("devicemotion",this.a.accelerometerCollector,false),window.removeEventListener("touchmove",this.a.touchCollector,false)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=false)},addEventListener:function(a,b){this.K[a][this.ga++]=b},removeEventListener:function(a,b){var c,d,e=this.K[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},la:function(){C(this,1)},oa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");C(this,0)},qa:function(a){a=a.touches[0]||a.changedTouches[0];this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");C(this,0)},ma:function(){C(this,2)},ea:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");C(this,0)}};function A(a,b){var c,d=sjcl2.random.K[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function C(a,b){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?a.addEntropy(window.performance.now(),b,"loadtime"):a.addEntropy(new Date().valueOf(),b,"loadtime")}function y(a){a.b=z(a).concat(z(a));a.L=new sjcl2.cipher.aes(a.b)}function z(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.L.encrypt(a.h)}function B(a,b){return function(){b.apply(a,arguments)}}sjcl2.random=new sjcl2.prng(6);a:try{if(G="undefined"!==typeof module&&module.exports){try{H=__require2("crypto")}catch(a){H=null}G=E=H}if(G&&E.randomBytes)D=E.randomBytes(128),D=new Uint32Array(new Uint8Array(D).buffer),sjcl2.random.addEntropy(D,1024,"crypto['randomBytes']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){F=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(F);else break a;sjcl2.random.addEntropy(F,1024,"crypto['getRandomValues']")}}catch(a){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}var D;var E;var F;var G;var H;sjcl2.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl2.json,f=e.g({iv:sjcl2.random.randomWords(4,0)},e.defaults),g;e.g(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl2.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl2.codec.base64.toBits(f.iv));if(!sjcl2.mode[f.mode]||!sjcl2.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)throw new sjcl2.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl2.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl2.ecc&&a instanceof sjcl2.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl2.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl2.codec.utf8String.toBits(c));g=new sjcl2.cipher[f.cipher](a);e.g(d,f);d.key=a;f.ct="ccm"===f.mode&&sjcl2.arrayBuffer&&sjcl2.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl2.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl2.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d){var e=sjcl2.json,f=e.ja.apply(e,arguments);return e.encode(f)},ia:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl2.json;b=e.g(e.g(e.g({},e.defaults),b),c,true);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl2.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl2.codec.base64.toBits(b.iv));if(!sjcl2.mode[b.mode]||!sjcl2.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl2.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl2.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl2.ecc&&a instanceof sjcl2.ecc.elGamal.secretKey&&(a=a.unkem(sjcl2.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl2.codec.utf8String.toBits(f));g=new sjcl2.cipher[b.cipher](a);f="ccm"===b.mode&&sjcl2.arrayBuffer&&sjcl2.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl2.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl2.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e.g(d,b);d.key=a;return 1===c.raw?f:sjcl2.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d){var e=sjcl2.json;return e.ia(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl2.exception.invalid("json encode: invalid property name");c+=d+'"'+b+'":';d=",";switch(typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+='"'+escape(a[b])+'"';break;case"object":c+='"'+sjcl2.codec.base64.fromBits(a[b],0)+'"';break;default:throw new sjcl2.exception.bug("json encode: unsupported type")}}return c+"}"},decode:function(a){a=a.replace(/\\s/g,"");if(!a.match(/^\\{.*\\}$/))throw new sjcl2.exception.invalid("json decode: this isn't json!");a=a.replace(/^\\{|\\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^\\s*(?:(["']?)([a-z][a-z0-9]*)\\1)\\s*:\\s*(?:(-?\\d+)|"([a-z0-9+\\/%*_.@=\\-]*)"|(true|false))$/i)))throw new sjcl2.exception.invalid("json decode: this isn't json!");null!=d[3]?b[d[2]]=parseInt(d[3],10):null!=d[4]?b[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?sjcl2.codec.base64.toBits(d[4]):unescape(d[4]):null!=d[5]&&(b[d[2]]="true"===d[5])}return b},g:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d in b)if(b.hasOwnProperty(d)){if(c&&void 0!==a[d]&&a[d]!==b[d])throw new sjcl2.exception.invalid("required parameter overridden");a[d]=b[d]}return a},sa:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},ra:function(a,b){var c={},d;for(d=0;d<b.length;d++)void 0!==a[b[d]]&&(c[b[d]]=a[b[d]]);return c}};sjcl2.encrypt=sjcl2.json.encrypt;sjcl2.decrypt=sjcl2.json.decrypt;sjcl2.misc.pa={};sjcl2.misc.cachedPbkdf2=function(a,b){var c=sjcl2.misc.pa,d;b=b||{};d=b.iter||1e3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl2.random.randomWords(2,0)};c=void 0===b.salt?d.firstSalt:b.salt;d[c]=d[c]||sjcl2.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};"undefined"!==typeof module&&module.exports&&(module.exports=sjcl2);"function"===typeof define&&define([],function(){return sjcl2})}});var require_browser=__commonJS({"node_modules/web-worker/cjs/browser.js"(exports,module){module.exports=Worker}});var EventHandler=class{constructor(data){this.pushToState={};this.data={};this.triggers={};this.setState=updateObj=>{Object.assign(this.data,updateObj);for(const prop of Object.getOwnPropertyNames(updateObj)){if(this.triggers[prop])this.triggers[prop].forEach(obj=>obj.onchange(this.data[prop]))}return this.data};this.setValue=(key,value)=>{this.data[key]=value;if(this.triggers[key])this.triggers[key].forEach(obj=>obj.onchange(this.data[key]))};this.subscribeTrigger=(key,onchange)=>{if(key){if(!this.triggers[key]){this.triggers[key]=[]}let l=this.triggers[key].length;this.triggers[key].push({sub:l,onchange});return this.triggers[key].length-1}else return void 0};this.unsubscribeTrigger=(key,sub)=>{let triggers=this.triggers[key];if(triggers){if(!sub)delete this.triggers[key];else{let sub2=void 0;let obj=triggers.find((o,i)=>{if(o.sub===sub2){sub2=i;return true}});if(obj)triggers.splice(sub2,1);if(this.onRemoved)this.onRemoved(obj);return true}}};this.subscribeTriggerOnce=(key,onchange)=>{let sub;let changed=value=>{onchange(value);this.unsubscribeTrigger(key,sub)};sub=this.subscribeTrigger(key,changed)};this.getTrigger=(key,sub)=>{for(const s in this.triggers[key]){if(this.triggers[key][s].sub===sub)return this.triggers[key][s]}};if(typeof data==="object")this.data=data}};var state=new EventHandler;var GraphNode=class{constructor(properties,parent2,graph){this.__node={tag:\`node\${Math.floor(Math.random()*1e15)}\`,unique:\`\${Math.random()}\`,state};this.__subscribe=(callback,key,subInput,bound,target)=>{const subscribeToFunction=(k,setTarget=(callback2,target2)=>callback2,triggerCallback=callback)=>{let sub=this.__node.state.subscribeTrigger(k,triggerCallback);let trigger=this.__node.state.getTrigger(k,sub);trigger.source=this.__node.tag;if(key)trigger.key=key;trigger.target=setTarget(callback);if(bound)trigger.bound=bound;return sub};const subscribeToGraph=callback2=>{let fn=this.__node.graph.get(callback2);if(!fn&&callback2.includes(".")){let n=this.__node.graph.get(callback2.substring(0,callback2.lastIndexOf(".")));let key2=callback2.substring(callback2.lastIndexOf(".")+1);if(n&&typeof n[key2]==="function")callback2=(...args)=>{return n[key2](...args)}}};if(key){if(!this.__node.localState){this.__addLocalState(this)}if(typeof callback==="string"){if(typeof this[callback]==="function")callback=this[callback];else if(this.__node.graph)subscribeToGraph(callback)}let sub;let k=subInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key;if(typeof callback==="function")sub=subscribeToFunction(k);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,state2=>{if(callback.__operator)callback.__operator(state2)});return sub}else{if(typeof callback==="string"){if(this.__node.graph)callback=this.__node.graph.get(callback);else callback=this.__node.graph.nodes.get(callback)}let sub;let k=subInput?this.__node.unique+"input":this.__node.unique;if(typeof callback==="function")sub=subscribeToFunction(k);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,state2=>{if(callback.__operator)callback.__operator(state2)});return sub}};this.__unsubscribe=(sub,key,subInput)=>{if(key){return this.__node.state.unsubscribeTrigger(subInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key,sub)}else return this.__node.state.unsubscribeTrigger(subInput?this.__node.unique+"input":this.__node.unique,sub)};this.__setOperator=fn=>{fn=fn.bind(this);this.__operator=(...args)=>{if(this.__node.inputState)this.__node.state.setValue(this.__node.unique+"input",args);let result=fn(...args);if(this.__node.state.triggers[this.__node.unique]){if(typeof result?.then==="function"){result.then(res=>{if(res!==void 0)this.__node.state.setValue(this.__node.unique,res)}).catch(console.error)}else if(result!==void 0)this.__node.state.setValue(this.__node.unique,result)}return result};if(!this.__subscribedToParent){if(this.__parent instanceof GraphNode&&this.__parent.__operator){let sub=this.__parent.__subscribe(this);let ondelete=()=>{this.__parent?.__unsubscribe(sub);delete this.__subscribedToParent};this.__addOndisconnected(ondelete);this.__subscribedToParent=true}}return this.__operator};this.__proxyObject=obj=>{let allProps=getAllProperties(obj);for(const k of allProps){if(typeof this[k]==="undefined"){if(typeof obj[k]==="function"){this[k]=(...args)=>{if(this.__node.inputState)this.__node.state.setValue(this.__node.unique+"."+k+"input",args);let result=obj[k](...args);if(this.__node.state.triggers[this.__node.unique+"."+k]){if(typeof result?.then==="function"){result.then(res=>{this.__node.state.setValue(this.__node.unique+"."+k,res)}).catch(console.error)}else this.__node.state.setValue(this.__node.unique+"."+k,result)}return result}}else{let definition={get:()=>{return obj[k]},set:value=>{obj[k]=value;if(this.__node.state.triggers[this.__node.unique+"."+k])this.__node.state.setValue(this.__node.unique+"."+k,value)},enumerable:true,configurable:true};Object.defineProperty(this,k,definition)}}}};let orig=properties;if(typeof properties==="function"){properties={__operator:properties,__node:{forward:true,tag:properties.name}}}else if(typeof properties==="string"){if(graph?.get(properties)){properties=graph.get(properties)}}if(!properties.__node.initial)properties.__node.initial=orig;if(typeof properties==="object"){if(properties.__props){if(typeof properties.__props==="function")properties.__props=new properties.__props;if(typeof properties.__props==="object"){this.__proxyObject(properties.__props)}}if(typeof properties.__node==="string"){if(graph?.get(properties.__node.tag)){properties=graph.get(properties.__node.tag)}else properties.__node={}}else if(!properties.__node)properties.__node={};if(!properties.__parent&&parent2)properties.__parent=parent2;if(graph){properties.__node.graph=graph}if(properties.__operator){if(typeof properties.__operator==="string"){if(graph){let n=graph.get(properties.__operator);if(n)properties.__operator=n.__operator;if(!properties.__node.tag&&properties.__operator.name)properties.__node.tag=properties.__operator.name}}if(typeof properties.__operator==="function")properties.__operator=this.__setOperator(properties.__operator)}if(!properties.__node.tag){if(properties.__operator?.name)properties.__node.tag=properties.__operator.name;else properties.__node.tag=\`node\${Math.floor(Math.random()*1e15)}\`}if(parent2?.__node&&!(parent2 instanceof Graph||properties instanceof Graph))properties.__node.tag=parent2.__node.tag+"."+properties.__node.tag;if(parent2 instanceof Graph&&properties instanceof Graph){if(properties.__node.loaders)Object.assign(parent2.__node.loaders?parent2.__node.loaders:{},properties.__node.loaders);if(parent2.__node.mapGraphs){properties.__node.nodes.forEach(n=>{parent2.set(properties.__node.tag+"."+n.__node.tag,n)});let ondelete=()=>{properties.__node.nodes.forEach(n=>{parent2.__node.nodes.delete(properties.__node.tag+"."+n.__node.tag)})};this.__addOndisconnected(ondelete)}}properties.__node=Object.assign(this.__node,properties.__node);let keys=Object.getOwnPropertyNames(properties);for(const key of keys){this[key]=properties[key]}if(typeof properties.default==="function"&&!properties.__operator){let fn=properties.default.bind(this);this.default=(...args)=>{if(this.__node.inputState)this.__node.state.setValue(this.__node.unique+"input",args);let result=fn(...args);if(typeof result?.then==="function"){result.then(res=>{if(res!==void 0)this.__node.state.setValue(this.__node.unique,res)}).catch(console.error)}else if(result!==void 0)this.__node.state.setValue(this.__node.unique,result);return result};properties.default=this.default}if(properties instanceof Graph)this.__node.source=properties}}__addLocalState(props){if(!props)return;if(!this.__node.localState){this.__node.localState={}}let localState=this.__node.localState;for(let k in props){if(this.__props&&this.__props[k])continue;if(typeof props[k]==="function"){if(!k.startsWith("_")){let fn=props[k].bind(this);props[k]=(...args)=>{if(this.__node.inputState)this.__node.state.setValue(this.__node.unique+"."+k+"input",args);let result=fn(...args);if(typeof result?.then==="function"){if(this.__node.state.triggers[this.__node.unique+"."+k])result.then(res=>{this.__node.state.setValue(this.__node.unique+"."+k,res)}).catch(console.error)}else if(this.__node.state.triggers[this.__node.unique+"."+k])this.__node.state.setValue(this.__node.unique+"."+k,result);return result};this[k]=props[k]}}else{localState[k]=props[k];let definition={get:()=>{return localState[k]},set:v=>{localState[k]=v;if(this.__node.state.triggers[this.__node.unique+"."+k])this.__node.state.setValue(this.__node.unique+"."+k,v)},enumerable:true,configurable:true};Object.defineProperty(this,k,definition);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,definition)}}}}}__addOnconnected(callback){if(Array.isArray(this.__ondisconnected)){this.__onconnected.push(callback)}else if(typeof this.__onconnected==="function"){this.__onconnected=[callback,this.__onconnected]}else this.__onconnected=callback}__addOndisconnected(callback){if(Array.isArray(this.__ondisconnected)){this.__ondisconnected.push(callback)}else if(typeof this.__ondisconnected==="function"){this.__ondisconnected=[callback,this.__ondisconnected]}else this.__ondisconnected=callback}__callConnected(node=this){if(typeof this.__onconnected==="function"){this.__onconnected(this)}else if(Array.isArray(this.__onconnected)){this.__onconnected.forEach(o=>{o(this)})}}__callDisconnected(node=this){if(typeof this.__ondisconnected==="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){this.__ondisconnected.forEach(o=>{o(this)})}}};var Graph=class{constructor(options){this.__node={tag:\`graph\${Math.floor(Math.random()*1e15)}\`,nodes:new Map,state};this.init=options2=>{if(options2){recursivelyAssign(this.__node,options2);if(options2.tree)this.setTree(options2.tree)}};this.setTree=tree=>{this.__node.tree=Object.assign(this.__node.tree?this.__node.tree:{},tree);let cpy=Object.assign({},tree);if(cpy.__node)delete cpy.__node;let listeners=this.recursiveSet(cpy,this,void 0,tree);if(tree.__node){if(!tree.__node.tag)tree.__node._tag=\`tree\${Math.floor(Math.random()*1e15)}\`;else if(!this.get(tree.__node.tag)){let node=new GraphNode(tree,this,this);this.set(node.__node.tag,node);for(const l in this.__node.loaders){if(typeof this.__node.loaders[l]==="object"){if(this.__node.loaders[l].init)this.__node.loaders[l](node,parent,this,this.__node.tree,tree);if(this.__node.loaders[l].connected)node.__addOnconnected(this.__node.loaders[l].connect);if(this.__node.loaders[l].disconnected)node.__addOndisconnected(this.__node.loaders[l].disconnect)}else if(typeof this.__node.loaders==="function")this.__node.loaders[l](node,this,this,tree,tree,tree.__node.tag)}if(node.__listeners){listeners[node.__node.tag]=node.__listeners}}}else if(tree.__listeners){this.setListeners(tree.__listeners)}this.setListeners(listeners);return cpy};this.setLoaders=(loaders2,replace)=>{if(replace)this.__node.loaders=loaders2;else Object.assign(this.__node.loaders,loaders2);return this.__node.loaders};this.add=(properties,parent2)=>{let listeners={};if(typeof parent2==="string")parent2=this.get(parent2);if(typeof properties==="function")properties={__operator:properties};else if(typeof properties==="string")properties=this.__node.tree[properties];let p=Object.assign({},properties);if(!p.__node)p.__node={};p.__node.initial=properties;if(typeof properties==="object"&&(!p?.__node?.tag||!this.get(p.__node.tag))){let node=new GraphNode(p,parent2,this);this.set(node.__node.tag,node);for(const l in this.__node.loaders){if(typeof this.__node.loaders[l]==="object"){if(this.__node.loaders[l].init)this.__node.loaders[l](node,parent2,this,this.__node.tree,properties,node.__node.tag);if(this.__node.loaders[l].connected)node.__addOnconnected(this.__node.loaders[l].connect);if(this.__node.loaders[l].disconnected)node.__addOndisconnected(this.__node.loaders[l].disconnect)}else if(typeof this.__node.loaders==="function")this.__node.loaders[l](node,parent2,this,this.__node.tree,properties,node.__node.tag)}this.__node.tree[node.__node.tag]=properties;if(node.__listeners){listeners[node.__node.tag]=node.__listeners}if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}this.setListeners(listeners);node.__callConnected();return node}return};this.recursiveSet=(t,parent2,listeners={},origin)=>{let keys=Object.getOwnPropertyNames(origin);for(const key of keys){if(key.includes("__"))continue;let p=origin[key];if(Array.isArray(p))continue;if(typeof p==="function")p={__operator:p};else if(typeof p==="string")p=this.__node.tree[p];else if(typeof p==="boolean")p=this.__node.tree[key];if(typeof p==="object"){p=Object.assign({},p);if(!p.__node)p.__node={};if(!p.__node.tag)p.__node.tag=key;p.__node.initial=t[key];if(this.get(p.__node.tag)&&!(parent2?.__node&&this.get(parent2.__node.tag+"."+p.__node.tag))||parent2?.__node&&this.get(parent2.__node.tag+"."+p.__node.tag))continue;let node=new GraphNode(p,parent2,this);this.set(node.__node.tag,node);for(const l in this.__node.loaders){this.__node.loaders[l](node,parent2,this,t,t[key],key)}t[key]=node;this.__node.tree[node.__node.tag]=p;if(node.__listeners){listeners[node.__node.tag]=node.__listeners}if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}node.__callConnected()}}return listeners};this.remove=(node,clearListeners=true)=>{this.unsubscribe(node);if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){this.delete(node.__node.tag);delete this.__node.tree[node.__node.tag];if(clearListeners){this.clearListeners(node)}node.__callDisconnected();const recursiveRemove=t=>{for(const key in t){this.unsubscribe(t[key]);this.delete(t[key].__node.tag);delete this.__node.tree[t[key].__node.tag];this.delete(key);delete this.__node.tree[key];t[key].__node.tag=t[key].__node.tag.substring(t[key].__node.tag.lastIndexOf(".")+1);if(clearListeners){this.clearListeners(t[key])}t[key].__callDisconnected();if(t[key].__children){recursiveRemove(t[key].__children)}}};if(node.__children){recursiveRemove(node.__children)}}if(node?.__node.tag&&node?.__parent){delete node?.__parent;node.__node.tag=node.__node.tag.substring(node.__node.tag.indexOf(".")+1)}return node};this.run=(node,...args)=>{if(typeof node==="string"){let nd=this.get(node);if(!nd&&node.includes(".")){nd=this.get(node.substring(0,node.lastIndexOf(".")));if(typeof nd?.[node.substring(node.lastIndexOf(".")+1)]==="function")return nd[node.substring(node.lastIndexOf(".")+1)](...args)}else if(nd?.__operator)return nd.__operator(...args)}if(node?.__operator){return node?.__operator(...args)}};this.setListeners=listeners=>{for(const key in listeners){let node=this.get(key);if(typeof listeners[key]==="object"){for(const k in listeners[key]){let n=this.get(k);let sub;if(typeof listeners[key][k]!=="object")listeners[key][k]={__callback:listeners[key][k]};else if(!listeners[key][k].__callback){for(const kk in listeners[key][k]){if(typeof listeners[key][k][kk]!=="object"){listeners[key][k][kk]={__callback:listeners[key][k][kk]};if(listeners[key][k][kk].__callback===true)listeners[key][k][kk].__callback=node.__operator}let nn=this.get(kk);if(nn){if(!nn){let tag=k.substring(0,k.lastIndexOf("."));nn=this.get(tag);if(n){sub=this.subscribe(nn,listeners[key][k][kk].__callback,k.substring(k.lastIndexOf(".")+1),listeners[key][k][kk].inputState,key,k);if(typeof node.__listeners[k][kk]!=="object")node.__listeners[k][kk]={__callback:listeners[key][k][kk].__callback,inputState:listeners[key][k][kk]?.inputState};node.__listeners[k][kk].sub=sub}}else{sub=this.subscribe(nn,listeners[key][k][kk].__callback,void 0,listeners[key][k].inputState,key,k);if(typeof node.__listeners[k][kk]!=="object")node.__listeners[k][kk]={__callback:listeners[key][k][kk].__callback,inputState:listeners[key][k][kk]?.inputState};node.__listeners[k][kk].sub=sub}}}}if(listeners[key][k].__callback){if(listeners[key][k].__callback===true)listeners[key][k].__callback=node.__operator;if(typeof listeners[key][k].__callback==="function")listeners[key][k].__callback=listeners[key][k].__callback.bind(node);if(typeof node.__listeners!=="object")node.__listeners={};if(!n){let tag=k.substring(0,k.lastIndexOf("."));n=this.get(tag);if(n){sub=this.subscribe(n,listeners[key][k].__callback,k.substring(k.lastIndexOf(".")+1),listeners[key][k].inputState,key,k);if(typeof node.__listeners[k]!=="object")node.__listeners[k]={__callback:listeners[key][k].__callback,inputState:listeners[key][k]?.inputState};node.__listeners[k].sub=sub}}else{sub=this.subscribe(n,listeners[key][k].__callback,void 0,listeners[key][k].inputState,key,k);if(typeof node.__listeners[k]!=="object")node.__listeners[k]={__callback:listeners[key][k].__callback,inputState:listeners[key][k]?.inputState};node.__listeners[k].sub=sub}}}}}};this.clearListeners=(node,listener)=>{if(typeof node==="string")node=this.get(node);if(node?.__listeners){for(const key in node.__listeners){if(listener&&key!==listener)continue;if(typeof node.__listeners[key].sub!=="number")continue;let n=this.get(key);if(!n){n=this.get(key.substring(0,key.lastIndexOf(".")));if(n){if(!node.__listeners[key].__callback){for(const k in node.__listeners[key]){this.unsubscribe(n,node.__listeners[key][k].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key][k].inputState)}}else this.unsubscribe(n,node.__listeners[key].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key].inputState)}}else{if(!node.__listeners[key].__callback){for(const k in node.__listeners[key]){this.unsubscribe(n,node.__listeners[key][k].sub,void 0,node.__listeners[key][k].inputState)}}else this.unsubscribe(n,node.__listeners[key].sub,void 0,node.__listeners[key].inputState)}delete node.__listeners[key]}}};this.get=tag=>{return this.__node.nodes.get(tag)};this.set=(tag,node)=>{return this.__node.nodes.set(tag,node)};this.delete=tag=>{return this.__node.nodes.delete(tag)};this.getProps=(node,getInitial)=>{if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){let cpy;if(getInitial)cpy=Object.assign({},this.__node.tree[node.__node.tag]);else{cpy=Object.assign({},node);delete cpy.__unsubscribe;delete cpy.__setOperator;delete cpy.__node;delete cpy.__subscribeState;delete cpy.__subscribe}}};this.subscribe=(node,callback,key,subInput,target,bound)=>{let nd=node;if(!(node instanceof GraphNode))nd=this.get(node);let sub;if(typeof callback==="string"){if(target){let method=this.get(target)?.[callback];if(typeof method==="function")callback=method}else callback=this.get(callback)?.__operator}if(nd instanceof GraphNode){sub=nd.__subscribe(callback,key,subInput,target,bound);let ondelete=()=>{nd.__unsubscribe(sub,key,subInput)};nd.__addOndisconnected(ondelete)}else if(typeof node==="string"){if(this.get(node)){if(callback instanceof GraphNode&&callback.__operator){sub=this.get(node).__subscribe(callback.__operator,key,subInput,target,bound);let ondelete=()=>{this.get(node).__unsubscribe(sub)};callback.__addOndisconnected(ondelete)}else if(typeof callback==="function"||typeof callback==="string"){sub=this.get(node).__subscribe(callback,key,subInput,target,bound);this.__node.state.getTrigger(this.get(node).__node.unique,sub).source=node}}else{if(typeof callback==="string")callback=this.__node.nodes.get(callback).__operator;if(typeof callback==="function")sub=this.__node.state.subscribeTrigger(node,callback)}}return sub};this.unsubscribe=(node,sub,key,subInput)=>{if(node instanceof GraphNode){return node.__unsubscribe(sub,key,subInput)}else return this.get(node)?.__unsubscribe(sub,key,subInput)};this.setState=update=>{this.__node.state.setState(update)};this.init(options)}};function recursivelyAssign(target,obj){for(const key in obj){if(obj[key]?.constructor.name==="Object"&&!Array.isArray(obj[key])){if(target[key]?.constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign(target[key],obj[key]);else target[key]=recursivelyAssign({},obj[key])}else{target[key]=obj[key]}}return target}function getAllProperties(obj){var allProps=[],curr=obj;do{var props=Object.getOwnPropertyNames(curr);props.forEach(function(prop){if(allProps.indexOf(prop)===-1)allProps.push(prop)})}while(curr=Object.getPrototypeOf(curr));return allProps}var backprop=(node,parent2,graph)=>{if(node.__node.backward&&parent2 instanceof GraphNode){graph.setListeners({[parent2.__node.tag]:{[node.__node.tag]:parent2}})}};var loop=(node,parent2,graph)=>{if(node.__operator&&!node.__node.looperSet){node.__node.looperSet=true;if(typeof node.__node.delay==="number"){let fn=node.__operator;node.__operator=(...args)=>{return new Promise((res,rej)=>{setTimeout(async()=>{res(await fn(...args))},node.__node.delay)})}}else if(node.__node.frame===true){let fn=node.__operator;node.__operator=(...args)=>{return new Promise((res,rej)=>{requestAnimationFrame(async()=>{res(await fn(...args))})})}}if(typeof node.__node.repeat==="number"||typeof node.__node.recursive==="number"){let fn=node.__operator;node.__operator=async(...args)=>{let i=node.__node.repeat?node.__node.repeat:node.__node.recursive;let result;let repeater=async(tick,...inp)=>{while(tick>0){if(node.__node.delay||node.__node.frame){fn(...inp).then(async res=>{if(node.__node.recursive){await repeater(tick,res)}else await repeater(tick,...inp)});break}else result=await fn(...args);tick--}};await repeater(i,...args);return result}}if(node.__node.loop&&typeof node.__node.loop==="number"){let fn=node.__operator;node.__operator=(...args)=>{if(!("looping"in node.__node))node.__node.looping=true;if(node.__node.looping){fn(...args);setTimeout(()=>{node.__operator(...args)},node.__node.loop)}};if(node.__node.looping)node.__operator();let ondelete=node2=>{if(node2.__node.looping)node2.__node.looping=false};node.__addOndisconnected(ondelete)}}};var animate=(node,parent2,graph)=>{if(node.__node.animate===true||node.__animation){let fn=node.__operator;node.__operator=(...args)=>{if(!("animating"in node.__node))node.__node.animating=true;if(node.__node.animating){if(typeof node.__animation==="function")node.__animation(...args);else fn(...args);requestAnimationFrame(()=>{node.__operator(...args)})}};if(node.__node.animating||(!("animating"in node.__node)||node.__node.animating)&&node.__animation)setTimeout(()=>{requestAnimationFrame(node.__operator())},10);let ondelete=node2=>{if(node2.__node.animating)node2.__node.animating=false};node.__addOndisconnected(ondelete)}};var branching=(node,parent2,graph)=>{if(typeof node.__node.branch==="object"&&node.__operator&&!node.__node.branchApplied){let fn=node.__operator;node.__node.branchApplied=true;node.__operator=(...args)=>{let result=fn(...args);for(const key in node.__node.branch){let triggered=()=>{if(typeof node.__node.branch[key].then==="function"){node.__node.branch[key].then(result)}else if(node.__node.branch[key].then instanceof GraphNode&&node.__node.branch[key].then.__operator){node.__node.branch[key].then.__operator(result)}else result=node.__node.branch[key].then};if(typeof node.__node.branch[key].if==="function"){if(node.__node.branch[key].if(result)){triggered()}}else if(node.__node.branch[key].if===result){triggered()}}return result}}if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].branch&&!node.__listeners[key].branchApplied){let fn=node.__listeners[key].callback;node.__listeners[key].branchApplied=true;node.__listeners.callback=ret=>{let triggered=()=>{if(typeof node.__listeners[key].branch.then==="function"){ret=node.__listeners[key].branch.then(ret)}else if(node.__listeners[key].branch.then instanceof GraphNode&&node.__listeners[key].branch.then.__operator){ret=node.__listeners[key].branch.then.__operator(ret)}else ret=node.__listeners[key].branch.then};if(typeof node.__listeners[key].branch.if==="function"){if(node.__listeners[key].branch.if(ret)){triggered()}}else if(node.__listeners[key].branch.if===ret){triggered()}return fn(ret)}}}}}};var triggerListenerOncreate=(node,parent2,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].oncreate){node.__listeners[key].callback(node.__listeners[key].oncreate)}}}}};var bindListener=(node,parent2,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].binding==="object"){node.__listeners.callback=node.__listeners.callback.bind(node.__listeners[key].binding)}}}}};var transformListenerResult=(node,parent2,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].transform==="function"&&!node.__listeners[key].transformApplied){let fn=node.__listeners[key].callback;node.__listeners[key].transformApplied=true;node.__listeners.callback=ret=>{ret=node.__listeners[key].transform(ret);return fn(ret)}}}}}};var substitute__operator=(node,parent2,graph)=>{if(node.post&&!node.__operator){node.__setOperator(node.post)}else if(!node.__operator&&typeof node.get=="function"){node.__setOperator(node.get)}if(!node.get&&node.__operator){node.get=node.__operator}if(node.aliases){node.aliases.forEach(a=>{graph.set(a,node);let ondelete=node2=>{graph.__node.nodes.delete(a)};node.__addOndisconnected(ondelete)})}if(typeof graph.__node.tree[node.__node.tag]==="object"&&node.get)graph.__node.tree[node.__node.tag].get=node.get};var loaders={backprop,loop,animate,branching,triggerListenerOncreate,bindListener,transformListenerResult,substitute__operator};var Service=class extends Graph{constructor(options){super({...options,loaders:options?.loaders?Object.assign({...loaders},options.loaders):{...loaders}});this.name=\`service\${Math.floor(Math.random()*1e15)}\`;this.addServices=services=>{for(const s in services){if(typeof services[s]==="function")services[s]=new services[s];if(services[s]?.__node?.loaders)Object.assign(this.__node.loaders,services[s].__node.loaders);if(services[s]?.__node?.nodes){services[s].__node.nodes.forEach((n,tag)=>{if(!this.get(tag)){this.set(tag,n)}else this.set(s+"."+tag,n)});this.__node.nodes.forEach((n,k)=>{if(!services[s].__node.nodes.get(k))services[s].__node.nodes.set(k,n)});let set=this.set;this.set=(tag,node)=>{services[s].set(tag,node);return set(tag,node)};let del=this.delete;this.delete=tag=>{services[s].delete(tag);return del(tag)}}else if(typeof services[s]==="object"){this.setTree(services[s])}}};this.handleMethod=(route,method,args)=>{let m=method.toLowerCase();let src=this.__node.nodes.get(route);if(!src){src=this.__node.tree[route]}if(src?.[m]){if(!(src[m]instanceof Function)){if(args)src[m]=args;return src[m]}else return src[m](args)}else return this.handleServiceMessage({route,args,method})};this.transmit=(...args)=>{if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.receive=(...args)=>{if(args[0]){if(typeof args[0]==="string"){let substr=args[0].substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))args[0]=args[0].replace(/\\\\/g,"");if(args[0][0]==='"'){args[0]=args[0].substring(1,args[0].length-1)};args[0]=JSON.parse(args[0])}}}if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.pipe=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return this.subscribe(source,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.pipeOnce=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return source.__node.state.subscribeTriggerOnce(source.__node.unique,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.__node.state.subscribeTriggerOnce(source.__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.__node.state.subscribeTriggerOnce(this.__node.nodes.get(source).__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.terminate=(...args)=>{};this.isTypedArray=isTypedArray;this.recursivelyAssign=recursivelyAssign2;this.spliceTypedArray=spliceTypedArray;this.ping=()=>{console.log("pinged!");return"pong"};this.echo=(...args)=>{this.transmit(...args);return args};if(options?.services)this.addServices(options.services);this.setTree(this)}handleServiceMessage(message){let call;if(typeof message==="object"){if(message.route)call=message.route;else if(message.node)call=message.node}if(call){if(Array.isArray(message.args))return this.run(call,...message.args);else return this.run(call,message.args)}else return message}handleGraphNodeCall(route,args){if(!route)return args;if(args?.args){this.handleServiceMessage(args)}else if(Array.isArray(args))return this.run(route,...args);else return this.run(route,args)}};function isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}var recursivelyAssign2=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"&&!Array.isArray(obj[key])){if(typeof target[key]==="object"&&!Array.isArray(target[key]))recursivelyAssign2(target[key],obj[key]);else target[key]=recursivelyAssign2({},obj[key])}else target[key]=obj[key]}return target};function spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let ta;if(s.length>0||e?.length>0)ta=new arr.constructor(s.length+e.length);if(ta){if(s.length>0)ta.set(s);if(e&&e.length>0)ta.set(e,s.length)}return ta}function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var stringifyWithCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs22(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs}var stringifyFast=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast22(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast}var unsafeRoutes={setRoute:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;if(this.__node.graph.get(fnName)){this.__node.graph.get(fnName).__setOperator(fn)}else{let node=this.__node.graph.add({__node:{tag:fnName},__operator:fn})}return true}return false},setNode:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;if(this.__node.graph.get(fnName)){this.__node.graph.get(fnName).__setOperator(fn)}else this.__node.graph.add({__node:{tag:fnName},__operator:fn});return true}return false},setMethod:function(route,fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;if(this.__node.graph.get(route)){this.__node.graph.get(route)[fnName]=fn}else this.__node.graph.add({__node:{tag:fnName,[fnName]:fn}});return true}return false},assignRoute:function(route,source){if(this.__node.graph.get(route)&&typeof source==="object"){Object.assign(this.__node.graph.get(route),source)}},transferClass:(classObj,className)=>{if(typeof classObj==="object"){let str2=classObj.toString();let message={route:"receiveClass",args:[str2,className]};return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name=className;if(!name)name=cls.name;this.__node.graph[name]=cls;return true}}return false},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},assignFunctionToGlobalObject:function(globalObjectName,fn,fnName){if(!globalThis[globalObjectName])return false;if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[globalObjectName][fnName]=fn;return true}return false},setFunction:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false},assignFunctionToObject:function(objectName,fn,fnName){if(!this.__node.graph[objectName])return false;if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[objectName][fnName]=fn;return true}return false}};var import_sjcl=__toESM(require_sjcl());var _HTTPfrontend=class extends Service{constructor(options,path,fetched){super(options);this.name="http";this.fetchProxied=false;this.listening={};this.GET=(url="http://localhost:8080/ping",type="",mimeType)=>{if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"GET",url,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.POST=(message,url="http://localhost:8080/echo",type="",mimeType)=>{if(typeof message==="object"&&(type==="json"||type==="text"||!type)){message=JSON.stringify(message)}if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"POST",url,data:message,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.transmit=(message,url)=>{let obj=message;if(typeof obj==="object"){message=JSON.stringify(obj)}if(obj?.method?.toLowerCase()=="get"||message?.toLowerCase()==="get")return this.GET(url);return this.POST(message,url)};this.transponder=(url,message,type="",mimeType)=>{if(typeof message==="object")message=JSON.stringify(message);let method="GET";if(message){method="POST"}if(type==="json")mimeType="application/json";else return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method,url,data:message,responseType:type,onload:ev=>{let body=xhr.response;if(typeof body==="string"){let substr=body.substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))body=body.replace(/\\\\/g,"");if(body[0]==='"'){body=body.substring(1,body.length-1)};body=JSON.parse(body)}}if(typeof body?.method==="string"){return resolve(this.handleMethod(body.route,body.method,body.args))}else if(typeof body?.route==="string"){return resolve(this.handleServiceMessage(body))}else if(typeof body?.node==="string"||body.node instanceof GraphNode){return resolve(this.handleGraphNodeCall(body.node,body.args))}else return resolve(body)},onabort:er=>{reject(er)}})}).catch(console.error)};this.listen=(path2="0",fetched2=async(clone,args,response)=>{const result=await clone.text();const returned=this.receive(result);this.setState({[response.url]:returned})})=>{this.listening[path2]={};let listenerId=\`\${path2}\${Math.floor(Math.random()*1e15)}\`;this.listening[path2][listenerId]=fetched2;if(!this.fetchProxied){globalThis.fetch=new Proxy(globalThis.fetch,{apply(fetch,that,args){const result=fetch.apply(that,args);result.then(response=>{if(!response.ok)return;if(this.listening["0"]){for(const key in this.listeners){const clone=response.clone();this.listening["0"][key](clone,args,response)}}else{for(const key in this.listening){if(response.url.includes(key)){for(const key2 in this.listening[path2]){const clone=response.clone();this.listening[path2][key2](clone,args,response)}break}}}}).catch(er=>{console.error(er)});return result}});this.fetchProxied=true}return listenerId};this.stopListening=(path2,listener)=>{if(!path2&&path2!==0){for(const key in this.listening)delete this.listening[key]}else{if(!listener)delete this.listening[path2];else delete this.listening[listener]}};this.setTree(this);this.listen(path,fetched)}};var HTTPfrontend=_HTTPfrontend;HTTPfrontend.request=options=>{const xhr=new XMLHttpRequest;if(options.responseType)xhr.responseType=options.responseType;else options.responseType="json";if(options.mimeType){xhr.overrideMimeType(options.mimeType)}if(options.onload)xhr.addEventListener("load",options.onload,false);if(options.onprogress)xhr.addEventListener("progress",options.onprogress,false);if(options.onabort)xhr.addEventListener("abort",options.onabort,false);if(options.onloadend)xhr.addEventListener("loadend",options.onloadend,false);if(options.onerror)xhr.addEventListener("error",options.onerror,false);xhr.open(options.method,options.url,true,options.user,options.pass);if(!options.onerror)xhr.onerror=function(){xhr.abort()};xhr.send(options.data);return xhr};var import_web_worker=__toESM(require_browser());var WorkerService=class extends Service{constructor(options){super();this.name="worker";this.workers={};this.threadRot=0;this.loadWorkerRoute=(rt,routeKey)=>{if(rt.workerUrl)rt.url=rt.workerUrl;if(rt.workerId)rt.__node.tag=rt.workerId;if(!rt.__node.tag)rt.__node.tag=routeKey;rt._id=rt.__node.tag;let worker;if(this.workers[rt._id])worker=this.workers[rt._id];else if(rt.worker)worker=rt.worker;if(!worker){worker=this.addWorker(rt);let ondelete=rt2=>{rt2.worker?.terminate()};rt.__addOndisconnected(ondelete)}rt.worker=worker;if(rt.transferFunctions){for(const prop in rt.transferFunctions){this.transferFunction(worker,rt.transferFunctions[prop],prop)}}if(rt.transferClasses){for(const prop in rt.transferClasses){this.transferClass(worker,rt.transferClasses[prop],prop)}}if(worker){if(!rt.__operator){rt.__operator=(...args)=>{if(rt.callback){if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.post(rt.callback,args);else return worker.run(rt.callback,args)}else{if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(rt.init){worker.run(rt.init,rt.initArgs,rt.initTransfer)}return worker}};this.workerloader={"workers":(node,parent2,graph,tree)=>{let rt=node;if(!node.parentRoute&&(parent2?.callback&&parent2?.worker))node.parentRoute=parent2?.callback;if(rt?.worker||rt?.workerId||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,rt.callback,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,rt.callback,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,rt.callback,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){console.log(rt);if(typeof rt.__parent==="string"&&tree[rt.__parent]?.worker){tree[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,rt.blocking)}}return rt}};this.addDefaultMessageListener=()=>{globalThis.onmessage=ev=>{let result=this.receive(ev.data);if(this.__node.keepState)this.setState({[this.name]:result})}};this.postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};this.addWorker=options2=>{let worker;if(!options2._id)options2._id=\`worker\${Math.floor(Math.random()*1e15)}\`;if(options2.url)worker=new import_web_worker.default(options2.url);else if(options2.port){worker=options2.port}else if(this.workers[options2._id]){if(this.workers[options2._id].port)worker=this.workers[options2._id].port;else worker=this.workers[options2._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,transfer,method)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,transfer,method)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options2._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,transfer,method)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options2._id,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,blocking)=>{return this.subscribeToWorker(route,options2._id,callback,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].callback,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub})}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options2._id)};if(!options2.onmessage)options2.onmessage=ev=>{this.receive(ev.data);this.setState({[options2._id]:ev.data})};if(!options2.onerror){options2.onerror=ev=>{console.error(ev.data)}}worker.onmessage=options2.onmessage;worker.onerror=options2.onerror;this.workers[options2._id]={worker,send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options2};return this.workers[options2._id]};this.toObjectURL=scriptTemplate=>{let blob=new Blob([scriptTemplate],{type:"text/javascript"});return URL.createObjectURL(blob)};this.transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys=Object.keys(this.workers);this.workers[keys[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys.length)this.threadRot=0}return message};this.terminate=worker=>{let onclose;if(typeof worker==="string"){let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}if(worker instanceof import_web_worker.default){worker.terminate();if(onclose)onclose(worker);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);return true}return false};this.establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=\`port\${Math.floor(Math.random()*1e15)}\`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof import_web_worker.default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};this.request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};this.runRequest=(message,worker,callbackId)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId})})}else{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId})}return res};this.subscribeWorker=(route,worker,blocking,key,subInput)=>{let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{if(worker?.postMessage)worker.postMessage({args:r,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route})})}else{if(worker?.postMessage)worker.postMessage({args:res,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route})}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,key,subInput)};this.subscribeToWorker=(route,workerId,callback,blocking,key,subInput)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeTrigger(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,blocking,key,subInput])}};this.triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i=0;i<this.__node.state.triggers[workerId].length;i++){await this.__node.state.triggers[workerId][i].onchange({args:result,callbackId:route})}return true};this.pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,blocking)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,blocking])};this.unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(sourceWorker)return sourceWorker.run("unsubscribe",[sourceRoute,sub])};this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.setTree(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}transferFunction(worker,fn,fnName){if(!fnName)fnName=fn.name;return worker.request({route:"setRoute",args:[fn.toString(),fnName]})}transferClass(worker,cls,className){if(!className)className=cls.name;return worker.request({route:"receiveClass",args:[cls.toString(),className]})}};var mouseEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY"]);var wheelEventHandlerImpl=makeSendPropertiesHandler(["deltaX","deltaY"]);var keydownEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","keyCode"]);function wheelEventHandler(event,sendFn){event.preventDefault();wheelEventHandlerImpl(event,sendFn)}function preventDefaultHandler(event){event.preventDefault()}function copyProperties(src,properties,dst){for(const name of properties){dst[name]=src[name]}}function makeSendPropertiesHandler(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties(event,properties,data);sendFn(data)}}function touchEventHandler(event,sendFn){const touches=[];const data={type:event.type,touches};for(let i=0;i<event.touches.length;++i){const touch=event.touches[i];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var orbitKeys={"37":true,"38":true,"39":true,"40":true};function filteredKeydownEventHandler(event,sendFn){const{keyCode}=event;if(orbitKeys[keyCode]){event.preventDefault();keydownEventHandler(event,sendFn)}}var eventHandlers={contextmenu:preventDefaultHandler,mousedown:mouseEventHandler,mousemove:mouseEventHandler,mouseup:mouseEventHandler,pointerdown:mouseEventHandler,pointermove:mouseEventHandler,pointerup:mouseEventHandler,touchstart:touchEventHandler,touchmove:touchEventHandler,touchend:touchEventHandler,wheel:wheelEventHandler,keydown:filteredKeydownEventHandler};function initProxyElement(element,worker,id){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{if(!worker){handleProxyEvent(data,id)}else worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher=class{addEventListener(type,listener){if(this.__listeners===void 0)this.__listeners={};const listeners=this.__listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this.__listeners===void 0)return false;const listeners=this.__listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i=0,l=array.length;i<l;i++){array[i].call(this,event)}event.target=null}}};function noop(){}var ElementProxyReceiver=class extends EventDispatcher{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop;data.stopPropagation=noop;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}};var ProxyManager=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=\`proxyReceiver\${Math.floor(Math.random()*1e15)}\`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={}}};function makeProxy(id,elm){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;this.__node.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent(data,id){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;if(this.__node.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes={initProxyElement,makeProxy,handleProxyEvent};function Renderer(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas(worker,options,route)}else{initProxyElement(options.canvas,void 0,options._id);return setupCanvas(options)}}function transferCanvas(worker,options,route){if(!options)return void 0;if(!options._id)options._id=\`canvas\${Math.floor(Math.random()*1e15)}\`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this?.__node?.graph)this.__node.graph.run("initProxyElement",options.canvas,worker,options._id);else initProxyElement(options.canvas,worker,options._id);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let transfer=[offscreen];if(options.transfer){transfer.push(...options.transfer);delete options.transfer}worker.postMessage(message,transfer);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:props=>{worker.postMessage({route:"drawFrame",args:[props,options._id]})},update:props=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]})},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:newDrawProps=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]})},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw(settings,_id){let canvasopts;if(this?.__node?.graph){if(_id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText3(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw}if(typeof settings.update==="string")settings.update=parseFunctionFromText3(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update}if(typeof settings.init==="string")settings.init=parseFunctionFromText3(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText3(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear}return settings._id}return void 0}function setupCanvas(options){if(this?.__node?.graph){if(!this.__node.graph.CANVASES)this.__node.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=\`canvas\${Math.floor(Math.random()*1e15)}\`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this?.__node?.graph?.CANVASES[canvasOptions._id]){this.__node.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw(canvasOptions)}else{if(this?.__node?.graph)canvasOptions.graph=this.__node.graph;if(this?.__node?.graph)this.__node.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this?.__node.graph)this.__node.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText3(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText3(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText3(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText3(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim(canvasOptions._id)};canvasOptions.start=draw=>{startAnim(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame(props,options._id)},update:props=>{updateCanvas(props,options._id)},clear:()=>{clearCanvas(options._id)},init:()=>{initCanvas(options._id)},stop:()=>{stopAnim(options._id)},start:()=>{startAnim(options._id)},set:newDrawProps=>{setDraw(newDrawProps,options._id)},terminate:()=>{stopAnim(options._id)}};return canvascontrols}}function drawFrame(props,_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas(input,_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps(props,_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim(_id,draw){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText3(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}var workerCanvasRoutes={...proxyElementWorkerRoutes,Renderer,transferCanvas,setupCanvas,setDraw,drawFrame,clearCanvas,initCanvas,updateCanvas,setProps,startAnim,stopAnim};function parseFunctionFromText3(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var algorithms={};var loadAlgorithms=settings=>{return Object.assign(algorithms,settings)};function createSubprocess(options,inputs){let ctx={_id:options._id?options._id:\`algorithm\${Math.floor(Math.random()*1e15)}\`,ondata:options.ondata,run:data=>{return ctx.ondata(ctx,data)}};if(options.structs)recursivelyAssign3(ctx,JSON.parse(JSON.stringify(options.structs)));if(inputs)recursivelyAssign3(ctx,JSON.parse(JSON.stringify(inputs)));if(options.oncreate){ctx.oncreate=options.oncreate}if(ctx.oncreate){ctx.oncreate(ctx)}return ctx}var recursivelyAssign3=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"&&!Array.isArray(obj[key])){if(typeof target[key]==="object"&&!Array.isArray(target[key]))recursivelyAssign3(target[key],obj[key]);else target[key]=recursivelyAssign3({},obj[key])}else target[key]=obj[key]}return target};var subprocessRoutes={...unsafeRoutes,loadAlgorithms,"initSubprocesses":async function initSubprocesses(subprocesses,service){if(!service)service=this.__node.graph;if(!service)return void 0;for(const p in subprocesses){let s=subprocesses[p];if(!s.worker&&s.url)s.worker=service.addWorker({url:s.url});if(!s.worker)continue;let w=s.worker;let wpId;wpId=service.establishMessageChannel(w.worker,s.source?.worker);if(!s.source)s.source=service;if(typeof s.subprocess==="object"){const p2=s.subprocess;if(!p2.name)continue;if(typeof p2.oncreate==="function"){p2.oncreate=p2.oncreate.toString()}if(typeof p2.ondata==="function"){p2.ondata=p2.ondata.toString()}s.worker.post("addSubprocessTemplate",[p2.name,p2.structs,p2.oncreate,p2.ondata,p2.props]);s.subprocess=p2.name}if(s.init){let r=await w.run(s.init,s.initArgs);s.otherArgs=r}if(s.otherArgs){w.run("setValue",["otherArgsProxy",Array.isArray(s.otherArgs)?s.otherArgs:[s.otherArgs]])}if(s.pipeTo){w.run("setValue",["routeProxy",s.route]);w.run("setValue",["pipeRoute",s.pipeTo.route]);if(s.url&&!s.pipeTo.worker){let w2=service.addWorker({url:s.url});s.pipeTo.portId=service.establishMessageChannel(w.worker,w2.worker);s.pipeTo.worker=w2}if(s.pipeTo.init){s.pipeTo.otherArgs=await s.pipeTo.worker.run(s.pipeTo.init,s.pipeTo.initArgs)}w.run("setValue",["pipePort",s.pipeTo.portId]);if(s.pipeTo.otherArgs)w.run("setValue",["otherPipeArgs",s.pipeTo.otherArgs]);service.transferFunction(w,function pipeResults(data){let inp=data;if(this.__node.graph.otherArgsProxy)inp=[data,...this.__node.graph.otherArgsProxy];let r=this.__node.graph.run(this.__node.graph.routeProxy,inp);if(!s.blocking)return new Promise(res=>{if(r instanceof Promise){r.then(rr=>{if(rr!==void 0){let args=rr;if(this.__node.graph.otherPipeArgs)args=[rr,...this.__node.graph.otherPipeArgs];if(this.workers[this.__node.graph.pipePort]){s.blocking=true;this.workers[this.__node.graph.pipePort].run(this.__node.graph.pipeRoute,args).then(result=>{s.blocking=false;res(result)})}}})}else if(r!==void 0){let args=r;if(this.__node.graph.otherPipeArgs)args=[r,...this.__node.graph.otherPipeArgs];if(this.workers[this.__node.graph.pipePort]){s.blocking=true;this.workers[this.__node.graph.pipePort].run(this.__node.graph.pipeRoute,args).then(result=>{s.blocking=false;res(result)})}}});return void 0},s.route+"_pipeResults");s.route=s.route+"_pipeResults"}else{w.run("setValue",["routeProxy",s.route]);service.transferFunction(w,function routeProxy(data){let r;if(this.__node.graph.otherArgsProxy)r=this.__node.graph.nodes.get(this.__node.graph.routeProxy).__operator(data,...this.__node.graph.otherArgsProxy);else r=this.__node.graph.nodes.get(this.__node.graph.routeProxy).__operator(data);if(this.__node.graph.state.triggers[this.__node.graph.routeProxy]){if(r instanceof Promise){r.then(rr=>{this.setState({[this.__node.graph.routeProxy]:rr})})}else this.setState({[this.__node.graph.routeProxy]:r})}return r},s.route+"_routeProxy");s.route=s.route+"_routeProxy";if(!s.stopped)w.run("subscribeToWorker",[s.subscribeRoute,wpId,s.route]).then(sub=>{s.sub=sub})}s.stop=async()=>{if(s.source&&typeof s.sub==="number"){s.source.unsubscribe(s.subscribeRoute,s.sub);return true}return void 0};s.start=async()=>{if(typeof s.sub!=="number")return w.run("subscribeToWorker",[s.subscribeRoute,wpId,s.route,s.blocking]).then(sub=>{s.sub=sub})};s.setArgs=async args=>{if(Array.isArray(args))await w.run("setValue",["otherArgsProxy",args]);else if(typeof args==="object"){for(const key in args){await w.run("setValue",[key,args[key]])}}return true};s.terminate=()=>{w.terminate();if(s.source?.worker&&typeof s.sub==="number"){s.source.post("unsubscribe",s.sub)}if(s.pipeTo?.worker){s.pipeTo.worker.terminate()}};if(s.callback)w.subscribe(s.route,res=>{if(typeof s.callback==="string")this.__node.graph.run(s.callback,res);else s.callback(res)})}return subprocesses},"addSubprocessTemplate":function subprocesstempalte(name,structs,oncreate,ondata,props){if(typeof oncreate==="string")oncreate=parseFunctionFromText(oncreate);if(typeof ondata==="string")ondata=parseFunctionFromText(ondata);if(typeof ondata==="function"){algorithms[name]={ondata,oncreate:typeof oncreate==="function"?oncreate:null,structs};if(typeof props==="object")Object.assign(algorithms[name],props);return true}},"updateSubprocess":function updatesubprocess(structs,_id){if(!this.__node.graph.ALGORITHMS)this.__node.graph.ALGORITHMS={};if(!_id)_id=Object.keys(this.__node.graph.ALGORITHMS)[0];if(!_id)return;Object.assign(this.__node.graph.ALGORITHMS[_id],structs)},"createSubprocess":function creatsubprocess(options,inputs){if(!this.__node.graph.ALGORITHMS)this.__node.graph.ALGORITHMS={};if(typeof options==="string"){options=algorithms[options]}if(typeof options==="object"){if(typeof options.ondata==="string")options.ondata=parseFunctionFromText(options.ondata);let ctx;if(typeof options?.ondata==="function")ctx=createSubprocess(options,inputs);if(ctx)this.__node.graph.ALGORITHMS[ctx._id]=ctx;console.log(ctx,options);if(ctx)return ctx._id}return false},"runSubprocess":function runsubprocess(data,_id){if(!this.__node.graph.ALGORITHMS)this.__node.graph.ALGORITHMS={};if(!_id)_id=Object.keys(this.__node.graph.ALGORITHMS)[0];if(!_id)return;let res=this.__node.graph.ALGORITHMS[_id].run(data);if(res!==void 0){if(Array.isArray(res)){let pass=[];res.forEach(r=>{if(r!==void 0){pass.push(r);this.__node.graph.setState({[_id]:r})}});if(pass.length>0){return pass}}else{this.__node.graph.setState({[_id]:res});return res}}}};var _ArrayManip=class{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y=>{if(clamp){if(y<min)y=min;if(y>max)y=max}return y*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y=>{if(clamp){if(y<min)y=min;if(y>max)y=max}return 2*((y-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps9){let now=Date.now();let toInterp=[now-ct*1e3/sps9,now];return _ArrayManip.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i=incr;i<array.length;i+=incr){let rounded=Math.round(i);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i=1;i<fitCount-1;i++){var tmp=i*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x;b=0}else if(60<=h&&h<120){r=x;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x}else if(180<=h&&h<240){r=0;g=x;b=c}else if(240<=h&&h<300){r=x;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d={};data.forEach((arr,i)=>{d[i]=arr});data=d;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i)=>lastValue+slopeIncr*(i+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip.interpolate(data,Math.ceil(targetSPS*time))}isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var ArrayManip=_ArrayManip;ArrayManip.bufferValues=(objects,property,keys,buffer)=>{if(!Array.isArray(keys)&&typeof keys==="object")keys=Object.keys(keys);if(!buffer){let object_keys=Object.keys(objects);if(keys)buffer=new Float32Array(object_keys.length*keys.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys.length)}else buffer=new Float32Array(object_keys.length)}}let i=0;for(const key in objects){if(objects[key][property]){if(keys){for(let j=0;j<keys.length;j++){buffer[i]=objects[key][property][keys[j]];i++}}else{buffer[i]=objects[key][property];i++}}}return buffer};var rechk=/^([<>])?(([1-9]\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt=/([1-9]\\d*)?([xcbB?hHiIfdsp])/g;var str=(v,o,c)=>String.fromCharCode(...new Uint8Array(v.buffer,v.byteOffset+o,c));var rts=(v,o,c,s)=>new Uint8Array(v.buffer,v.byteOffset+o,c).set(s.split("").map(str2=>str2.charCodeAt(0)));var pst=(v,o,c)=>str(v,o+1,Math.min(v.getUint8(o),c-1));var tsp=(v,o,c,s)=>{v.setUint8(o,s.length);rts(v,o+1,c-1,s)};var lut=le=>({x:c=>[1,c,0],c:c=>[c,1,o=>({u:v=>str(v,o,1),p:(v,c2)=>rts(v,o,1,c2)})],"?":c=>[c,1,o=>({u:v=>Boolean(v.getUint8(o)),p:(v,B)=>v.setUint8(o,B)})],b:c=>[c,1,o=>({u:v=>v.getInt8(o),p:(v,b)=>v.setInt8(o,b)})],B:c=>[c,1,o=>({u:v=>v.getUint8(o),p:(v,B)=>v.setUint8(o,B)})],h:c=>[c,2,o=>({u:v=>v.getInt16(o,le),p:(v,h)=>v.setInt16(o,h,le)})],H:c=>[c,2,o=>({u:v=>v.getUint16(o,le),p:(v,H)=>v.setUint16(o,H,le)})],i:c=>[c,4,o=>({u:v=>v.getInt32(o,le),p:(v,i)=>v.setInt32(o,i,le)})],I:c=>[c,4,o=>({u:v=>v.getUint32(o,le),p:(v,I)=>v.setUint32(o,I,le)})],f:c=>[c,4,o=>({u:v=>v.getFloat32(o,le),p:(v,f)=>v.setFloat32(o,f,le)})],d:c=>[c,8,o=>({u:v=>v.getFloat64(o,le),p:(v,d)=>v.setFloat64(o,d,le)})],s:c=>[1,c,o=>({u:v=>str(v,o,c),p:(v,s)=>rts(v,o,c,s.slice(0,c))})],p:c=>[1,c,o=>({u:v=>pst(v,o,c),p:(v,s)=>tsp(v,o,c,s.slice(0,c-1))})]});var errbuf=new RangeError("Structure larger than remaining buffer");var errval=new RangeError("Not enough values for structure");var _ByteParser=class extends ArrayManip{static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i=search(haystack);i!==-1;i=search(haystack,i+skip)){indices.push(i);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y){return[y&255,y>>8&255]}static bytesToInt24(x0,x1,x2){let int24=(255&x0)<<16|(255&x1)<<8|255&x2;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x2){return x0*65536+x1*256+x2}static Uint24ToBytes(y){return[y&255,y>>8&255,y>>16&255]}static bytesToInt32(x0,x1,x2,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x2)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x2,x3){return x0*16777216+x1*65536+x2*256+x3}static Uint32ToBytes(y){return[y&255,y>>8&255,y>>16&255,y>>24&255]}static get2sCompliment(val,nbits3){if(val>4294967296)return null;return val<<32-nbits3>>32-nbits3}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i=0;i<input.length;i++){var c=input.charCodeAt(i);if(c>127){throw new TypeError("Only ASCII patterns are supported")}arr[i]=c}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){var pattern=_ByteParser.asUint8Array(patternBuffer);var M=pattern.length;if(M===0){throw new TypeError("patternBuffer must be at least 1 byte long")}var R=256;var rightmost_positions=new Int32Array(R);for(var c=0;c<R;c++){rightmost_positions[c]=-1}for(var j=0;j<M;j++){rightmost_positions[pattern[j]]=j}var boyerMooreSearch=(txtBuffer,start,end)=>{var txt=_ByteParser.asUint8Array(txtBuffer);if(start===void 0)start=0;if(end===void 0)end=txt.length;var pat=pattern;var right=rightmost_positions;var lastIndex=end-pat.length;var lastPatIndex=pat.length-1;var skip;for(var i=start;i<=lastIndex;i+=skip){skip=0;for(var j2=lastPatIndex;j2>=0;j2--){var c2=txt[i+j2];if(pat[j2]!==c2){skip=Math.max(1,j2-right[c2]);break}}if(skip===0){return i}}return-1};boyerMooreSearch.byteLength=pattern.byteLength;return boyerMooreSearch}static struct(format){let fns=[],size=0,m=rechk.exec(format);if(!m){throw new RangeError("Invalid format string")}const t=lut("<"===m[1]),lu=(n,c)=>t[c](n?parseInt(n,10):1);while(m=refmt.exec(format)){((r,s,f)=>{for(let i=0;i<r;++i,size+=s){if(f){fns.push(f(size))}}})(...lu(...m.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf}let v=new DataView(arrb,offs|0);return fns.map(f=>f.u(v))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval}if(arrb.byteLength<offs+size){throw errbuf}const v=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f,i)=>f.p(v,values[i]))};const pack=(...values)=>{let b=new ArrayBuffer(size);pack_into(b,0,...values);return b};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ByteParser=_ByteParser;ByteParser.codes={"\\\\n":10,"\\\\r":13,"\\\\t":9,"\\\\s":32,"\\\\b":8,"\\\\f":12,"\\\\":92};var WebSerial=class extends ByteParser{constructor(){super(...arguments);this.streams={};this.createStream=options=>{let stream={_id:options._id?options._id:\`stream\${Math.floor(Math.random()*1e15)}\`,info:options.port.getInfo(),running:false,...options};if(options.port?.readable){if(options.transforms){stream.reader=WebSerial.setStreamTransforms(options.port.readable,options.transforms).getReader()}else{stream.reader=options.port.readable.getReader()}}this.streams[stream._id]=stream;return stream}}getPorts(){return navigator.serial.getPorts()}requestPort(usbVendorId,usbProductId){let options={};if(usbVendorId){options.usbVendorId=usbVendorId}if(usbProductId){options.usbProductId=usbProductId}if(options.usbVendorId)return navigator.serial.requestPort({filters:[options]});else return navigator.serial.requestPort()}openPort(port,options){if(options)options=Object.assign({},options);if(options?.ondisconnect){port.ondisconnect=options.ondisconnect;delete options.ondisconnect}return port.open(options).then(()=>{if(options?.onconnect)options.onconnect(port)})}async readWithTimeout(port,timeout){const reader=port.readable.getReader();const timer=setTimeout(()=>{reader.releaseLock()},timeout);const result=await reader.read();clearTimeout(timer);reader.releaseLock();return result}async writePort(port,message){const writer=port.writable.getWriter();await writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}getSignals(port){return port.getSignals()}setSignals(port,signals){return port.setSignals(signals)}readStream(stream){if(stream.reader&&!stream.running){let reader=stream.reader;if(stream.buffering){if(typeof stream.buffering!=="object")stream.buffering={};if(!stream.buffering.buffer){stream.buffering.buffer=[]}if(!stream.buffering.searchBytes)stream.buffering.searchBytes=new Uint8Array([13,10])}let readLoop=()=>{if(stream.port.readable&&stream.running){reader.read().then(result=>{if(result.done)reader.releaseLock();else{if(stream.buffering){stream.buffering.buffer.push(...result.value);const needle=stream.buffering.searchBytes;const haystack=stream.buffering.buffer;const search=WebSerial.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;for(var i=search(haystack);i!==-1;i=search(haystack,i+skip)){if(!stream.buffering.locked&&!("lockIdx"in stream.buffering))stream.buffering.lockIdx=i;else{nextIndex=i;if(nextIndex>=0){if(!stream.buffering.locked){stream.ondata(new Uint8Array(stream.buffering.buffer.splice(stream.buffering.lockIdx+stream.buffering.searchBytes.length,nextIndex+stream.buffering.searchBytes.length)));stream.buffering.buffer.splice(0,stream.buffering.searchBytes.length);stream.buffering.locked=true}else if(nextIndex>0){stream.ondata(new Uint8Array(stream.buffering.buffer.splice(stream.buffering.searchBytes.length,nextIndex)))}}}}}else stream.ondata(result.value);setTimeout(()=>{readLoop()},stream.frequency)}}).catch(er=>{console.error(stream._id," Read error:",er);if(er.message.includes("overrun")||er.message.includes("framing")){delete stream.reader;this.reconnect(stream)}})}else if(!stream.running&&stream.port.readable){try{reader.releaseLock()}catch(er){console.error(er)}}};stream.running=true;readLoop();return stream}return void 0}writeStream(stream,message){if(typeof stream==="string")stream=this.streams[stream];if(stream.port.writable){let writer=stream.port.writable.getWriter();writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}return void 0}closeStream(stream,onclose){if(typeof stream==="string")stream=this.streams[stream];stream.running=false;return new Promise((res,rej)=>{if(stream.settings.beforedisconnect){stream.settings.beforedisconnect(this,stream.port)}setTimeout(async()=>{if(stream.port.readable&&stream.reader){try{stream.reader.releaseLock()}catch(er){console.error(er)}if(stream.transforms)try{await stream.reader.cancel()}catch(err){console.error(err)}}try{await stream.port.close().then(()=>{if(onclose)onclose(this.streams[stream._id])});delete this.streams[stream._id];res(true)}catch(er){rej(er)}},300)})}reconnect(stream,options){if(typeof stream==="string")stream=this.streams[stream];return new Promise((res,rej)=>{if(typeof stream!=="object"){rej(void 0);return}let info=stream.port.getInfo();this.closeStream(stream._id).then(closed=>{setTimeout(()=>{this.getPorts().then(ports=>{for(let i=0;i<ports.length;i++){if(ports[i].getInfo().usbVendorId===info.usbVendorId&&ports[i].getInfo().usbProductId===info.usbProductId){if(!options)options=stream;else options._id=stream._id;delete options.port;this.openPort(ports[i],options.settings).then(()=>{const stream2=this.createStream({...options,port:ports[i]});this.readStream(stream2);res(stream2)}).catch(rej)}}}).catch(rej)},100)})})}static setStreamTransforms(stream,transforms){let transform=[];Object.keys(transforms).forEach(t=>{let opt=transforms[t];if(opt instanceof TransformStream){transform.push(opt)}else{if(!opt.start)opt.start=function start(){};if(!opt.flush)opt.flush=function flush(){};let transformer=new TransformStream({start:opt.start,transform:opt.transform,flush:opt.flush},opt.writableStrategy,opt.readableStrategy);transform.push(transformer)}});let str2=stream;transform.forEach(transform2=>{str2=str2.pipeThrough(transform2)});return str2}};function ads131m08codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i=0;i<9;i++){let j=i*25;output[0][i]=ByteParser.bytesToInt24(arr[j],arr[j+1],arr[j+2]);output[1][i]=ByteParser.bytesToInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i]=ByteParser.bytesToInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i]=ByteParser.bytesToInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i]=ByteParser.bytesToInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i]=ByteParser.bytesToInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i]=ByteParser.bytesToInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i]=ByteParser.bytesToInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var decoder=new TextDecoder;function ads131m08_arduinocodec(data){const parsed=decoder.decode(data);let split;if(parsed.includes("|"))split=parsed.split("|");else if(split.includes(","))split=parsed.split(",");else split=parsed.split("	");return{"0":parseInt(split[0]),"1":parseInt(split[1]),"2":parseInt(split[2]),"3":parseInt(split[3]),"4":parseInt(split[4]),"5":parseInt(split[5]),"6":parseInt(split[6]),"7":parseInt(split[7]),timestamp:Date.now()}}var sps=250;var defaultChartSetting={nSec:10,sps,units:"mV"};var ads131m08ChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting)),"1":JSON.parse(JSON.stringify(defaultChartSetting)),"2":JSON.parse(JSON.stringify(defaultChartSetting)),"3":JSON.parse(JSON.stringify(defaultChartSetting)),"4":JSON.parse(JSON.stringify(defaultChartSetting)),"5":JSON.parse(JSON.stringify(defaultChartSetting)),"6":JSON.parse(JSON.stringify(defaultChartSetting)),"7":JSON.parse(JSON.stringify(defaultChartSetting))}};var gain=32;var nbits=24;var vref=1.2;var defaultsetting={sps,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))};var ads131m08FilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting)),"1":JSON.parse(JSON.stringify(defaultsetting)),"2":JSON.parse(JSON.stringify(defaultsetting)),"3":JSON.parse(JSON.stringify(defaultsetting)),"4":JSON.parse(JSON.stringify(defaultsetting)),"5":JSON.parse(JSON.stringify(defaultsetting)),"6":JSON.parse(JSON.stringify(defaultsetting)),"7":JSON.parse(JSON.stringify(defaultsetting))};function cytoncodec(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i=0;i<8;i++){let idx=1+3*i;output[i]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=25;output.ax=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output.gx=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output.gy=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output.gz=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}function daisycytoncodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i=0;i<8;i++){let idx=1+3*i;if(arr[0]%2===0)output[i+7]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=25;output.ax=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output.gx=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output.gy=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output.gz=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);return output}var sps2=250;var cytonSerialSettings={baudRate:115200,codec:cytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var daisycytonSerialSettings={baudRate:115200,codec:daisycytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var defaultChartSetting2={nSec:10,sps:sps2,units:"mV"};var defaultChartSetting22={nSec:10,sps:sps2};var cytonChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting2)),"1":JSON.parse(JSON.stringify(defaultChartSetting2)),"2":JSON.parse(JSON.stringify(defaultChartSetting2)),"3":JSON.parse(JSON.stringify(defaultChartSetting2)),"4":JSON.parse(JSON.stringify(defaultChartSetting2)),"5":JSON.parse(JSON.stringify(defaultChartSetting2)),"6":JSON.parse(JSON.stringify(defaultChartSetting2)),"7":JSON.parse(JSON.stringify(defaultChartSetting2)),"ax":JSON.parse(JSON.stringify(defaultChartSetting22)),"ay":JSON.parse(JSON.stringify(defaultChartSetting22)),"az":JSON.parse(JSON.stringify(defaultChartSetting22)),"gx":JSON.parse(JSON.stringify(defaultChartSetting22)),"gy":JSON.parse(JSON.stringify(defaultChartSetting22)),"gz":JSON.parse(JSON.stringify(defaultChartSetting22))},generateNewLines:true};var defaultsetting2={sps:sps2,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting2)),"1":JSON.parse(JSON.stringify(defaultsetting2)),"2":JSON.parse(JSON.stringify(defaultsetting2)),"3":JSON.parse(JSON.stringify(defaultsetting2)),"4":JSON.parse(JSON.stringify(defaultsetting2)),"5":JSON.parse(JSON.stringify(defaultsetting2)),"6":JSON.parse(JSON.stringify(defaultsetting2)),"7":JSON.parse(JSON.stringify(defaultsetting2)),"8":JSON.parse(JSON.stringify(defaultsetting2)),"9":JSON.parse(JSON.stringify(defaultsetting2)),"10":JSON.parse(JSON.stringify(defaultsetting2)),"11":JSON.parse(JSON.stringify(defaultsetting2)),"12":JSON.parse(JSON.stringify(defaultsetting2)),"13":JSON.parse(JSON.stringify(defaultsetting2)),"14":JSON.parse(JSON.stringify(defaultsetting2)),"15":JSON.parse(JSON.stringify(defaultsetting2))};function freeeeg128codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i=0;i<128;i++){let idx=i*3+1;output[i]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps3=250;var freeeeg128SerialSettings={baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec,sps:sps3,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings={lines:{"ax":{nSec:10,sps:sps3},"ay":{nSec:10,sps:sps3},"az":{nSec:10,sps:sps3},"gx":{nSec:10,sps:sps3},"gy":{nSec:10,sps:sps3},"gz":{nSec:10,sps:sps3}}};var freeeeg128FilterSettings={};for(let i=0;i<128;i++){freeeeg128ChartSettings.lines[i]={sps:sps3,nSec:10,units:"mV"};freeeeg128FilterSettings[i]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i=0;i<32;i++){let idx=i*3+1;output[i]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps4=512;var freeeeg32SerialSettings={baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings={baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting3={nSec:10,sps:sps4};var freeeeg32ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting3)),"ay":JSON.parse(JSON.stringify(defaultChartSetting3)),"az":JSON.parse(JSON.stringify(defaultChartSetting3)),"gx":JSON.parse(JSON.stringify(defaultChartSetting3)),"gy":JSON.parse(JSON.stringify(defaultChartSetting3)),"gz":JSON.parse(JSON.stringify(defaultChartSetting3))}};var freeeeg32FilterSettings={};for(let i=0;i<32;i++){freeeeg32ChartSettings.lines[i]={sps:sps4,nSec:10,units:"mV"};freeeeg32FilterSettings[i]={sps:sps4,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}var textdecoder=new TextDecoder;function hegduinocodec(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};let txt=textdecoder.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps5=40;var hegduinoSerialSettings={baudRate:115200,write:"t\\n",codec:hegduinocodec,sps:sps5};var hegduinoV1SerialSettings=Object.assign({},hegduinoSerialSettings);hegduinoV1SerialSettings.sps=19;var hegduinoBLESettings={sps:sps5,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec,sps:sps5}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings=Object.assign({},hegduinoSerialSettings);hegduinoV1BLESettings.sps=19;function max3010xcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={"red":new Array(32),"ir":new Array(32),"max_dietemp":ByteParser.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i=0;while(i<32){let idx=i*6;if(i%2===0){output["ir"][i]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i++}return output}function mpu6050codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i=0;i<20;i++){let idx=i*12;output.ax[i]=ByteParser.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i]=ByteParser.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i]=ByteParser.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i]=ByteParser.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i]=ByteParser.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i]=ByteParser.bytesToInt16(arr[idx+11],arr[idx+12])}return output}function cognixionONE_EEG_codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i=0;i<7;i++){let j=i*26+1;if(!arr[j+23])break;output[0][i]=ByteParser.bytesToUInt24(arr[j],arr[j+1],arr[j+2]);output[1][i]=ByteParser.bytesToUInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i]=ByteParser.bytesToUInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i]=ByteParser.bytesToUInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i]=ByteParser.bytesToUInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i]=ByteParser.bytesToUInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i]=ByteParser.bytesToUInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i]=ByteParser.bytesToUInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var sps6=250;var cognixionONEBLESettings={services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec,sps:sps6}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps6};var defaultChartSetting4={nSec:10,sps:sps6,units:"mV"};var cognixionONEChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting4)),"1":JSON.parse(JSON.stringify(defaultChartSetting4)),"2":JSON.parse(JSON.stringify(defaultChartSetting4)),"3":JSON.parse(JSON.stringify(defaultChartSetting4)),"4":JSON.parse(JSON.stringify(defaultChartSetting4)),"5":JSON.parse(JSON.stringify(defaultChartSetting4)),"6":JSON.parse(JSON.stringify(defaultChartSetting4)),"7":JSON.parse(JSON.stringify(defaultChartSetting4))}};var PeanutCodes={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec(data){let result={};let i=0;while(i<data.length){if(PeanutCodes[data[i]]&&i+1+PeanutCodes[data[i]].byteLength<=data.length){let slice=data.slice(i+1,i+1+PeanutCodes[data[i]].byteLength).buffer;let unpacked=ByteParser.struct(PeanutCodes[data[i]].format).unpack(slice);let code=PeanutCodes[data[i]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes[data[i]].type]){if(Array.isArray(unpacked))result[PeanutCodes[data[i]].type]=unpacked;else result[PeanutCodes[data[i]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes[data[i]].type].push(...unpacked);else result[PeanutCodes[data[i]].type].push(unpacked)}i+=PeanutCodes[data[i]].byteLength+1}else i++}result.timestamp=Date.now();return result}var peanutSerialSettings={baudRate:38400,bufferSize:400,write:"protocol 3\\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec,sps:10.101};var sealevel_hpa=1013.25;var bme280codec=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={temp:[],pressure:[],humidity:[],altitude:[]};for(let j=0;j<3;j++){let i=j*24;let tint=ByteParser.bytesToUInt32(arr[0+i],arr[1+i],arr[2+i],arr[3+i]);let tfrac=ByteParser.bytesToUInt32(arr[4+i],arr[5+i],arr[6+i],arr[7+i]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=ByteParser.bytesToUInt32(arr[8+i],arr[9+i],arr[10+i],arr[11+i]);let pfrac=ByteParser.bytesToUInt32(arr[12+i],arr[13+i],arr[14+i],arr[15+i]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser.bytesToUInt32(arr[16+i],arr[17+i],arr[18+i],arr[19+i]);let hfrac=ByteParser.bytesToUInt32(arr[20+i],arr[21+i],arr[22+i],arr[23+i]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}return output};var exponent=1/5.257;var denom=1/.0065;function altitude(pressure,temperature){return(Math.pow(sealevel_hpa/pressure,exponent)-1)*(temperature+273.15)*denom}function nrf5x_usbcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec(arr.subarray(2)))}else if(arr[0]===3){let result=ads131m08codec(arr.subarray(2));Object.keys(result).forEach((key,i)=>{output[i+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,ads131m08codec(arr))}return output}var nrf5xSerialSettings={baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec,sps:250};var nrf5xBLESettings={sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var defaultChartSetting5={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting5)),"1":JSON.parse(JSON.stringify(defaultChartSetting5)),"2":JSON.parse(JSON.stringify(defaultChartSetting5)),"3":JSON.parse(JSON.stringify(defaultChartSetting5)),"4":JSON.parse(JSON.stringify(defaultChartSetting5)),"5":JSON.parse(JSON.stringify(defaultChartSetting5)),"6":JSON.parse(JSON.stringify(defaultChartSetting5)),"7":JSON.parse(JSON.stringify(defaultChartSetting5))},generateNewLines:true,cleanGeneration:false};var gain2=32;var nbits2=24;var vref2=1.2;var defaultsetting3={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref2/(gain2*(Math.pow(2,nbits2)-1))};var nrf5x_usbFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting3)),"1":JSON.parse(JSON.stringify(defaultsetting3)),"2":JSON.parse(JSON.stringify(defaultsetting3)),"3":JSON.parse(JSON.stringify(defaultsetting3)),"4":JSON.parse(JSON.stringify(defaultsetting3)),"5":JSON.parse(JSON.stringify(defaultsetting3)),"6":JSON.parse(JSON.stringify(defaultsetting3)),"7":JSON.parse(JSON.stringify(defaultsetting3)),"8":JSON.parse(JSON.stringify(defaultsetting3)),"9":JSON.parse(JSON.stringify(defaultsetting3)),"10":JSON.parse(JSON.stringify(defaultsetting3)),"11":JSON.parse(JSON.stringify(defaultsetting3)),"12":JSON.parse(JSON.stringify(defaultsetting3)),"13":JSON.parse(JSON.stringify(defaultsetting3)),"14":JSON.parse(JSON.stringify(defaultsetting3)),"15":JSON.parse(JSON.stringify(defaultsetting3))};var textdecoder2=new TextDecoder;function statechangercodec(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder2.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings={baudRate:115200,codec:statechangercodec};var statechangerBLESettings={services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};function blueberrycodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps7=40;var blueberryBLESettings={namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec,sps:sps7}}},sps:sps7};function blueberryshortcodec(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps8=40;var blueberry2BLESettings={namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec,sps:sps8},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec,sps:sps8}}},sps:sps8};var defaultsetting1={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting1)),"1":JSON.parse(JSON.stringify(defaultsetting1)),"2":JSON.parse(JSON.stringify(defaultsetting1)),"3":JSON.parse(JSON.stringify(defaultsetting1))};var defaultChartSetting6={nSec:10,sps:250,units:"mV"};var ganglionChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting6)),"1":JSON.parse(JSON.stringify(defaultChartSetting6)),"2":JSON.parse(JSON.stringify(defaultChartSetting6)),"3":JSON.parse(JSON.stringify(defaultChartSetting6)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting4={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting4)),"1":JSON.parse(JSON.stringify(defaultsetting4)),"2":JSON.parse(JSON.stringify(defaultsetting4)),"3":JSON.parse(JSON.stringify(defaultsetting4)),"4":JSON.parse(JSON.stringify(defaultsetting4))};function hrcodec(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings={services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec}}}};var simulatorSettings={sps:250,simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=\`simulated\${Math.floor(Math.random()*1e15)}\`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop2=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v,i)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop2()},loopTime)}};loop2();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var Devices={BLE:{"nrf5x":nrf5xBLESettings,"hegduino":hegduinoBLESettings,"hegduinoV1":hegduinoV1BLESettings,"cognixionONE":cognixionONEBLESettings,"statechanger":statechangerBLESettings,"blueberry":blueberryBLESettings,"blueberry2":blueberry2BLESettings,"heart_rate":heartRateBLESettings},USB:{"nrf5x":nrf5xSerialSettings,"freeEEG32":freeeeg32SerialSettings,"freeEEG32_optical":freeeeg32_optical_SerialSettings,"freeEEG128":freeeeg128SerialSettings,"hegduino":hegduinoSerialSettings,"hegduinoV1":hegduinoV1SerialSettings,"cyton":cytonSerialSettings,"cyton_daisy":daisycytonSerialSettings,"peanut":peanutSerialSettings,"statechanger":statechangerSerialSettings,"cognixionONE":cytonSerialSettings},BLE_OTHER:{},USB_OTHER:{},OTHER:{"simulator":simulatorSettings}};var textdecoder3=new TextDecoder;var decoders={"raw":data=>{if(data?.buffer)return Array.from(new Uint8Array(data));else return data},"utf8":data=>{return textdecoder3.decode(data)},"console-f12":data=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(data);return data},"debug":(data,debugmessage)=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(debugmessage,data);return data},"ads131m08":ads131m08codec,"arduino_ads131m08":ads131m08_arduinocodec,"max3010x":max3010xcodec,"mpu6050":mpu6050codec,"bme280":bme280codec,"freeeeg32":freeeeg32codec,"freeeeg128":freeeeg128codec,"cyton":cytoncodec,"cognixionONE_BLE":cognixionONE_EEG_codec,"hegduino":hegduinocodec,"nrf5x":nrf5x_usbcodec,"peanut":peanutcodec,"statechanger":statechangercodec,"blueberry":blueberrycodec,"heart_rate":hrcodec};var BiquadChannelFilterer=class{constructor(options={sps:512,useSMA4:false,useNotch50:true,useNotch60:true,useLowpass:false,lowpassHz:100,useBandpass:false,bandpassLower:3,bandpassUpper:45,useDCBlock:true,DCBresonance:.995,trimOutliers:false,outlierTolerance:.2,useScaling:false,scalar:1}){this.idx=0;this.sps=options.sps;this.bandpassLower=options.bandpassLower?options.bandpassLower:3;this.bandpassUpper=options.bandpassUpper?options.bandpassUpper:45;this.useSMA4=options.useSMA4;this.last4=[];this.useNotch50=options.useNotch50;this.useNotch60=options.useNotch60;this.useLowpass=options.useLowpass;this.lowpassHz=options.lowpassHz?options.lowpassHz:100;this.useBandpass=options.useBandpass;this.useDCBlock=options.useDCBlock;this.DCBresonance=options.DCBresonance?options.DCBresonance:.995;this.useScaling=options.useScaling;this.scalar=options.scalar;this.trimOutliers=options.trimOutliers;this.outlierTolerance=options.outlierTolerance;let sps9=this.sps;this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(options.DCBresonance?options.DCBresonance:.995)}reset(sps9=this.sps){this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(this.DCBresonance)}setBandpass(bandpassLower=this.bandpassLower,bandpassUpper=this.bandpassUpper,sps9=this.sps){this.bandpassLower=bandpassLower;this.bandpassUpper=bandpassUpper;this.bp1=[makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9)]}apply(latestData=0){let out=latestData;if(this.useScaling===true){out*=this.scalar}if(this.filtered&&this.trimOutliers&&this.outlierTolerance){if(Math.abs(out-this.filtered)>this.outlierTolerance){out=this.filtered}}if(this.useDCBlock===true){out=this.dcb.applyFilter(out)}if(this.useSMA4===true){if(this.last4.length<4){this.last4.push(out)}else{out=this.last4.reduce((accumulator,currentValue)=>accumulator+currentValue)/this.last4.length;this.last4.shift();this.last4.push(out)}}if(this.useNotch50===true){this.notch50.forEach((f,i)=>{out=f.applyFilter(out)})}if(this.useNotch60===true){this.notch60.forEach((f,i)=>{out=f.applyFilter(out)})}if(this.useLowpass===true){this.lp1.forEach((f,i)=>{out=f.applyFilter(out)})}if(this.useBandpass===true){this.bp1.forEach((f,i)=>{out=f.applyFilter(out)})}this.filtered=out;this.idx++;return out}};var Biquad=class{constructor(type,freq,sps9,Q=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: 'lowpass','highpass','bandpass','notch','peak','lowshelf','highshelf'");return}this.type=type;this.freq=freq;this.sps=sps9;this.Q=Q;this.dbGain=dbGain;let A=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps9;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q);let beta=Math.sqrt(A+A);this[type](A,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A,sn,cs,alpha,beta){this.b0=1+alpha*A;this.b1=-2*cs;this.b2=1-alpha*A;this.a0=1+alpha/A;this.a1=-2*cs;this.a2=1-alpha/A}lowshelf(A,sn,cs,alpha,beta){this.b0=A*(A+1-(A-1)*cs+beta*sn);this.b1=2*A*(A-1-(A+1)*cs);this.b2=A*(A+1-(A-1)*cs-beta*sn);this.a0=A+1+(A+1)*cs+beta*sn;this.a1=2*(A-1+(A+1)*cs);this.a2=A+1+(A-1)*cs-beta*sn}highshelf(A,sn,cs,alpha,beta){this.b0=A*(A+1+(A-1)*cs+beta*sn);this.b1=2*A*(A-1+(A+1)*cs);this.b2=A*(A+1-(A-1)*cs-beta*sn);this.a0=A+1-(A+1)*cs-beta*sn;this.a1=2*(A-1-(A+1)*cs);this.a2=A+1-(A-1)*cs-beta*sn}applyFilter(signal_step){let y=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y;return y}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q}};var DCBlocker=class{constructor(r=.995){this.r=r;this.y1=this.y2=this.x1=this.x2=0}applyFilter(signal_step){this.x2=this.x1;this.x1=signal_step;let y=this.x1-this.x2+this.r*this.y1;this.y2=this.y1;this.y1=y;return y}};var makeNotchFilter=(frequency,sps9,bandwidth)=>{return new Biquad("notch",frequency,sps9,Biquad.calcNotchQ(frequency,bandwidth),0)};var makeBandpassFilter=(freqStart,freqEnd,sps9,resonance=Math.pow(10,Math.floor(Math.log10(Biquad.calcCenterFrequency(freqStart,freqEnd)))))=>{return new Biquad("bandpass",Biquad.calcCenterFrequency(freqStart,freqEnd),sps9,Biquad.calcBandpassQ(Biquad.calcCenterFrequency(freqStart,freqEnd),Biquad.calcBandwidth(freqStart,freqEnd),resonance),0)};function parseFunctionFromText2(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var stringifyWithCircularRefs2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs3(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs2}var stringifyFast2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast3(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast2}function loadStreamWorkerGlobals(){globalThis.WebSerial=WebSerial;globalThis.decoders=decoders;globalThis.decoder="raw";globalThis.ByteParser=ByteParser;globalThis.Devices=Devices;globalThis.filtering=true;globalThis.filters={};globalThis.BiquadChannelFilterer=BiquadChannelFilterer;globalThis.ArrayManip=ArrayManip}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){loadStreamWorkerGlobals()}var streamWorkerRoutes={"receiveDecoder":function receiveDecoder(decoder2,decoderName){globalThis.decoders[decoderName]=(0,eval)("("+decoder2+")")},"receiveCodec":function receiveDeviceCodec(decoder2,deviceType,device,service,characteristic){let codec=parseFunctionFromText2(decoder2);if(codec){if(deviceType==="BLE"&&service&&characteristic){if(globalThis.Devices[deviceType][device]){if(globalThis.Devices[deviceType][device][service]){if(globalThis.Devices[deviceType][device][characteristic]){globalThis.Devices[deviceType][device][characteristic].codec=codec}else{globalThis.Devices[deviceType][device][characteristic]={codec}}}else{globalThis.Devices[deviceType][device]={[characteristic]:{codec}}}}}else if(globalThis.Devices[deviceType][device]?.codec){if(globalThis.Devices[deviceType][device])globalThis.Devices[deviceType][device].codec=codec;else{globalThis.Devices[deviceType][device]={codec}}}}},"decode":function decode(data){return globalThis.decoder(data)},"decodeAndParse":function decodeAndParse(data){let decoded=this.__node.graph.run("decode",data);if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}}}}return parsed}}return decoded},"setActiveDecoder":function setActiveDecoder(deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device]?.codec;else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device][service][characteristic].codec;return true},"decodeDevice":function decodeDevice(data,deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)return globalThis.Devices[deviceType][device].codec(data);else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)return globalThis.Devices[deviceType][device][service][characteristic].codec(data)},"decodeAndParseDevice":function decodeAndParseDevice(data,deviceType,deviceName,service,characteristic){let decoded;if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][deviceName]?.services[service]?.[characteristic]?.codec)decoded=globalThis.Devices[deviceType][deviceName].services[service][characteristic].codec(data);else if(globalThis.Devices[deviceType][deviceName]?.codec)decoded=globalThis.Devices[deviceType][deviceName].codec(data);else decoded=data;if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}else if(typeof parsed[prop]==="number"){parsed[prop]=filter.apply(parsed[prop])}}}}return parsed}}return decoded},"toggleAnim":function toggleAnim(){globalThis.runningAnim=!globalThis.runningAnim;return globalThis.runningAnim},"setFilters":function setFilters(filters,clearFilters=false){if(!globalThis.filters||clearFilters)globalThis.filters={};for(const key in filters){globalThis.filters[key]=new BiquadChannelFilterer(filters[key])}return true},"getFilterSettings":function getFilterSettings(){if(globalThis.filters){let filters={};for(const key in globalThis.filters){filters[key]={sps:globalThis.filters[key].sps,useScaling:globalThis.filters[key].useScaling,scalar:globalThis.filters[key].scalar,useNotch50:globalThis.filters[key].useNotch50,useNotch60:globalThis.filters[key].useNotch60,useDCBlock:globalThis.filters[key].useDCBlock,useLowpass:globalThis.filters[key].useLowpass,lowpassHz:globalThis.filters[key].lowpassHz,useBandpass:globalThis.filters[key].useBandpass,bandpassLower:globalThis.filters[key].bandpassLower,bandpassUpper:globalThis.filters[key].bandpassUpper}}return filters}return void 0},"setupSerial":function setupSerial(){globalThis.Serial=new globalThis.WebSerial;globalThis.decoder="raw";console.log("worker: Setting up Serial",globalThis.Serial);return true},"openPort":function openPort(settings){const WorkerService2=this.__node.graph;if(!globalThis.Serial)WorkerService2.run("setupSerial");return new Promise((res,rej)=>{globalThis.Serial.getPorts().then(ports=>{const Serial=globalThis.Serial;let port=ports.find(port2=>{return port2.getInfo().usbVendorId===settings.usbVendorId&&port2.getInfo().usbProductId===settings.usbProductId});if(port){let options=Object.assign({},settings);if(typeof settings.pipeTo==="object"&&settings.pipeTo.extraArgs&&globalThis.Devices?.[settings.pipeTo.extraArgs[0]]?.[settings.pipeTo.extraArgs[1]]){options.onconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].onconnect;options.ondisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].ondisconnect;options.beforedisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].beforedisconnect}Serial.openPort(port,options).then(()=>{const stream=Serial.createStream({port,settings:options,frequency:settings.frequency?settings.frequency:10,buffering:settings.buffering,ondata:value=>{if(stream.settings.pipeTo){if(typeof stream.settings.pipeTo==="string")WorkerService2.transmit(value,stream.settings.pipeTo,[value.buffer]);else if(stream.settings.pipeTo?.route){let args=value;if(stream.settings.pipeTo.extraArgs)args=[value,...stream.settings.pipeTo.extraArgs];WorkerService2.transmit({route:stream.settings.pipeTo.route,args},stream.settings.pipeTo._id,[value.buffer])}}else{WorkerService2.transmit(value,void 0,[value.buffer])}}});Serial.readStream(stream);port.ondisconnect=()=>{postMessage(\`\${stream._id} disconnected\`)};res({_id:stream._id,settings,info:stream.info})}).catch(()=>{postMessage(\`disconnected\`)});;}else{rej(false)}})})},"closeStream":function closeStream(streamId){return new Promise((res,rej)=>{const Serial=globalThis.Serial;let ondisconnect;if(Serial.streams[streamId].port?.ondisconnect)ondisconnect=Serial.streams[streamId].port.ondisconnect;Serial.closeStream(Serial.streams[streamId]).then(resolved=>{if(ondisconnect)ondisconnect(void 0);res(resolved)}).catch(rej)})},"writeStream":function writeStream(streamId,message){globalThis.Serial.writeStream(globalThis.Serial.streams[streamId],message);return true},"updateStreamSettings":function updateStreamSettings(streamId,settings){if(globalThis.Serial?.streams[streamId]){for(const key in settings){if(typeof settings[key]==="object"){Object.assign(globalThis.Serial.streams[streamId].settings[key],settings[key])}else globalThis.Serial.streams[streamId][key]=settings[key]}}}};if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){const worker=new WorkerService({tree:{...workerCanvasRoutes,...subprocessRoutes,...streamWorkerRoutes}})}var stream_worker_default=self;})();
`)],{type:"text/javascript"})),Jr=Vr,ke=class{constructor(){this.recursivelyAssign=(s,e)=>{for(let t in e)typeof e[t]=="object"?typeof s[t]=="object"?this.recursivelyAssign(s[t],e[t]):s[t]=this.recursivelyAssign({},e[t]):s[t]=e[t];return s}}static autoscale(s,e=0,t=1,r=!1,i,n,l){if(s?.length===0)return s;let a=n||Math.max(...s),f=i||Math.min(...s),u=1/t,h=1;if(r){let _=Math.max(Math.abs(f),Math.abs(a));return _!==0&&(h=u/_),s.map(b=>(l&&(b<f&&(b=f),b>a&&(b=a)),b*h+(u*(e+1)*2-1-u)))}else return a===f?a!==0?h=u/a:f!==0&&(h=u/Math.abs(f)):h=u/(a-f),s.map(_=>(l&&(_<f&&(_=f),_>a&&(_=a)),2*((_-f)*h-1/(2*t))+(u*(e+1)*2-1-u)))}static genTimestamps(s,e){let t=Date.now(),r=[t-s*1e3/e,t];return ke.upsample(r,s)}static absmax(s){return Math.max(Math.abs(Math.min(...s)),Math.max(...s))}static downsample(s,e,t=1){if(s.length>e){let r=new Array(e),i=s.length/e,n=s.length-1,l=0,a=0;for(let f=i;f<s.length;f+=i){let u=Math.round(f);u>n&&(u=n);for(let h=l;h<u;h++)r[a]+=s[h];r[a]/=(u-l)*t,a++,l=u}return r}else return s}static upsample(s,e,t=1){var r=function(_,b,m){return(_+(b-_)*m)*t},i=new Array(e),n=(s.length-1)/(e-1);i[0]=s[0];for(var l=1;l<e-1;l++){var a=l*n,f=Math.floor(a),u=Math.ceil(a),h=a-f;i[l]=r(s[f],s[u],h)}return i[e-1]=s[s.length-1],i}static interpolate(s,e,t=1){return s.length>e?ke.downsample(s,e,t):s.length<e?ke.upsample(s,e,t):s}static HSLToRGB(s,e,t,r=255){e/=100,t/=100;let i=(1-Math.abs(2*t-1))*e,n=i*(1-Math.abs(s/60%2-1)),l=t-i/2,a=0,f=0,u=0;return 0<=s&&s<60?(a=i,f=n,u=0):60<=s&&s<120?(a=n,f=i,u=0):120<=s&&s<180?(a=0,f=i,u=n):180<=s&&s<240?(a=0,f=n,u=i):240<=s&&s<300?(a=n,f=0,u=i):300<=s&&s<360&&(a=i,f=0,u=n),a=(a+l)*r,f=(f+l)*r,u=(u+l)*r,[a,f,u]}static circularBuffer(s,e){if(e.length<s.length){let t=s.slice(e.length),r=s.length;s.splice(0,r,...t,...e)}else if(e.length>s.length){let t=s.length;s.splice(0,t,e.slice(t-e.length))}else s.splice(0,s.length,...e);return s}static reformatData(s,e){if(Array.isArray(s)){if(Array.isArray(s[0])){let t={};if(s.forEach((r,i)=>{t[i]=r}),s=t,isNaN(s[0][0]))return}else if(e){if(s={[e]:s},isNaN(s[e][0]))return}else if(s={0:s},isNaN(s[0][0]))return}else if(typeof s=="object"){for(let t in s)if(typeof s[t]=="number"?s[t]=[s[t]]:s[t]?.values&&typeof s[t].values=="number"&&(s[t].values=[s[t].values]),isNaN(s[t][0]))return}else if(typeof s=="string"){let t;if(s.includes(`\r
`)){let r=s.split(`\r
`);s={},r.forEach((i,n)=>{i.includes("	")?t=i.split("	"):i.includes(",")?t=i.split(","):i.includes("|")&&(t=i.split("|")),Array.isArray(t)&&t.forEach((l,a)=>{if(l.includes(":")){let[f,u]=l.split(":"),h=parseFloat(u);if(h)s[f]=[h];else return}else{let f=parseFloat(l);if(f)s[a]=[f];else return}})})}else s.includes("	")?t=s.split("	"):s.includes(",")?t=s.split(","):s.includes("|")&&(t=s.split("|"));s={},Array.isArray(t)&&t.forEach((r,i)=>{if(r.includes(":")){let[n,l]=r.split(":"),a=parseFloat(l);if(a)s[n]=[a];else return}else{let n=parseFloat(r);if(n)s[i]=[n];else return}})}else typeof s=="number"&&(e?s={[e]:[s]}:s={0:[s]});return s}static padTime(s,e,t,r){let i=(s[0]-e)/t/r;return[...new Array(r-s.length).map((l,a)=>e+i*(a+1)),...s]}static interpolateForTime(s,e,t){return ke.interpolate(s,Math.ceil(t*e))}isTypedArray(s){return ArrayBuffer.isView(s)&&Object.prototype.toString.call(s)!=="[object DataView]"}spliceTypedArray(s,e,t){let r=s.subarray(0,e),i;t&&(i=s.subarray(t+1));let n;return(r.length>0||i?.length>0)&&(n=new s.constructor(r.length+i.length)),r.length>0&&n.set(r),i&&i.length>0&&n.set(i,r.length),n}},ls=ke;ls.bufferValues=(s,e,t,r)=>{if(!Array.isArray(t)&&typeof t=="object"&&(t=Object.keys(t)),!r){let n=Object.keys(s);t?r=new Float32Array(n.length*t.length):typeof s[n[0]][e]=="object"?(t=Object.keys(s[n[0]][e]),r=new Float32Array(n.length*t.length)):r=new Float32Array(n.length)}let i=0;for(let n in s)if(s[n][e])if(t)for(let l=0;l<t.length;l++)r[i]=s[n][e][t[l]],i++;else r[i]=s[n][e],i++;return r};var qr=/^([<>])?(([1-9]\d*)?([xcbB?hHiIfdsp]))*$/,Ur=/([1-9]\d*)?([xcbB?hHiIfdsp])/g,lt=(s,e,t)=>String.fromCharCode(...new Uint8Array(s.buffer,s.byteOffset+e,t)),ct=(s,e,t,r)=>new Uint8Array(s.buffer,s.byteOffset+e,t).set(r.split("").map(i=>i.charCodeAt(0))),Wr=(s,e,t)=>lt(s,e+1,Math.min(s.getUint8(e),t-1)),Hr=(s,e,t,r)=>{s.setUint8(e,r.length),ct(s,e+1,t-1,r)},Gr=s=>({x:e=>[1,e,0],c:e=>[e,1,t=>({u:r=>lt(r,t,1),p:(r,i)=>ct(r,t,1,i)})],"?":e=>[e,1,t=>({u:r=>Boolean(r.getUint8(t)),p:(r,i)=>r.setUint8(t,i)})],b:e=>[e,1,t=>({u:r=>r.getInt8(t),p:(r,i)=>r.setInt8(t,i)})],B:e=>[e,1,t=>({u:r=>r.getUint8(t),p:(r,i)=>r.setUint8(t,i)})],h:e=>[e,2,t=>({u:r=>r.getInt16(t,s),p:(r,i)=>r.setInt16(t,i,s)})],H:e=>[e,2,t=>({u:r=>r.getUint16(t,s),p:(r,i)=>r.setUint16(t,i,s)})],i:e=>[e,4,t=>({u:r=>r.getInt32(t,s),p:(r,i)=>r.setInt32(t,i,s)})],I:e=>[e,4,t=>({u:r=>r.getUint32(t,s),p:(r,i)=>r.setUint32(t,i,s)})],f:e=>[e,4,t=>({u:r=>r.getFloat32(t,s),p:(r,i)=>r.setFloat32(t,i,s)})],d:e=>[e,8,t=>({u:r=>r.getFloat64(t,s),p:(r,i)=>r.setFloat64(t,i,s)})],s:e=>[1,e,t=>({u:r=>lt(r,t,e),p:(r,i)=>ct(r,t,e,i.slice(0,e))})],p:e=>[1,e,t=>({u:r=>Wr(r,t,e),p:(r,i)=>Hr(r,t,e,i.slice(0,e-1))})]}),Jt=new RangeError("Structure larger than remaining buffer"),zr=new RangeError("Not enough values for structure"),be=class extends ls{static toDataView(s){if(!(s instanceof DataView))if(typeof s=="string"&&parseInt(s)&&(s=parseInt(s)),typeof s=="string"){let e=new TextEncoder,t={};for(let i in be.codes)for(;s.indexOf(i)>-1;){let n=s.indexOf(i);s=s.replace(i,""),t[n]=i}let r=Array.from(e.encode(s));for(let i in t)r.splice(parseInt(i),0,be.codes[t[i]]);s=new DataView(new Uint8Array(r).buffer)}else if(typeof s=="number"){let e=s;s<256?(s=new DataView(new ArrayBuffer(1)),s.setUint8(0,e)):s<65536?(s=new DataView(new ArrayBuffer(2)),s.setInt16(0,e)):(s=new DataView(new ArrayBuffer(4)),s.setUint32(0,e))}else s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer?s=new DataView(s):Array.isArray(s)?s=new DataView(Uint8Array.from(s).buffer):typeof s=="object"&&(s=new TextEncoder().encode(JSON.stringify(s)));return s}static searchBuffer(s,e,t){for(var r=e,i=s,n=be.boyerMoore(r),l=n.byteLength,a=[],f=n(i);f!==-1&&(a.push(f),!(t&&a.length>=t));f=n(i,f+l));return a}static bytesToInt16(s,e){let t=(255&s)<<8|255&e;return(t&32768)>0?t|=4294901760:t&=65535,t}static bytesToUInt16(s,e){return s*256+e}static Uint16ToBytes(s){return[s&255,s>>8&255]}static bytesToInt24(s,e,t){let r=(255&s)<<16|(255&e)<<8|255&t;return(r&8388608)>0?r|=4278190080:r&=16777215,r}static bytesToUInt24(s,e,t){return s*65536+e*256+t}static Uint24ToBytes(s){return[s&255,s>>8&255,s>>16&255]}static bytesToInt32(s,e,t,r){let i=(255&s)<<24|(255&e)<<16|(255&t)<<8|255&r;return(i&2147483648)>0?i|=0:i&=4294967295,i}static bytesToUInt32(s,e,t,r){return s*16777216+e*65536+t*256+r}static Uint32ToBytes(s){return[s&255,s>>8&255,s>>16&255,s>>24&255]}static get2sCompliment(s,e){return s>4294967296?null:s<<32-e>>32-e}static getSignedInt(...s){let e=0;function t(r){for(var i=0,n=!0;r--;)if(n){let l=s[e++];i+=l&127,l&128&&(i-=128),n=!1}else i*=256,i+=s[e++];return i}return t(s.length)}static asUint8Array(s){if(s instanceof Uint8Array)return s;if(typeof s=="string"){for(var e=new Uint8Array(s.length),t=0;t<s.length;t++){var r=s.charCodeAt(t);if(r>127)throw new TypeError("Only ASCII patterns are supported");e[t]=r}return e}else return new Uint8Array(s)}static boyerMoore(s){var e=be.asUint8Array(s),t=e.length;if(t===0)throw new TypeError("patternBuffer must be at least 1 byte long");for(var r=256,i=new Int32Array(r),n=0;n<r;n++)i[n]=-1;for(var l=0;l<t;l++)i[e[l]]=l;var a=(f,u,h)=>{var _=be.asUint8Array(f);u===void 0&&(u=0),h===void 0&&(h=_.length);for(var b=e,m=i,x=h-b.length,o=b.length-1,c,d=u;d<=x;d+=c){c=0;for(var p=o;p>=0;p--){var g=_[d+p];if(b[p]!==g){c=Math.max(1,p-m[g]);break}}if(c===0)return d}return-1};return a.byteLength=e.byteLength,a}static struct(s){let e=[],t=0,r=qr.exec(s);if(!r)throw new RangeError("Invalid format string");let i=Gr(r[1]==="<"),n=(_,b)=>i[b](_?parseInt(_,10):1);for(;r=Ur.exec(s);)((_,b,m)=>{for(let x=0;x<_;++x,t+=b)m&&e.push(m(t))})(...n(...r.slice(1)));let l=(_,b)=>{if(_.byteLength<(b|0)+t)throw Jt;let m=new DataView(_,b|0);return e.map(x=>x.u(m))},a=(_,b,...m)=>{if(m.length<e.length)throw zr;if(_.byteLength<b+t)throw Jt;let x=new DataView(_,b);new Uint8Array(_,b,t).fill(0),e.forEach((o,c)=>o.p(x,m[c]))},f=(..._)=>{let b=new ArrayBuffer(t);return a(b,0,..._),b},u=_=>l(_,0);function*h(_){for(let b=0;b+t<=_.byteLength;b+=t)yield l(_,b)}return Object.freeze({unpack:u,pack:f,unpack_from:l,pack_into:a,iter_unpack:h,format:s,size:t})}},O=be;O.codes={"\\n":10,"\\r":13,"\\t":9,"\\s":32,"\\b":8,"\\f":12,"\\":92};var qt;(function(s){s[s.SCAN_MODE_LOW_POWER=0]="SCAN_MODE_LOW_POWER",s[s.SCAN_MODE_BALANCED=1]="SCAN_MODE_BALANCED",s[s.SCAN_MODE_LOW_LATENCY=2]="SCAN_MODE_LOW_LATENCY"})(qt||(qt={}));pt();gt();pt();var E=Ht("BluetoothLe",{web:()=>Promise.resolve().then(()=>($s(),zt)).then(s=>new s.BluetoothLeWeb)}),Yr=Vs(Ks());function rt(s){return s?(0,Yr.default)(1):e=>e()}function I(s){if(typeof s!="string")throw new Error(`Invalid UUID type ${typeof s}. Expected string.`);if(s=s.toLowerCase(),!(s.search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0))throw new Error(`Invalid UUID format ${s}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`);return s}var Xr=class{constructor(){this.scanListener=null,this.eventListeners=new Map,this.queue=rt(!0)}enableQueue(){this.queue=rt(!0)}disableQueue(){this.queue=rt(!1)}async initialize(s){await this.queue(async()=>{await E.initialize(s)})}async getEnabled(){return this.isEnabled()}async isEnabled(){return await this.queue(async()=>(await E.isEnabled()).value)}async enable(){await this.queue(async()=>{await E.enable()})}async disable(){await this.queue(async()=>{await E.disable()})}async startEnabledNotifications(s){await this.queue(async()=>{var e;let t="onEnabledChanged";await((e=this.eventListeners.get(t))===null||e===void 0?void 0:e.remove());let r=await E.addListener(t,i=>{s(i.value)});this.eventListeners.set(t,r),await E.startEnabledNotifications()})}async stopEnabledNotifications(){await this.queue(async()=>{var s;let e="onEnabledChanged";await((s=this.eventListeners.get(e))===null||s===void 0?void 0:s.remove()),this.eventListeners.delete(e),await E.stopEnabledNotifications()})}async isLocationEnabled(){return await this.queue(async()=>(await E.isLocationEnabled()).value)}async openLocationSettings(){await this.queue(async()=>{await E.openLocationSettings()})}async openBluetoothSettings(){await this.queue(async()=>{await E.openBluetoothSettings()})}async openAppSettings(){await this.queue(async()=>{await E.openAppSettings()})}async setDisplayStrings(s){await this.queue(async()=>{await E.setDisplayStrings(s)})}async requestDevice(s){return await this.queue(async()=>await E.requestDevice(s))}async requestLEScan(s,e){await this.queue(async()=>{var t;await((t=this.scanListener)===null||t===void 0?void 0:t.remove()),this.scanListener=await E.addListener("onScanResult",r=>{let i=Object.assign(Object.assign({},r),{manufacturerData:this.convertObject(r.manufacturerData),serviceData:this.convertObject(r.serviceData),rawAdvertisement:r.rawAdvertisement?this.convertValue(r.rawAdvertisement):void 0});e(i)}),await E.requestLEScan(s)})}async stopLEScan(){await this.queue(async()=>{var s;await((s=this.scanListener)===null||s===void 0?void 0:s.remove()),this.scanListener=null,await E.stopLEScan()})}async getDevices(s){return this.queue(async()=>(await E.getDevices({deviceIds:s})).devices)}async getConnectedDevices(s){return this.queue(async()=>(await E.getConnectedDevices({services:s})).devices)}async connect(s,e,t){await this.queue(async()=>{var r;if(e){let i=`disconnected|${s}`;await((r=this.eventListeners.get(i))===null||r===void 0?void 0:r.remove());let n=await E.addListener(i,()=>{e(s)});this.eventListeners.set(i,n)}await E.connect(Object.assign({deviceId:s},t))})}async createBond(s){await this.queue(async()=>{await E.createBond({deviceId:s})})}async isBonded(s){return await this.queue(async()=>(await E.isBonded({deviceId:s})).value)}async disconnect(s){await this.queue(async()=>{await E.disconnect({deviceId:s})})}async getServices(s){return await this.queue(async()=>(await E.getServices({deviceId:s})).services)}async readRssi(s){return await this.queue(async()=>{let t=await E.readRssi({deviceId:s});return parseFloat(t.value)})}async read(s,e,t,r){return e=I(e),t=I(t),await this.queue(async()=>{let n=await E.read(Object.assign({deviceId:s,service:e,characteristic:t},r));return this.convertValue(n.value)})}async write(s,e,t,r,i){return e=I(e),t=I(t),this.queue(async()=>{if(!r?.buffer)throw new Error("Invalid data.");let n=r;se.getPlatform()!=="web"&&(n=tt(r)),await E.write(Object.assign({deviceId:s,service:e,characteristic:t,value:n},i))})}async writeWithoutResponse(s,e,t,r,i){e=I(e),t=I(t),await this.queue(async()=>{if(!r?.buffer)throw new Error("Invalid data.");let n=r;se.getPlatform()!=="web"&&(n=tt(r)),await E.writeWithoutResponse(Object.assign({deviceId:s,service:e,characteristic:t,value:n},i))})}async readDescriptor(s,e,t,r,i){return e=I(e),t=I(t),r=I(r),await this.queue(async()=>{let l=await E.readDescriptor(Object.assign({deviceId:s,service:e,characteristic:t,descriptor:r},i));return this.convertValue(l.value)})}async writeDescriptor(s,e,t,r,i,n){return e=I(e),t=I(t),r=I(r),this.queue(async()=>{if(!i?.buffer)throw new Error("Invalid data.");let l=i;se.getPlatform()!=="web"&&(l=tt(i)),await E.writeDescriptor(Object.assign({deviceId:s,service:e,characteristic:t,descriptor:r,value:l},n))})}async startNotifications(s,e,t,r){e=I(e),t=I(t),await this.queue(async()=>{var i;let n=`notification|${s}|${e}|${t}`;await((i=this.eventListeners.get(n))===null||i===void 0?void 0:i.remove());let l=await E.addListener(n,a=>{r(this.convertValue(a?.value))});this.eventListeners.set(n,l),await E.startNotifications({deviceId:s,service:e,characteristic:t})})}async stopNotifications(s,e,t){e=I(e),t=I(t),await this.queue(async()=>{var r;let i=`notification|${s}|${e}|${t}`;await((r=this.eventListeners.get(i))===null||r===void 0?void 0:r.remove()),this.eventListeners.delete(i),await E.stopNotifications({deviceId:s,service:e,characteristic:t})})}convertValue(s){return typeof s=="string"?Fe(s):s===void 0?new DataView(new ArrayBuffer(0)):s}convertObject(s){if(s===void 0)return;let e={};for(let t of Object.keys(s))e[t]=this.convertValue(s[t]);return e}},$r=new Xr;gt();var qe=class extends O{constructor(s,e){super(),this.client=$r,this.devices={},this.location=!1,this.initialized=!1,this.setupDevice=(t,r)=>new Promise(async(i,n)=>{this.devices[t.deviceId]={device:t,deviceId:t.deviceId,...r},this.client.connect(t.deviceId,l=>{this.devices[t.deviceId]?.ondisconnect&&this.devices[t.deviceId].ondisconnect(l)},r?.connectOptions).then(async()=>{let l=await this.getServices(t.deviceId);for(let a in r?.services){let f=l.find(u=>{if(u.uuid===a)return!0});if(f)for(let u in r.services[a]){if(!f.characteristics.find(_=>{if(_.uuid===u)return!0}))continue;let h=r.services[a][u];h.write&&await this.write(t,a,u,h.write,h.writeCallback,h.writeOptions),h.read&&await this.read(t,a,u,h.readCallback,h.readOptions),h.notify&&h.notifyCallback&&(await this.subscribe(t,a,u,h.notifyCallback),h.notifying=!0)}}}).catch(n),i(this.devices[t.deviceId])}),this.triangulate=(t,r=1500,i=60)=>new Promise((n,l)=>{if("Accelerometer"in globalThis){if(typeof globalThis.Accelerometer=="function"){let a=new globalThis.Accelerometer({frequency:i}),f=performance.now(),u=f,h={samples:[],vector:{}},_=()=>{if(u-f<r)this.readRssi(t).then(b=>{let m=a.x,x=a.y,o=a.z;u=performance.now(),h.samples.push({x:m,y:x,z:o,rssi:b,timestamp:u})});else{let b={x:0,y:0,z:0,rssiAvg:0};h.samples.forEach(m=>{}),a.removeEventListener("reading",_)}};a.addEventListener("reading",_)}}else l(new Error("No Accelerometer API detected"))}),e&&(this.location=e),s&&this.setup(s)}setup(s,e=this.location){let t=[];if(s)for(let i in s.services)t.push(i);let r={};return e||(r.androidNeverForLocation=!1),new Promise(async(i,n)=>{if(this.initialized||(await this.client.initialize(r),this.initialized=!0),s?.deviceId)i(await this.reconnect(s.deviceId));else if(s){let l={filters:[{services:t}]};this.isMobile()||(l.optionalServices=t),s?.namePrefix&&(l.filters[0].namePrefix=s.namePrefix),s?.name&&(l.filters[0].name=s.name),this.client.requestDevice(l).then(a=>{i(this.setupDevice(a,s))}).catch(n)}else this.client.requestDevice().then(l=>{i(this.setupDevice(l,s))}).catch(n)})}initialize(s){return new Promise((e,t)=>{this.client.initialize(s).then(()=>{e(!0)}).catch(t)})}requestDevice(s,e){return new Promise((t,r)=>{this.client.requestDevice(s).then(i=>{this.devices[i.deviceId]={device:i,deviceId:i.deviceId,...e},t(i)}).catch(r)})}getServices(s){return this.client.getServices(s)}connect(s,e){return new Promise((t,r)=>{this.client.connect(s.deviceId,i=>{e?.ondisconnect&&e.ondisconnect(i)},e?.connectOptions).then(i=>{t(s)}).catch(r)})}reconnect(s,e){return new Promise((t,r)=>{let i=this.isAndroid(),n=this.isMobile();console.log(s);let l=e;this.devices[s]&&(l=Object.assign(Object.assign({},this.devices[s]),l)),l?.deviceId&&delete l.deviceId,!n&&!navigator.bluetooth?.getDevices&&this.setup(l).then(a=>{t(a)}),i&&this.client.getDevices([s]).then(a=>{this.setupDevice(a[0],l).then(f=>{t(f)})}).catch(r)})}disconnect(s){if(typeof s=="object"&&s?.deviceId&&(s=s.deviceId),typeof s=="string"){let e=this.devices[s];e.beforedisconnect&&e.beforedisconnect(this,e),delete this.devices[s],this.client.disconnect(s)}}write(s,e,t,r,i,n){return typeof s=="object"&&(s=s.deviceId),i?this.client.write(s,e,t,qe.toDataView(r)).then(i):this.client.writeWithoutResponse(s,e,t,qe.toDataView(r),n)}read(s,e,t,r,i){return typeof s=="object"&&(s=s.deviceId),r?this.client.read(s,e,t,i).then(r):this.client.read(s,e,t,i)}subscribe(s,e,t,r){return typeof s=="object"&&(s=s.deviceId),this.client.startNotifications(s,e,t,r)}unsubscribe(s,e,t){return typeof s=="object"&&(s=s.deviceId),this.client.stopNotifications(s,e,t)}scan(s,e){return this.client.requestLEScan(s,e)}stopScanning(){return this.client.stopLEScan()}readDescriptor(s,e,t,r,i){return this.client.readDescriptor(s.deviceId,e,t,r,i)}writeDescriptor(s,e,t,r,i,n){return this.client.writeDescriptor(s.deviceId,e,t,r,qe.toDataView(i),n)}readRssi(s){return this.client.readRssi(s.deviceId)}isMobile(){let s=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(s=!0)}(navigator.userAgent||navigator.vendor||window.opera),s}isAndroid(){return navigator.userAgent.toLowerCase().indexOf("android")>-1}async distance(s,e,t,r,i){let n=await this.readRssi(s);if(n==0)return;let l=n/e;return l<1?Math.pow(l,10):t*Math.pow(l,r)+i}async distanceFromPhone(s,e,t){let r,i,n;return t&&(t==="nexus5"?(r=.42093,i=6.9476,n=.54992):t==="motoX"?(r=.9401940951,i=6.170094565,n=0):t==="iphone5"&&(r=.89976,i=7.7095,n=.111)),await this.distance(s,e,r,i,n)}},Se=class extends O{constructor(){super(...arguments),this.streams={},this.createStream=s=>{let e={_id:s._id?s._id:`stream${Math.floor(Math.random()*1e15)}`,info:s.port.getInfo(),running:!1,...s};return s.port?.readable&&(s.transforms?e.reader=Se.setStreamTransforms(s.port.readable,s.transforms).getReader():e.reader=s.port.readable.getReader()),this.streams[e._id]=e,e}}getPorts(){return navigator.serial.getPorts()}requestPort(s,e){let t={};return s&&(t.usbVendorId=s),e&&(t.usbProductId=e),t.usbVendorId?navigator.serial.requestPort({filters:[t]}):navigator.serial.requestPort()}openPort(s,e){return e&&(e=Object.assign({},e)),e?.ondisconnect&&(s.ondisconnect=e.ondisconnect,delete e.ondisconnect),s.open(e).then(()=>{e?.onconnect&&e.onconnect(s)})}async readWithTimeout(s,e){let t=s.readable.getReader(),r=setTimeout(()=>{t.releaseLock()},e),i=await t.read();return clearTimeout(r),t.releaseLock(),i}async writePort(s,e){let t=s.writable.getWriter();return await t.write(Se.toDataView(e)),t.releaseLock(),!0}getSignals(s){return s.getSignals()}setSignals(s,e){return s.setSignals(e)}readStream(s){if(s.reader&&!s.running){let e=s.reader;s.buffering&&(typeof s.buffering!="object"&&(s.buffering={}),s.buffering.buffer||(s.buffering.buffer=[]),s.buffering.searchBytes||(s.buffering.searchBytes=new Uint8Array([13,10])));let t=()=>{if(s.port.readable&&s.running)e.read().then(r=>{if(r.done)e.releaseLock();else{if(s.buffering){s.buffering.buffer.push(...r.value);let n=s.buffering.searchBytes,l=s.buffering.buffer,a=Se.boyerMoore(n),f=a.byteLength,u=-1;for(var i=a(l);i!==-1;i=a(l,i+f))!s.buffering.locked&&!("lockIdx"in s.buffering)?s.buffering.lockIdx=i:(u=i,u>=0&&(s.buffering.locked?u>0&&s.ondata(new Uint8Array(s.buffering.buffer.splice(s.buffering.searchBytes.length,u))):(s.ondata(new Uint8Array(s.buffering.buffer.splice(s.buffering.lockIdx+s.buffering.searchBytes.length,u+s.buffering.searchBytes.length))),s.buffering.buffer.splice(0,s.buffering.searchBytes.length),s.buffering.locked=!0)))}else s.ondata(r.value);setTimeout(()=>{t()},s.frequency)}}).catch(r=>{console.error(s._id," Read error:",r),(r.message.includes("overrun")||r.message.includes("framing"))&&(delete s.reader,this.reconnect(s))});else if(!s.running&&s.port.readable)try{e.releaseLock()}catch(r){console.error(r)}};return s.running=!0,t(),s}}writeStream(s,e){if(typeof s=="string"&&(s=this.streams[s]),s.port.writable){let t=s.port.writable.getWriter();return t.write(Se.toDataView(e)),t.releaseLock(),!0}}closeStream(s,e){return typeof s=="string"&&(s=this.streams[s]),s.running=!1,new Promise((t,r)=>{s.settings.beforedisconnect&&s.settings.beforedisconnect(this,s.port),setTimeout(async()=>{if(s.port.readable&&s.reader){try{s.reader.releaseLock()}catch(i){console.error(i)}if(s.transforms)try{await s.reader.cancel()}catch(i){console.error(i)}}try{await s.port.close().then(()=>{e&&e(this.streams[s._id])}),delete this.streams[s._id],t(!0)}catch(i){r(i)}},300)})}reconnect(s,e){return typeof s=="string"&&(s=this.streams[s]),new Promise((t,r)=>{if(typeof s!="object"){r(void 0);return}let i=s.port.getInfo();this.closeStream(s._id).then(n=>{setTimeout(()=>{this.getPorts().then(l=>{for(let a=0;a<l.length;a++)l[a].getInfo().usbVendorId===i.usbVendorId&&l[a].getInfo().usbProductId===i.usbProductId&&(e?e._id=s._id:e=s,delete e.port,this.openPort(l[a],e.settings).then(()=>{let f=this.createStream({...e,port:l[a]});this.readStream(f),t(f)}).catch(r))}).catch(r)},100)})})}static setStreamTransforms(s,e){let t=[];Object.keys(e).forEach(i=>{let n=e[i];if(n instanceof TransformStream)t.push(n);else{n.start||(n.start=function(){}),n.flush||(n.flush=function(){});let l=new TransformStream({start:n.start,transform:n.transform,flush:n.flush},n.writableStrategy,n.readableStrategy);t.push(l)}});let r=s;return t.forEach(i=>{r=r.pipeThrough(i)}),r}};function xe(s){let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let r=0;r<9;r++){let i=r*25;t[0][r]=O.bytesToInt24(e[i],e[i+1],e[i+2]),t[1][r]=O.bytesToInt24(e[i+3],e[i+4],e[i+5]),t[2][r]=O.bytesToInt24(e[i+6],e[i+7],e[i+8]),t[3][r]=O.bytesToInt24(e[i+9],e[i+10],e[i+11]),t[4][r]=O.bytesToInt24(e[i+12],e[i+13],e[i+14]),t[5][r]=O.bytesToInt24(e[i+15],e[i+16],e[i+17]),t[6][r]=O.bytesToInt24(e[i+18],e[i+19],e[i+20]),t[7][r]=O.bytesToInt24(e[i+21],e[i+22],e[i+23])}return t}var Pn=new TextDecoder;var cs=250,$={nSec:10,sps:cs,units:"mV"},jn={lines:{0:JSON.parse(JSON.stringify($)),1:JSON.parse(JSON.stringify($)),2:JSON.parse(JSON.stringify($)),3:JSON.parse(JSON.stringify($)),4:JSON.parse(JSON.stringify($)),5:JSON.parse(JSON.stringify($)),6:JSON.parse(JSON.stringify($)),7:JSON.parse(JSON.stringify($))}},Kr=32,Zr=24,Qr=1.2,K={sps:cs,useDCBlock:!1,useBandpass:!1,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:.96*1e3*Qr/(Kr*(Math.pow(2,Zr)-1))},Ln={0:JSON.parse(JSON.stringify(K)),1:JSON.parse(JSON.stringify(K)),2:JSON.parse(JSON.stringify(K)),3:JSON.parse(JSON.stringify(K)),4:JSON.parse(JSON.stringify(K)),5:JSON.parse(JSON.stringify(K)),6:JSON.parse(JSON.stringify(K)),7:JSON.parse(JSON.stringify(K))};function ei(s){let e;s.buffer?e=s:e=new Uint8Array(s);let t={};for(let i=0;i<8;i++){let n=1+3*i;t[i]=O.bytesToInt24(e[n],e[n+1],e[n+2])}let r=25;return t.ax=O.bytesToInt16(e[r],e[r+1]),t.ay=O.bytesToInt16(e[r+2],e[r+3]),t.az=O.bytesToInt16(e[r+4],e[r+5]),t.gx=O.bytesToInt16(e[r+6],e[r+7]),t.gy=O.bytesToInt16(e[r+8],e[r+9]),t.gz=O.bytesToInt16(e[r+10],e[r+11]),t.timestamp=Date.now(),t}function ti(s){let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={};for(let i=0;i<8;i++){let n=1+3*i;e[0]%2===0?t[i+7]=O.bytesToInt24(e[n],e[n+1],e[n+2]):t[i]=O.bytesToInt24(e[n],e[n+1],e[n+2])}let r=25;return t.ax=O.bytesToInt16(e[r],e[r+1]),t.ay=O.bytesToInt16(e[r+2],e[r+3]),t.az=O.bytesToInt16(e[r+4],e[r+5]),t.gx=O.bytesToInt16(e[r+6],e[r+7]),t.gy=O.bytesToInt16(e[r+8],e[r+9]),t.gz=O.bytesToInt16(e[r+10],e[r+11]),t}var Oe=250,Ut={baudRate:115200,codec:ei,write:"b",beforedisconnect:(s,e)=>{s.writePort(e,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:Oe},si={baudRate:115200,codec:ti,write:"b",beforedisconnect:(s,e)=>{s.writePort(e,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:Oe},Z={nSec:10,sps:Oe,units:"mV"},pe={nSec:10,sps:Oe},In={lines:{0:JSON.parse(JSON.stringify(Z)),1:JSON.parse(JSON.stringify(Z)),2:JSON.parse(JSON.stringify(Z)),3:JSON.parse(JSON.stringify(Z)),4:JSON.parse(JSON.stringify(Z)),5:JSON.parse(JSON.stringify(Z)),6:JSON.parse(JSON.stringify(Z)),7:JSON.parse(JSON.stringify(Z)),ax:JSON.parse(JSON.stringify(pe)),ay:JSON.parse(JSON.stringify(pe)),az:JSON.parse(JSON.stringify(pe)),gx:JSON.parse(JSON.stringify(pe)),gy:JSON.parse(JSON.stringify(pe)),gz:JSON.parse(JSON.stringify(pe))},generateNewLines:!0},B={sps:Oe,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))},Bn={0:JSON.parse(JSON.stringify(B)),1:JSON.parse(JSON.stringify(B)),2:JSON.parse(JSON.stringify(B)),3:JSON.parse(JSON.stringify(B)),4:JSON.parse(JSON.stringify(B)),5:JSON.parse(JSON.stringify(B)),6:JSON.parse(JSON.stringify(B)),7:JSON.parse(JSON.stringify(B)),8:JSON.parse(JSON.stringify(B)),9:JSON.parse(JSON.stringify(B)),10:JSON.parse(JSON.stringify(B)),11:JSON.parse(JSON.stringify(B)),12:JSON.parse(JSON.stringify(B)),13:JSON.parse(JSON.stringify(B)),14:JSON.parse(JSON.stringify(B)),15:JSON.parse(JSON.stringify(B))};function ri(s){let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={};for(let i=0;i<128;i++){let n=i*3+1;t[i]=O.bytesToInt24(e[n],e[n+1],e[n+2])}let r=385;return t.ax=O.bytesToInt16(e[r],e[r+1]),t.ay=O.bytesToInt16(e[r+2],e[r+3]),t.az=O.bytesToInt16(e[r+4],e[r+5]),t.gx=O.bytesToInt16(e[r+6],e[r+7]),t.gy=O.bytesToInt16(e[r+8],e[r+9]),t.gz=O.bytesToInt16(e[r+10],e[r+11]),t.timestamp=Date.now(),t}var te=250,ii={baudRate:921600,bufferSize:2e3,frequency:1.9,codec:ri,sps:te,buffering:{searchBytes:new Uint8Array([192,160])}},ni={lines:{ax:{nSec:10,sps:te},ay:{nSec:10,sps:te},az:{nSec:10,sps:te},gx:{nSec:10,sps:te},gy:{nSec:10,sps:te},gz:{nSec:10,sps:te}}},ai={};for(let s=0;s<128;s++)ni.lines[s]={sps:te,nSec:10,units:"mV"},ai[s]={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))};function fs(s){let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={};for(let i=0;i<32;i++){let n=i*3+1;t[i]=O.bytesToInt24(e[n],e[n+1],e[n+2])}let r=97;return t.ax=O.bytesToInt16(e[r],e[r+1]),t.ay=O.bytesToInt16(e[r+2],e[r+3]),t.az=O.bytesToInt16(e[r+4],e[r+5]),t.gx=O.bytesToInt16(e[r+6],e[r+7]),t.gy=O.bytesToInt16(e[r+8],e[r+9]),t.gz=O.bytesToInt16(e[r+10],e[r+11]),t.timestamp=Date.now(),t}var Ae=512,oi={baudRate:921600,bufferSize:2e3,frequency:1.9,codec:fs,sps:Ae,buffering:{searchBytes:new Uint8Array([192,160])}},li={baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:fs,sps:Ae,buffering:{searchBytes:new Uint8Array([192,160])}},ge={nSec:10,sps:Ae},ci={lines:{ax:JSON.parse(JSON.stringify(ge)),ay:JSON.parse(JSON.stringify(ge)),az:JSON.parse(JSON.stringify(ge)),gx:JSON.parse(JSON.stringify(ge)),gy:JSON.parse(JSON.stringify(ge)),gz:JSON.parse(JSON.stringify(ge))}},fi={};for(let s=0;s<32;s++)ci.lines[s]={sps:Ae,nSec:10,units:"mV"},fi[s]={sps:Ae,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))};var di=new TextDecoder;function ds(s){let e={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0},t=di.decode(s),r=t.split("|");if(r.length===3)e.timestamp=Date.now(),e.red=parseInt(r[0]),e.infrared=parseInt(r[1]),e.heg=parseFloat(r[2]);else return r.length>=2?(e.timestamp=Date.now(),e.red=parseInt(r[1]),e.infrared=parseInt(r[2]),e.heg=parseFloat(r[3]),r[4]&&(e.ambient=parseFloat(r[4])),r[5]&&(e.temperature=parseFloat(r[5])),e):t}var ft=40,vt={baudRate:115200,write:`t
`,codec:ds,sps:ft},us=Object.assign({},vt);us.sps=19;var ui={sps:ft,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:!0,notifyCallback:void 0,codec:ds,sps:ft}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:!0,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0}}},androidWebBLE:"o"},hs=Object.assign({},vt);hs.sps=19;function ps(s){let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={red:new Array(32),ir:new Array(32),max_dietemp:O.get2sCompliment(e[193],8)+.0625*e[194],timestamp:Date.now()},r=0;for(;r<32;){let i=r*6;r%2===0?(t.ir[r]=(e[i+1]<<16|e[i+2]<<8|e[i+3])&524287,t.ir[r+1]=(e[i+4]<<16|e[i+5]<<8|e[i+6])&524287):(t.red[r-1]=(e[i+1]<<16|e[i+2]<<8|e[i+3])&524287,t.red[r]=(e[i+4]<<16|e[i+5]<<8|e[i+6])&524287),r++}return t}function gs(s){let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={ax:new Array(20),ay:new Array(20),az:new Array(20),gx:new Array(20),gy:new Array(20),gz:new Array(20),mpu_dietemp:(O.bytesToInt16(e[241],e[242])+521)/340+35,timestamp:Date.now()};for(let r=0;r<20;r++){let i=r*12;t.ax[r]=O.bytesToInt16(e[i+1],e[i+2]),t.ay[r]=O.bytesToInt16(e[i+3],e[i+4]),t.az[r]=O.bytesToInt16(e[i+5],e[i+6]),t.gx[r]=O.bytesToInt16(e[i+7],e[i+8]),t.gy[r]=O.bytesToInt16(e[i+9],e[i+10]),t.gz[r]=O.bytesToInt16(e[i+11],e[i+12])}return t}function hi(s){let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let r=0;r<7;r++){let i=r*26+1;if(!e[i+23])break;t[0][r]=O.bytesToUInt24(e[i],e[i+1],e[i+2]),t[1][r]=O.bytesToUInt24(e[i+3],e[i+4],e[i+5]),t[2][r]=O.bytesToUInt24(e[i+6],e[i+7],e[i+8]),t[3][r]=O.bytesToUInt24(e[i+9],e[i+10],e[i+11]),t[4][r]=O.bytesToUInt24(e[i+12],e[i+13],e[i+14]),t[5][r]=O.bytesToUInt24(e[i+15],e[i+16],e[i+17]),t[6][r]=O.bytesToUInt24(e[i+18],e[i+19],e[i+20]),t[7][r]=O.bytesToUInt24(e[i+21],e[i+22],e[i+23])}return t}var dt=250,pi={services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:!0,notifyCallback:void 0,codec:hi,sps:dt}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:!0}}},sps:dt},Q={nSec:10,sps:dt,units:"mV"},Mn={lines:{0:JSON.parse(JSON.stringify(Q)),1:JSON.parse(JSON.stringify(Q)),2:JSON.parse(JSON.stringify(Q)),3:JSON.parse(JSON.stringify(Q)),4:JSON.parse(JSON.stringify(Q)),5:JSON.parse(JSON.stringify(Q)),6:JSON.parse(JSON.stringify(Q)),7:JSON.parse(JSON.stringify(Q))}};var J={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function gi(s){let e={},t=0;for(;t<s.length;)if(J[s[t]]&&t+1+J[s[t]].byteLength<=s.length){let r=s.slice(t+1,t+1+J[s[t]].byteLength).buffer,i=O.struct(J[s[t]].format).unpack(r),n=J[s[t]].type;n==="unfilteredHEG"||n==="heg"?i=i[0]/256:(n==="POOR_SIGNAL"||n==="sampleNumber"||n==="debug0"||n==="debug1"||n==="debug2"||n==="debug3")&&(i=i[0]),e[J[s[t]].type]?Array.isArray(i)?e[J[s[t]].type].push(...i):e[J[s[t]].type].push(i):Array.isArray(i)?e[J[s[t]].type]=i:e[J[s[t]].type]=[i],t+=J[s[t]].byteLength+1}else t++;return e.timestamp=Date.now(),e}var yi={baudRate:38400,bufferSize:400,write:`protocol 3
`,buffering:{searchBytes:new Uint8Array([170,170])},codec:gi,sps:10.101};var bi=1013.25,ys=s=>{let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={temp:[],pressure:[],humidity:[],altitude:[]};for(let r=0;r<3;r++){let i=r*24,n=O.bytesToUInt32(e[0+i],e[1+i],e[2+i],e[3+i]),l=O.bytesToUInt32(e[4+i],e[5+i],e[6+i],e[7+i]);t.temp.push(n+l/Math.pow(10,Math.ceil(Math.log10(l))));let a=O.bytesToUInt32(e[8+i],e[9+i],e[10+i],e[11+i]),f=O.bytesToUInt32(e[12+i],e[13+i],e[14+i],e[15+i]);t.pressure.push(a+f/Math.pow(10,Math.ceil(Math.log10(f))));let u=O.bytesToUInt32(e[16+i],e[17+i],e[18+i],e[19+i]),h=O.bytesToUInt32(e[20+i],e[21+i],e[22+i],e[23+i]);t.humidity.push(u+h/Math.pow(10,Math.ceil(Math.log10(h)))),t.altitude.push(mi(t.pressure[r],t.temp[r]))}return t},_i=1/5.257,vi=1/.0065;function mi(s,e){return(Math.pow(bi/s,_i)-1)*(e+273.15)*vi}function wi(s){let e;s.getInt8?e=new Uint8Array(s.buffer):s.buffer?e=s:e=new Uint8Array(s);let t={};if(e[0]===2)Object.assign(t,xe(e.subarray(2)));else if(e[0]===3){let r=xe(e.subarray(2));Object.keys(r).forEach((i,n)=>{t[n+8]=r[i]})}else e[0]===4?Object.assign(t,gs(e.subarray(2))):e[0]===5?Object.assign(t,ps(e.subarray(2))):e[0]===6?Object.assign(t,ys(e.subarray(2))):Object.assign(t,xe(e));return t}var ki={baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:wi,sps:250},Si={sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:xe,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:ps,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:gs,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:xe,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:ys,sps:3.33}}}},ee={nSec:10,sps:250,units:"mV"},Fn={lines:{0:JSON.parse(JSON.stringify(ee)),1:JSON.parse(JSON.stringify(ee)),2:JSON.parse(JSON.stringify(ee)),3:JSON.parse(JSON.stringify(ee)),4:JSON.parse(JSON.stringify(ee)),5:JSON.parse(JSON.stringify(ee)),6:JSON.parse(JSON.stringify(ee)),7:JSON.parse(JSON.stringify(ee))},generateNewLines:!0,cleanGeneration:!1},xi=32,Ai=24,Oi=1.2,M={sps:250,useDCBlock:!1,useBandpass:!1,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:.96*1e3*Oi/(xi*(Math.pow(2,Ai)-1))},Dn={0:JSON.parse(JSON.stringify(M)),1:JSON.parse(JSON.stringify(M)),2:JSON.parse(JSON.stringify(M)),3:JSON.parse(JSON.stringify(M)),4:JSON.parse(JSON.stringify(M)),5:JSON.parse(JSON.stringify(M)),6:JSON.parse(JSON.stringify(M)),7:JSON.parse(JSON.stringify(M)),8:JSON.parse(JSON.stringify(M)),9:JSON.parse(JSON.stringify(M)),10:JSON.parse(JSON.stringify(M)),11:JSON.parse(JSON.stringify(M)),12:JSON.parse(JSON.stringify(M)),13:JSON.parse(JSON.stringify(M)),14:JSON.parse(JSON.stringify(M)),15:JSON.parse(JSON.stringify(M))},Ci=new TextDecoder;function bs(s){let e={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0},t=Ci.decode(s),r=t.split("|");return r.length>=5?(e.timestamp=Date.now(),e.left_red=parseInt(r[1]),e.left_infrared=parseInt(r[2]),e.left_heg=parseFloat(r[3]),e.center_red=parseInt(r[4]),e.center_infrared=parseInt(r[5]),e.center_heg=parseFloat(r[6]),e.right_red=parseInt(r[7]),e.right_infrared=parseInt(r[8]),e.right_heg=parseFloat(r[9]),e):t}var Ni={baudRate:115200,codec:bs},Ei={services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:!0,notifyCallback:void 0,codec:bs}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:!0,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0}}},androidWebBLE:"o"};function Ti(s){let e={red:s.getInt32(2),ir:s.getInt32(6),ir2:s.getInt32(10),timestamp:Date.now()};return e.heg=e.red/(.5*(e.ir+e.ir2)),e}var Wt=40,Pi={namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:!0,notifyCallback:void 0,codec:Ti,sps:Wt}}},sps:Wt};function ji(s){let e={sred:s.getInt32(2),sir:s.getInt32(6),sir2:s.getInt32(10),timestamp:Date.now()};return e.sheg=e.sred/(.5*(e.sir+e.sir2)),e}function Li(s){let e={red:s.getInt32(2),ir:s.getInt32(6),ir2:s.getInt32(10),timestamp:Date.now()};return e.heg=e.sred/(.5*(e.ir+e.ir2)),e}var it=40,Ii={namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:!0,notifyCallback:void 0,codec:Li,sps:it},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:!0,notifyCallback:void 0,codec:ji,sps:it}}},sps:it};var Ie={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45},Rn={0:JSON.parse(JSON.stringify(Ie)),1:JSON.parse(JSON.stringify(Ie)),2:JSON.parse(JSON.stringify(Ie)),3:JSON.parse(JSON.stringify(Ie))},Be={nSec:10,sps:250,units:"mV"},Vn={lines:{0:JSON.parse(JSON.stringify(Be)),1:JSON.parse(JSON.stringify(Be)),2:JSON.parse(JSON.stringify(Be)),3:JSON.parse(JSON.stringify(Be)),ax:{nSec:10,sps:250,units:"mg"},ay:{nSec:10,sps:250,units:"mg"},az:{nSec:10,sps:250,units:"mg"}},generateNewLines:!0},we={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45},Jn={0:JSON.parse(JSON.stringify(we)),1:JSON.parse(JSON.stringify(we)),2:JSON.parse(JSON.stringify(we)),3:JSON.parse(JSON.stringify(we)),4:JSON.parse(JSON.stringify(we))};function Bi(s){return{hr:s.getInt8(1),timestamp:Date.now()}}var Mi={services:{heart_rate:{heart_rate_measurement:{notify:!0,notifyCallback:void 0,codec:Bi}}}},_s={sps:250,simulate:{0:{sps:250,freq:1,amplitude:1,offset:0},1:{sps:250,freq:10,amplitude:1,offset:0},2:{sps:250,freq:100,amplitude:.5,offset:.5},3:{sps:250,freq:25,amplitude:1,offset:0}},connect:(s={})=>new Promise(async(e,t)=>{let i={_id:`simulated${Math.floor(Math.random()*1e15)}`,settings:Object.assign(Object.assign({},_s),s)};i.settings.looping=!0;let n=50,l=Date.now(),a=()=>{if(i.settings.looping){let f={},u=Date.now(),h=u-l;for(let _ in i.settings.simulate){let b=Math.floor(i.settings.simulate[_].sps*h/1e3);f[_]=new Array(b).fill(0),f[_]=f[_].map((m,x)=>Math.sin(2*Math.PI*i.settings.simulate[_].freq*.001*(l+h*(x+1)/b))*i.settings.simulate[_].amplitude+i.settings.simulate[_].offset)}l=u,f.timestamp=l,i.settings.ondata(f),setTimeout(()=>{a()},n)}};a(),i.settings.onconnect&&i.settings.onconnect(i),e(i)}),codec:s=>s,disconnect:s=>{console.log(s),s.settings.looping=!1,s.settings.ondisconnect(s)},onconnect:s=>{console.log("simulator connected!",s)},ondisconnect:s=>{console.log("simulator disconnected!",s)},ondata:s=>{}},Fi={BLE:{nrf5x:Si,hegduino:ui,hegduinoV1:hs,cognixionONE:pi,statechanger:Ei,blueberry:Pi,blueberry2:Ii,heart_rate:Mi},USB:{nrf5x:ki,freeEEG32:oi,freeEEG32_optical:li,freeEEG128:ii,hegduino:vt,hegduinoV1:us,cyton:Ut,cyton_daisy:si,peanut:yi,statechanger:Ni,cognixionONE:Ut},BLE_OTHER:{},USB_OTHER:{},OTHER:{simulator:_s}};var qn=new TextDecoder;var Me=new qe,Di=new kr({tree:{...Mr,...Rr}});function vs(s,e,t){t.devices||(t.devices=Fi);let r=t.devices[s][e];if(!r)return;t.workerUrl||(t.workerUrl=Jr),t.service||(t.service=Di);let i=t.service.addWorker({url:t.workerUrl});if(t.tree){for(let n in t.tree){let l={callback:"decodeAndParseDevice",worker:i};t.tree[n].__parent=t.tree[n].__parent?Object.assign(t.tree[n].__parent,l):l}t.service.setTree(t.tree)}if(s.includes("OTHER"))return new Promise(async(n,l)=>{r.ondata=u=>{i.run("decodeAndParseDevice",[u,s,e]).then(h=>{typeof t.ondecoded=="function"&&t.ondecoded(h)})},r.ondisconnect=()=>{if(t.service.terminate(i._id),t.tree)for(let u in t.tree)t.service.remove(u)};let a=await r.connect(r),f={workers:{streamworker:i},disconnect:()=>{if(r.disconnect(a),t.ondisconnect&&t.ondisconnect(f),t.tree)for(let u in t.tree)t.service.remove(u)},device:a,options:t,read:u=>{if(r.read)return new Promise((h,_)=>{h(r.read(r,u))})},write:u=>{if(r.write)return new Promise((h,_)=>{h(r.write(r,u))})},tree:t.tree};t.onconnect&&t.onconnect(f),n(f)}).catch(n=>{if(console.error(n),t.service.terminate(i._id),t.tree)for(let l in t.tree)t.service.remove(l)});if(s==="BLE"){for(let n in r.services)for(let l in r.services[n])if(typeof t.ondecoded=="function"){if(r.services?.[n]?.[l]?.notify){r.services[n][l].notifyCallback=a=>{i.run("decodeAndParseDevice",[a,s,e,n,l],[a.buffer]).then(t.ondecoded)};break}}else typeof t.ondecoded=="object"&&t.ondecoded[l]&&(r.services?.[n]?.[l]?.notify&&(r.services[n][l].notifyCallback=a=>{i.run("decodeAndParseDevice",[a,s,e,n,l],[a.buffer]).then(t.ondecoded[l])}),r.services?.[n]?.[l]?.read&&(r.services[l].readCallback=a=>{i.run("decodeAndParseDevice",[a,s,e,n,l],[a.buffer]).then(t.ondecoded[l])}));return new Promise((n,l)=>{Me.setup(r).then(a=>{let f={workers:{streamworker:i},options:t,device:a,disconnect:async()=>{if(await Me.disconnect(a.deviceId),t.ondisconnect&&t.ondisconnect(f),i.terminate(),t.tree)for(let u in t.tree)t.service.remove(u)},read:u=>Me.read(a.device,u.service,u.characteristic,u.ondata,u.timeout),write:u=>Me.write(a.device,u.service,u.characteristic,u.data,u.callback,u.timeout),tree:t.tree};t.onconnect&&t.onconnect(f),n(f)}).catch(a=>{if(console.error(a),i.terminate(),t.tree)for(let f in t.tree)t.service.remove(f);l(a)})})}else if(s==="USB"){let n=t.service.addWorker({url:t.workerUrl});n.worker.addEventListener("message",f=>{if(typeof f.data=="string"&&f.data.includes("disconnected")&&(t.service.terminate(n._id),t.service.terminate(i._id),t.tree))for(let u in t.tree)t.service.remove(u)}),n.post("setupSerial");let l=t.service.establishMessageChannel(i.worker,n.worker),a=new Se;return new Promise((f,u)=>{a.requestPort(r.usbVendorId,r.usbProductId).then(h=>{let _=h.getInfo();n.run("openPort",{baudRate:r.baudRate,usbVendorId:_.usbVendorId,usbProductId:_.usbProductId,bufferSize:r.bufferSize,buffering:r.buffering?r.buffering:void 0,frequency:r.frequency?r.frequency:void 0,pipeTo:{route:"decodeAndParseDevice",_id:l,extraArgs:[s,e]}}).then(b=>{r.write&&n.post("writeStream",[b._id,r.write]),typeof t.ondecoded=="function"&&i.subscribe("decodeAndParseDevice",t.ondecoded);let m={workers:{streamworker:i,serialworker:n},device:b,options:t,disconnect:()=>{n.post("closeStream",b._id),t.ondisconnect&&t.ondisconnect(m)},read:()=>new Promise((x,o)=>{let c;c=i.subscribe("decodeAndParseDevice",d=>{n.unsubscribe("decodeAndParseDevice",c),x(d)})}),write:x=>n.run("writeStream",[b._id,x]),tree:t.tree};t.onconnect&&t.onconnect(m),f(m)})}).catch(h=>{if(console.error(h),t.service.terminate(n._id),t.service.terminate(i._id),t.tree)for(let _ in t.tree)t.service.remove(_);u(h)})})}else return}var Ge={};fe(Ge,{default:()=>Ri});var Ri=s=>{console.log("HEG",s)};var Ce={};fe(Ce,{default:()=>Vi});var Vi=s=>{console.log("EEG",s)};var Ne={};fe(Ne,{default:()=>Ji});var Ji=s=>{console.log("EMG",s)};var Ee={};fe(Ee,{accelerometer:()=>Ui,default:()=>qi,gyroscope:()=>Wi});var qi=s=>{console.log("Generic",s)},Ui=s=>{console.log("Accelerometer",s)},Wi=s=>{console.log("Accelerometer",s)};var oe={};fe(oe,{altitude:()=>Yi,default:()=>Hi,humidity:()=>Xi,pressure:()=>zi,temperature:()=>Gi});var Hi=s=>{console.log("Environment",s)},Gi=s=>{console.log("Temperature",s)},zi=s=>{console.log("Pressure",s)},Yi=s=>{console.log("Altitude",s)},Xi=s=>{console.log("Humidity",s)};var Tt={};fe(Tt,{canvas:()=>Sn,default:()=>Cn,failed:()=>An,options:()=>kn,overlay:()=>xn,plot:()=>wn});var W=class{constructor(e,t,r,i){this.r=e,this.g=t,this.b=r,this.a=i}},Ye=class{constructor(){this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.loop=!1,this._vbuffer=0,this._coord=0,this.visible=!0,this.intensity=1,this.xy=new Float32Array([]),this.numPoints=0,this.color=new W(0,0,0,1),this.webglNumPoints=0}},le=class extends Ye{constructor(e,t){super(),this.currentIndex=0,this.webglNumPoints=t,this.numPoints=t,this.color=e,this.xy=new Float32Array(2*this.webglNumPoints)}setX(e,t){this.xy[e*2]=t}setY(e,t){this.xy[e*2+1]=t}getX(e){return this.xy[e*2]}getY(e){return this.xy[e*2+1]}lineSpaceX(e,t){for(let r=0;r<this.numPoints;r++)this.setX(r,e+t*r)}arrangeX(){this.lineSpaceX(-1,2/this.numPoints)}constY(e){for(let t=0;t<this.numPoints;t++)this.setY(t,e)}shiftAdd(e){let t=e.length;for(let r=0;r<this.numPoints-t;r++)this.setY(r,this.getY(r+t));for(let r=0;r<t;r++)this.setY(r+this.numPoints-t,e[r])}addArrayY(e){if(this.currentIndex+e.length<=this.numPoints)for(let t=0;t<e.length;t++)this.setY(this.currentIndex,e[t]),this.currentIndex++}replaceArrayY(e){if(e.length==this.numPoints)for(let t=0;t<this.numPoints;t++)this.setY(t,e[t])}};var ms=(s,e,t)=>{let r={x:0,y:0};return r.x=s.x+e.x*t,r.y=s.y+e.y*t,r},mt=s=>wt(-s.y,s.x),ze=(s,e)=>{let t=en(s,e);return t=ws(t),t},Zi=(s,e)=>{let t={x:0,y:0};return t.x=s.x+e.x,t.y=s.y+e.y,t},Qi=(s,e)=>s.x*e.x+s.y*e.y,ws=s=>{let e={x:0,y:0},t=s.x*s.x+s.y*s.y;return t>0&&(t=1/Math.sqrt(t),e.x=s.x*t,e.y=s.y*t),e},wt=(s,e)=>{let t={x:0,y:0};return t.x=s,t.y=e,t},en=(s,e)=>{let t={x:0,y:0};return t.x=s.x-e.x,t.y=s.y-e.y,t},tn=s=>{let e,t={x:0,y:0},r={x:0,y:0},i=[],n=(f,u)=>{i.push({vec2:f,miterLength:u})},l=f=>({x:s[f*2],y:s[f*2+1]});t=ze(l(1),l(0)),e=mt(t),n(e,1);let a=s.length/2;for(let f=1;f<a-1;f++){let u=l(f-1),h=l(f),_=l(f+1);t=ze(h,u),e=mt(t),r=ze(_,h);let b=sn(t,r),m=rn(t,b,1);n(b,m)}return t=ze(l(a-1),l(a-2)),e=mt(t),n(e,1),i},sn=(s,e)=>{let t=Zi(s,e);return t=ws(t),wt(-t.y,t.x)},rn=(s,e,t)=>{let r=wt(-s.y,s.x);return t/Qi(e,r)},_e=class extends Ye{constructor(e,t,r){super(),this.currentIndex=0,this._thicknessRequested=0,this._actualThickness=0,this.webglNumPoints=t*2,this.numPoints=t,this.color=e,this._thicknessRequested=r,this._linePoints=new Float32Array(t*2),this.xy=new Float32Array(2*this.webglNumPoints)}convertToTriPoints(){let e=this._actualThickness/2,t=tn(this._linePoints);for(let r=0;r<this.numPoints;r++){let i=this._linePoints[2*r],n=this._linePoints[2*r+1],l={x:i,y:n},a=ms(l,t[r].vec2,t[r].miterLength*e),f=ms(l,t[r].vec2,-t[r].miterLength*e);this.xy[r*4]=a.x,this.xy[r*4+1]=a.y,this.xy[r*4+2]=f.x,this.xy[r*4+3]=f.y}}setX(e,t){this._linePoints[e*2]=t}setY(e,t){this._linePoints[e*2+1]=t}lineSpaceX(e,t){for(let r=0;r<this.numPoints;r++)this.setX(r,e+t*r)}setThickness(e){this._thicknessRequested=e}getThickness(){return this._thicknessRequested}setActualThickness(e){this._actualThickness=e}},Xe=class{constructor(e,t){this.debug=!1,this.addLine=this.addDataLine,t==null?this.webgl=e.getContext("webgl",{antialias:!0,transparent:!1}):(this.webgl=e.getContext("webgl",{antialias:t.antialias,transparent:t.transparent,desynchronized:t.deSync,powerPerformance:t.powerPerformance,preserveDrawing:t.preserveDrawing}),this.debug=t.debug==null?!1:t.debug),this.log("canvas type is: "+e.constructor.name),this.log(`[webgl-plot]:width=${e.width}, height=${e.height}`),this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[],this.gScaleX=1,this.gScaleY=1,this.gXYratio=1,this.gOffsetX=0,this.gOffsetY=0,this.gLog10X=!1,this.gLog10Y=!1,this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.webgl.viewport(0,0,e.width,e.height),this._progLine=this.webgl.createProgram(),this.initThinLineProgram(),this.webgl.enable(this.webgl.BLEND),this.webgl.blendFunc(this.webgl.SRC_ALPHA,this.webgl.ONE_MINUS_SRC_ALPHA)}get linesData(){return this._linesData}get linesAux(){return this._linesAux}get thickLines(){return this._thickLines}get surfaces(){return this._surfaces}_drawLines(e){let t=this.webgl;e.forEach(r=>{if(r.visible){t.useProgram(this._progLine);let i=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(i,!1,new Float32Array([r.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,r.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let n=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(n,new Float32Array([r.offsetX+this.gOffsetX,r.offsetY+this.gOffsetY]));let l=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(l,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let a=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(a,[r.color.r,r.color.g,r.color.b,r.color.a]),t.bufferData(t.ARRAY_BUFFER,r.xy,t.STREAM_DRAW),t.drawArrays(r.loop?t.LINE_LOOP:t.LINE_STRIP,0,r.webglNumPoints)}})}_drawSurfaces(e){let t=this.webgl;e.forEach(r=>{if(r.visible){t.useProgram(this._progLine);let i=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(i,!1,new Float32Array([r.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,r.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let n=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(n,new Float32Array([r.offsetX+this.gOffsetX,r.offsetY+this.gOffsetY]));let l=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(l,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let a=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(a,[r.color.r,r.color.g,r.color.b,r.color.a]),t.bufferData(t.ARRAY_BUFFER,r.xy,t.STREAM_DRAW),t.drawArrays(t.TRIANGLE_STRIP,0,r.webglNumPoints)}})}_drawTriangles(e){let t=this.webgl;t.bufferData(t.ARRAY_BUFFER,e.xy,t.STREAM_DRAW),t.useProgram(this._progLine);let r=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(r,!1,new Float32Array([e.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,e.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let i=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(i,new Float32Array([e.offsetX+this.gOffsetX,e.offsetY+this.gOffsetY]));let n=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(n,new Int32Array([0,0]));let l=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(l,[e.color.r,e.color.g,e.color.b,e.color.a]),t.drawArrays(t.TRIANGLE_STRIP,0,e.xy.length/2)}_drawThickLines(){this._thickLines.forEach(e=>{if(e.visible){let t=Math.min(this.gScaleX,this.gScaleY);e.setActualThickness(e.getThickness()/t),e.convertToTriPoints(),this._drawTriangles(e)}})}update(){this.clear(),this.draw()}draw(){this._drawLines(this.linesData),this._drawLines(this.linesAux),this._drawThickLines(),this._drawSurfaces(this.surfaces)}clear(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}_addLine(e){e._vbuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,e._vbuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,e.xy,this.webgl.STREAM_DRAW),e._coord=this.webgl.getAttribLocation(this._progLine,"coordinates"),this.webgl.vertexAttribPointer(e._coord,2,this.webgl.FLOAT,!1,0,0),this.webgl.enableVertexAttribArray(e._coord)}addDataLine(e){this._addLine(e),this.linesData.push(e)}addAuxLine(e){this._addLine(e),this.linesAux.push(e)}addThickLine(e){this._addLine(e),this._thickLines.push(e)}addSurface(e){this._addLine(e),this.surfaces.push(e)}initThinLineProgram(){let e=`
      attribute vec2 coordinates;
      uniform mat2 uscale;
      uniform vec2 uoffset;
      uniform ivec2 is_log;

      void main(void) {
         float x = (is_log[0]==1) ? log(coordinates.x) : coordinates.x;
         float y = (is_log[1]==1) ? log(coordinates.y) : coordinates.y;
         vec2 line = vec2(x, y);
         gl_Position = vec4(uscale*line + uoffset, 0.0, 1.0);
      }`,t=this.webgl.createShader(this.webgl.VERTEX_SHADER);this.webgl.shaderSource(t,e),this.webgl.compileShader(t);let r=`
         precision mediump float;
         uniform highp vec4 uColor;
         void main(void) {
            gl_FragColor =  uColor;
         }`,i=this.webgl.createShader(this.webgl.FRAGMENT_SHADER);this.webgl.shaderSource(i,r),this.webgl.compileShader(i),this._progLine=this.webgl.createProgram(),this.webgl.attachShader(this._progLine,t),this.webgl.attachShader(this._progLine,i),this.webgl.linkProgram(this._progLine)}popDataLine(){this.linesData.pop()}removeAllLines(){this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[]}removeDataLines(){this._linesData=[]}removeAuxLines(){this._linesAux=[]}viewport(e,t,r,i){this.webgl.viewport(e,t,r,i)}log(e){this.debug&&console.log("[webgl-plot]:"+e)}};var P=class{constructor(){this.plots={}}initPlot(e,t){if(t||(t=new Xe(e.canvas,e.webglOptions)),!e._id)e._id=`plot${Math.floor(Math.random()*1e15)}`;else if(this.plots[e._id]){let u=this.plots[e._id].initial;if(e.lines){for(let h in e.lines)if(u.lines[h]&&Array.isArray(e.lines[h])){let _=e.lines[h];e.lines[h]=u.lines[h]}}e=Object.assign(u,e)}e.overlay&&(typeof e.overlay!="object"&&(e.overlay=document.createElement("canvas"),e.overlay.style.position="absolute",e.overlay.width=e.canvas.width,e.overlay.height=e.canvas.height,e.canvas.appendChild(e.overlay)),e.overlayCtx||(e.overlayCtx=e.overlay.getContext("2d"))),e.width&&(e.canvas.width=e.width,e.canvas.style&&(e.canvas.style.width=e.width+"px"),typeof e.overlay=="object"&&(e.overlay.width=e.width,e.overlay.style&&(e.overlay.style.width=e.width+"px"))),e.height&&(e.canvas.height=e.height,e.canvas.style&&(e.canvas.style.height=e.height+"px"),typeof e.overlay=="object"&&(e.overlay.height=e.height,e.overlay.style&&(e.overlay.style.height=e.height+"px"))),e.lines?.timestamp&&delete e.lines.timestamp;let r={};for(let u in e.lines)r[u]=Object.assign({},r[u]),"viewing"in e.lines[u]||(e.lines[u].viewing=!0),r[u].viewing=e.lines[u].viewing,r[u].sps=e.lines[u].sps,r[u].nSec=e.lines[u].nSec,r[u].nPoints=e.lines[u].nPoints,r[u].ymin=e.lines[u].ymin,r[u].ymax=e.lines[u].ymax,r[u].units=e.lines[u].units;let i={plot:t,settings:e,initial:Object.assign(Object.assign({},e),{lines:r}),anim:()=>{t.update()}};this.plots[e._id]=i;let n=0,l=0;Object.keys(e.lines).forEach(u=>{e.lines[u]?.viewing!==!1&&l++}),e.nLines=l;let a,f;typeof e.overlay=="object"&&(a=e.overlay,f=e.overlayCtx,f.clearRect(0,0,e.overlay.width,e.overlay.height),f.font=e.overlayFont?e.overlayFont:"1em Courier",f.fillStyle=e.overlayColor?e.overlayColor:"white");for(let u in e.lines){let h=e.lines[u];if(Array.isArray(h)&&(h={values:h},e.lines[u]=h),"viewing"in h||(h.viewing=!0),h.color)Array.isArray(h.color)&&(h.color=new W(...h.color));else{let o=P.HSLToRGB(360*(n/l)%360,100,50,1);i.initial.lines[u].color=[...o,1],h.color=new W(...o,1)}let _;if(h.nSec&&h.sps?_=Math.ceil(h.nSec*h.sps):h.nPoints?_=h.nPoints:h.points?_=h.points:e.linePoints?_=e.linePoints:h.values?_=h.values.length:_=1e3,h.points=_,e.lines[u].viewing===!1)continue;if((h.width||e.lineWidth)&&h.width!==0){let o=e.lineWidth;o||(o=h.width),h.width?h.line=new _e(h.color,_,h.width):e.lineWidth&&(h.line=new _e(h.color,_,e.lineWidth)),h.line.lineSpaceX(-1,2/h.line.numPoints)}else h.line=new le(h.color,_),h.line.arrangeX();h.values?.length===h.points?h.values.length!==_&&(h.interpolate?h.values.length>_?h.values=P.downsample(h.values,_):h.values.length<_&&(h.values=P.upsample(h.values,_)):h.values.length>h.points?h.values=h.values.slice(h.values.length-h.points):h.values=[...new Array(h.points-h.values.length).fill(0),...h.values]):Array.isArray(h.values)?h.values.length>_?h.values=h.values.slice(h.values.length-_):h.values.length<_&&(h.values=[...new Array(_-h.values.length).fill(0),...h.values]):h.values=new Array(h.points).fill(0);let b=h.ymin,m=h.ymax;if(b===m?(m=h.values.length<=1e5?Math.max(...h.values):1,b=h.values.length<=1e5?Math.min(...h.values):0):isNaN(m)&&(m=h.values.length<=1e5?Math.max(...h.values):1),isNaN(b)&&(b=h.values.length<=1e5?Math.min(...h.values):0),b>m){let o=b;m=b,b=o}let x=Math.abs(b);if(h.absmax=x>m?x:m,"autoscale"in h||(h.autoscale=!0),h.position||(h.position=e.nLines-n-1),h.autoscale?h.autoscale===2?("clamp"in h||(h.clamp=!0),h.scaled=P.autoscale(h.values,h.position,l,h.centerZero,b,m,h.clamp)):(h.scaled=h.values,h.line.scaleY=P.getYScalar(h.values,l,h.centerZero,b,m),h.line.offsetY=P.getYOffset(h.position,l,b,h.line.scaleY)):h.scaled=h.values,h.scaled.forEach((o,c)=>h.line.setY(c,o)),h.line instanceof _e?t.addThickLine(h.line):h.line instanceof le&&t.addDataLine(h.line),"xAxis"in h||(h.xAxis=!0),h.xAxis){h.xColor?Array.isArray(h.xColor)&&(h.xColor=new W(...h.xColor)):h.xColor=new W(1,1,1,.3);let o=new le(h.xColor,2),c=h.autoscale?(n+1)*2/l-1-1/l:0;o.constY(c),o.arrangeX(),o.xy[2]=1,h.x=o,t.addAuxLine(o)}if(l>1&&h.autoscale&&n!==l-1){e.dividerColor?Array.isArray(e.dividerColor)&&(e.dividerColor=new W(...e.dividerColor)):e.dividerColor=new W(1,1,1,1);let o=new le(e.dividerColor,2);o.constY(h.autoscale?(n+1)*2/l-1:1),o.arrangeX(),o.xy[2]=1,h.divider=o,t.addAuxLine(o)}if(typeof e.overlay=="object"&&(h.useOverlay||!("useOverlay"in h))){let o=e.nLines-h.position-1;f.fillText(u,20,a.height*(o+.2)/e.nLines),f.fillText(`${Math.floor(m)===m?m:m?.toFixed(5)} ${h.units?h.units:""}`,a.width-100,a.height*(o+.2)/e.nLines),f.fillText(`${Math.floor(b)===b?b:b?.toFixed(5)} ${h.units?h.units:""}`,a.width-100,a.height*(o+.9)/e.nLines)}n++}return requestAnimationFrame(i.anim),this.plots[e._id]}deinitPlot(e){return typeof e=="string"&&(e=this.plots[e]),e.plot.clear(),e.plot.removeAllLines(),!0}reinitPlot(e,t){if(typeof e=="string"){let r=e;e=this.plots[e],t._id||(t._id=r)}if(!!e.plot)return e.plot.clear(),e.plot.removeAllLines(),e.settings.overlayCtx&&e.settings.overlayCtx.clearRect(0,0,e.settings.overlay?.width,e.settings.overlay?.height),this.initPlot(t,e.plot)}getChartSettings(e,t){let r=this.plots[e];if(r){let i=Object.assign({},r.initial);for(let n in r.initial.lines)typeof r.initial.lines[n]?.ymax!="number"&&(i.lines[n].ymax=r.settings.lines[n]?.ymax),typeof r.initial.lines[n]?.ymin!="number"&&(i.lines[n].ymin=r.settings.lines[n]?.ymin),t&&(i.lines[n].values=r.settings.lines[n].values);return delete i.canvas,delete i.overlay,delete i.overlayCtx,i}}update(e,t,r=!0){if(typeof e=="string"&&(e=this.plots[e]),!e)return!1;if(t){let i=!1,n,l;typeof e.settings.overlay=="object"&&(n=e.settings.overlay,l=e.settings.overlayCtx,l.font=e.settings.overlayFont?e.settings.overlayFont:"1em Courier",l.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white");for(let a in t)if(e.settings.lines[a]&&e.settings.lines[a].line){if(e.settings.lines[a]?.viewing===!1)continue;let f=e.settings.lines[a];if(Array.isArray(t[a])&&f.values.length<1e5?(f.values.length===0&&(f.values.length=f.points?f.points:1e3),t[a].length===f.values.length?f.values=t[a]:P.circularBuffer(f.values,t[a])):typeof t[a]=="number"?(f.values.push(t[a]),f.values.shift()):t[a]?.values&&(f.values.length===0&&(f.values.length=f.points?f.points:1e3),t[a].values.length===f.values.length?f.values=t[a].values:P.circularBuffer(f.values,t[a].values)),f.values){f.values.length!==f.points&&(f.interpolate?f.values.length>f.points?f.values=P.downsample(f.values,f.points):f.scaled.length<f.points&&(f.values=P.upsample(f.values,f.points)):f.values.length>f.points?f.values.splice(0,f.values.length-f.points):f.values=new Array(f.points).fill(0).splice(f.points-f.values.length,0,f.values));let u=f.ymin,h=f.ymax;if(u===h?(h=f.values.length<=1e5?Math.max(...f.values):1,u=f.values.length<=1e5?Math.min(...f.values):0):isNaN(h)&&(h=f.values.length<=1e5?Math.max(...f.values):1),isNaN(u)&&(u=f.values.length<=1e5?Math.min(...f.values):0),u>h){let b=u;h=u,u=b}let _=Math.abs(u);if(f.absmax=_>h?_:h,f.autoscale?f.autoscale===2?f.scaled=P.autoscale(f.values,f.position,e.settings.nLines,f.centerZero,u,h,f.clamp):(f.scaled=f.values,f.line.scaleY=P.getYScalar(f.values,e.settings.nLines,f.centerZero,u,h),f.line.offsetY=P.getYOffset(f.position,e.settings.nLines,u,f.line.scaleY)):f.scaled=f.values,f.scaled.forEach((b,m)=>{!f.autoscale&&f.absmax>1?f.line.setY(m,b/f.absmax):f.line.setY(m,b)}),typeof e.settings.overlay=="object"&&(f.useOverlay||!("useOverlay"in f))){let b=e.settings.nLines-f.position-1;l.clearRect(0,n.height*b/e.settings.nLines,n.width,n.height/e.settings.nLines),l.fillText(a,20,n.height*(b+.2)/e.settings.nLines),l.fillText(`${Math.floor(h)===h?h:h?.toFixed(5)} ${f.units?f.units:""}`,n.width-100,n.height*(b+.2)/e.settings.nLines),l.fillText(`${Math.floor(u)===u?u:u?.toFixed(5)} ${f.units?f.units:""}`,n.width-100,n.height*(b+.9)/e.settings.nLines)}}}else e.settings.generateNewLines&&!a.includes("timestamp")&&(Array.isArray(t[a])&&(t[a]={values:t[a]}),!t[a].nSec&&!t[a].nPoints&&!e.settings.linePoints&&(t[a].nPoints=1e3),i=!0);if(i)return e.settings.cleanGeneration||Object.keys(e.initial.lines).forEach(a=>{t[a]?t[a]=Object.assign(e.initial.lines[a],t[a]):t[a]=e.initial.lines[a]}),this.reinitPlot(e,{_id:e.settings._id,lines:t}),!0}return r&&requestAnimationFrame(e.anim),!0}updateLine(e,t,r,i,n,l,a){return e.numPoints!==t.length&&(r?e.numPoints>t.length?t=P.downsample(t,e.numPoints):e.numPoints<t.length&&(t=P.upsample(t,e.numPoints)):t.length>e.numPoints?t=t.slice(t.length-e.numPoints):t=[...new Array(t.length).fill(0),...t]),i&&(t=P.autoscale(t,n,l,a)),t.forEach((f,u)=>e.setY(u,f)),!0}static autoscale(e,t=0,r=1,i=!1,n,l,a){if(e?.length===0)return e;let f=typeof l=="number"?l:e.length<=1e5?Math.max(...e):1,u=typeof n=="number"?n:e.length<=1e5?Math.min(...e):0,h=1/r,_=1;if(i){let b=Math.max(Math.abs(u),Math.abs(f));return b!==0&&(_=h/b),e.map(m=>(a&&(m<u&&(m=u),m>f&&(m=f)),m*_+(h*(t+1)*2-1-h)))}else return f===u?f!==0?_=h/f:u!==0&&(_=h/Math.abs(u)):_=h/(f-u),e.map(b=>(a&&(b<u&&(b=u),b>f&&(b=f)),2*((b-u)*_-1/(2*r))+(h*(t+1)*2-1-h)))}static getYScalar(e,t=1,r=!1,i,n){if(e?.length===0)return e;let l=typeof n=="number"?n:e.length<=1e5?Math.max(...e):1,a=typeof i=="number"?i:e.length<=1e5?Math.min(...e):0,f=1/t,u=1;if(r){let h=Math.max(Math.abs(a),Math.abs(l));return h!==0&&(u=f/h),2*u}else return l===a?l!==0?u=f/l:a!==0&&(u=f/Math.abs(a)):u=f/(l-a),2*u}static getYOffset(e=0,t=1,r=0,i=1){let n=1/t,l=n*(e+1)*2-1-n;return r>0&&(l-=r*i+1/t),l}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,t,r=1){if(e.length>t){let i=new Array(t),n=e.length/t,l=e.length-1,a=0,f=0;for(let u=n;u<e.length;u+=n){let h=Math.round(u);h>l&&(h=l);for(let _=a;_<h;_++)i[f]+=e[_];i[f]/=(h-a)*r,f++,a=h}return i}else return e}static upsample(e,t,r=1){var i=function(b,m,x){return(b+(m-b)*x)*r},n=new Array(t),l=(e.length-1)/(t-1);n[0]=e[0];for(var a=1;a<t-1;a++){var f=a*l,u=Math.floor(f),h=Math.ceil(f),_=f-u;n[a]=i(e[u],e[h],_)}return n[t-1]=e[e.length-1],n}static interpolate(e,t,r=1){return e.length>t?P.downsample(e,t,r):e.length<t?P.upsample(e,t,r):e}static HSLToRGB(e,t,r,i=255){t/=100,r/=100;let n=(1-Math.abs(2*r-1))*t,l=n*(1-Math.abs(e/60%2-1)),a=r-n/2,f=0,u=0,h=0;return 0<=e&&e<60?(f=n,u=l,h=0):60<=e&&e<120?(f=l,u=n,h=0):120<=e&&e<180?(f=0,u=n,h=l):180<=e&&e<240?(f=0,u=l,h=n):240<=e&&e<300?(f=l,u=0,h=n):300<=e&&e<360&&(f=n,u=0,h=l),f=(f+a)*i,u=(u+a)*i,h=(h+a)*i,[f,u,h]}static circularBuffer(e,t){if(t.length<e.length){let r=e.slice(t.length),i=e.length;e.splice(0,i,...r,...t)}else if(t.length>e.length){let r=e.length;e.splice(0,r,...t.slice(t.length-r))}else e.splice(0,e.length,...t);return e}static formatDataForCharts(e,t){if(Array.isArray(e)){if(Array.isArray(e[0])){let r={};if(e.forEach((i,n)=>{r[n]=i}),e=r,isNaN(e[0][0]))return}else if(t){if(e={[t]:e},isNaN(e[t][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(let r in e)if(typeof e[r]=="number"?e[r]=[e[r]]:e[r]?.values&&typeof e[r].values=="number"&&(e[r].values=[e[r].values]),isNaN(e[r][0]))return}else if(typeof e=="string"){let r;if(e.includes(`\r
`)){let i=e.split(`\r
`);e={},i.forEach((n,l)=>{n.includes("	")?r=n.split("	"):n.includes(",")?r=n.split(","):n.includes("|")&&(r=n.split("|")),r&&r.forEach((a,f)=>{if(a.includes(":")){let[u,h]=a.split(":"),_=parseFloat(h);isNaN(_)||(e[u]=[_])}else{let u=parseFloat(a);isNaN(u)||(e[f]=[u])}})})}else e.includes("	")?r=e.split("	"):e.includes(",")?r=e.split(","):e.includes("|")&&(r=e.split("|"));e={},r&&r.forEach((i,n)=>{if(i.includes(":")){let[l,a]=i.split(":"),f=parseFloat(a);isNaN(f)||(e[l]=[f])}else{let l=parseFloat(i);isNaN(l)||(e[n]=[l])}})}else typeof e=="number"&&(t?e={[t]:[e]}:e={0:[e]});return e}static padTime(e,t,r,i){let n=(e[0]-t)/r/i;return[...new Array(i-e.length).map((a,f)=>t+n*(f+1)),...e]}static interpolateForTime(e,t,r){return P.interpolate(e,Math.ceil(r*t))}};var nn=URL.createObjectURL(new Blob([String('(()=>{var mouseEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY"]);var wheelEventHandlerImpl=makeSendPropertiesHandler(["deltaX","deltaY"]);var keydownEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","keyCode"]);function wheelEventHandler(event,sendFn){event.preventDefault();wheelEventHandlerImpl(event,sendFn)}function preventDefaultHandler(event){event.preventDefault()}function copyProperties(src,properties,dst){for(const name of properties){dst[name]=src[name]}}function makeSendPropertiesHandler(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties(event,properties,data);sendFn(data)}}function touchEventHandler(event,sendFn){const touches=[];const data={type:event.type,touches};for(let i=0;i<event.touches.length;++i){const touch=event.touches[i];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var orbitKeys={"37":true,"38":true,"39":true,"40":true};function filteredKeydownEventHandler(event,sendFn){const{keyCode}=event;if(orbitKeys[keyCode]){event.preventDefault();keydownEventHandler(event,sendFn)}}var eventHandlers={contextmenu:preventDefaultHandler,mousedown:mouseEventHandler,mousemove:mouseEventHandler,mouseup:mouseEventHandler,pointerdown:mouseEventHandler,pointermove:mouseEventHandler,pointerup:mouseEventHandler,touchstart:touchEventHandler,touchmove:touchEventHandler,touchend:touchEventHandler,wheel:wheelEventHandler,keydown:filteredKeydownEventHandler};function initProxyElement(element,worker,id){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher=class{addEventListener(type,listener){if(this._listeners===void 0)this._listeners={};const listeners=this._listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this._listeners===void 0)return false;const listeners=this._listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this._listeners===void 0)return;const listeners=this._listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this._listeners===void 0)return;const listeners=this._listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i=0,l=array.length;i<l;i++){array[i].call(this,event)}event.target=null}}};function noop(){}var ElementProxyReceiver=class extends EventDispatcher{constructor(){super();this._listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop;data.stopPropagation=noop;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}};var ProxyManager=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=`proxyReceiver${Math.floor(Math.random()*1e15)}`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={}}};function makeProxy(id,elm){if(this.graph){if(!this.graph.ProxyManager)this.graph.ProxyManager=new ProxyManager;this.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent(data,id){if(this.graph){if(!this.graph.ProxyManager)this.graph.ProxyManager=new ProxyManager;if(this.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes={initProxyElement,makeProxy,handleProxyEvent};function Renderer(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas(worker,options,route)}else return setupCanvas(options)}function transferCanvas(worker,options,route){if(!options)return void 0;if(!options._id)options._id=`canvas${Math.floor(Math.random()*1e15)}`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this.graph)this.graph.run("initProxyElement",options.canvas,worker,options._id);else initProxyElement(options.canvas,worker,options._id);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let transfer=[offscreen];if(options.transfer){transfer.push(...options.transfer);delete options.transfer}worker.postMessage(message,transfer);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:props=>{worker.postMessage({route:"drawFrame",args:[props,options._id]})},update:props=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]})},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:newDrawProps=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]})},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw(settings,_id){let canvasopts;if(this.graph){if(_id)canvasopts=this.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.graph.CANVASES?.[settings._id];else canvasopts=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this.graph)this.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw}if(typeof settings.update==="string")settings.update=parseFunctionFromText(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update}if(typeof settings.init==="string")settings.init=parseFunctionFromText(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear}return settings._id}return void 0}function setupCanvas(options){if(this.graph){if(!this.graph.CANVASES)this.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=`canvas${Math.floor(Math.random()*1e15)}`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this.graph?.CANVASES[canvasOptions._id]){this.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw(canvasOptions)}else{canvasOptions.graph=this.graph;if(this.graph)this.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this.graph)this.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim(canvasOptions._id)};canvasOptions.start=draw=>{startAnim(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame(props,options._id)},update:props=>{updateCanvas(props,options._id)},clear:()=>{clearCanvas(options._id)},init:()=>{initCanvas(options._id)},stop:()=>{stopAnim(options._id)},start:()=>{startAnim(options._id)},set:newDrawProps=>{setDraw(newDrawProps,options._id)},terminate:()=>{stopAnim(options._id)}};return canvascontrols}}function drawFrame(props,_id){let canvasopts;if(this.graph){if(!_id)canvasopts=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]];else canvasopts=this.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas(_id){let canvasopts;if(this.graph){if(!_id)canvasopts=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]];else canvasopts=this.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas(_id){let canvasopts;if(this.graph){if(!_id)canvasopts=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]];else canvasopts=this.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas(input,_id){let canvasopts;if(this.graph){if(!_id)canvasopts=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]];else canvasopts=this.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps(props,_id){let canvasopts;if(this.graph){if(!_id)canvasopts=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]];else canvasopts=this.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim(_id,draw){let canvasopts;if(this.graph){if(!_id)canvasopts=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]];else canvasopts=this.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim(_id){let canvasopts;if(this.graph){if(!_id)canvasopts=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]];else canvasopts=this.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}var workerCanvasRoutes={...proxyElementWorkerRoutes,Renderer,transferCanvas,setupCanvas,setDraw,drawFrame,clearCanvas,initCanvas,updateCanvas,setProps,startAnim,stopAnim};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var ColorRGBA=class{constructor(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a}};var WebglBase=class{constructor(){this.scaleX=1;this.scaleY=1;this.offsetX=0;this.offsetY=0;this.loop=false;this._vbuffer=0;this._coord=0;this.visible=true;this.intensity=1;this.xy=new Float32Array([]);this.numPoints=0;this.color=new ColorRGBA(0,0,0,1);this.webglNumPoints=0}};var WebglLine=class extends WebglBase{constructor(c,numPoints){super();this.currentIndex=0;this.webglNumPoints=numPoints;this.numPoints=numPoints;this.color=c;this.xy=new Float32Array(2*this.webglNumPoints)}setX(index,x){this.xy[index*2]=x}setY(index,y){this.xy[index*2+1]=y}getX(index){return this.xy[index*2]}getY(index){return this.xy[index*2+1]}lineSpaceX(start,stepSize){for(let i=0;i<this.numPoints;i++){this.setX(i,start+stepSize*i)}}arrangeX(){this.lineSpaceX(-1,2/this.numPoints)}constY(c){for(let i=0;i<this.numPoints;i++){this.setY(i,c)}}shiftAdd(data){const shiftSize=data.length;for(let i=0;i<this.numPoints-shiftSize;i++){this.setY(i,this.getY(i+shiftSize))}for(let i=0;i<shiftSize;i++){this.setY(i+this.numPoints-shiftSize,data[i])}}addArrayY(yArray){if(this.currentIndex+yArray.length<=this.numPoints){for(let i=0;i<yArray.length;i++){this.setY(this.currentIndex,yArray[i]);this.currentIndex++}}}replaceArrayY(yArray){if(yArray.length==this.numPoints){for(let i=0;i<this.numPoints;i++){this.setY(i,yArray[i])}}}};var scaleAndAdd=(a,b,scale)=>{const out={x:0,y:0};out.x=a.x+b.x*scale;out.y=a.y+b.y*scale;return out};var normal=dir=>{const out=set(-dir.y,dir.x);return out};var direction=(a,b)=>{let out=subtract(a,b);out=normalize(out);return out};var add=(a,b)=>{const out={x:0,y:0};out.x=a.x+b.x;out.y=a.y+b.y;return out};var dot=(a,b)=>{return a.x*b.x+a.y*b.y};var normalize=a=>{const out={x:0,y:0};let len=a.x*a.x+a.y*a.y;if(len>0){len=1/Math.sqrt(len);out.x=a.x*len;out.y=a.y*len}return out};var set=(x,y)=>{const out={x:0,y:0};out.x=x;out.y=y;return out};var subtract=(a,b)=>{const out={x:0,y:0};out.x=a.x-b.x;out.y=a.y-b.y;return out};var PolyLine=lineXY=>{let curNormal;let lineA={x:0,y:0};let lineB={x:0,y:0};const out=[];const addNext=(normal2,length)=>{out.push({vec2:normal2,miterLength:length})};const getXY=index=>{return{x:lineXY[index*2],y:lineXY[index*2+1]}};lineA=direction(getXY(1),getXY(0));curNormal=normal(lineA);addNext(curNormal,1);const numPoints=lineXY.length/2;for(let i=1;i<numPoints-1;i++){const last=getXY(i-1);const cur=getXY(i);const next=getXY(i+1);lineA=direction(cur,last);curNormal=normal(lineA);lineB=direction(next,cur);const miter=computeMiter(lineA,lineB);const miterLen=computeMiterLen(lineA,miter,1);addNext(miter,miterLen)}lineA=direction(getXY(numPoints-1),getXY(numPoints-2));curNormal=normal(lineA);addNext(curNormal,1);return out};var computeMiter=(lineA,lineB)=>{let tangent=add(lineA,lineB);tangent=normalize(tangent);const miter=set(-tangent.y,tangent.x);return miter};var computeMiterLen=(lineA,miter,halfThick)=>{const tmp=set(-lineA.y,lineA.x);return halfThick/dot(miter,tmp)};var WebglThickLine=class extends WebglBase{constructor(c,numPoints,thickness){super();this.currentIndex=0;this._thicknessRequested=0;this._actualThickness=0;this.webglNumPoints=numPoints*2;this.numPoints=numPoints;this.color=c;this._thicknessRequested=thickness;this._linePoints=new Float32Array(numPoints*2);this.xy=new Float32Array(2*this.webglNumPoints)}convertToTriPoints(){const halfThick=this._actualThickness/2;const normals=PolyLine(this._linePoints);for(let i=0;i<this.numPoints;i++){const x=this._linePoints[2*i];const y=this._linePoints[2*i+1];const point={x,y};const top=scaleAndAdd(point,normals[i].vec2,normals[i].miterLength*halfThick);const bot=scaleAndAdd(point,normals[i].vec2,-normals[i].miterLength*halfThick);this.xy[i*4]=top.x;this.xy[i*4+1]=top.y;this.xy[i*4+2]=bot.x;this.xy[i*4+3]=bot.y}}setX(index,x){this._linePoints[index*2]=x}setY(index,y){this._linePoints[index*2+1]=y}lineSpaceX(start,stepSize){for(let i=0;i<this.numPoints;i++){this.setX(i,start+stepSize*i)}}setThickness(thickness){this._thicknessRequested=thickness}getThickness(){return this._thicknessRequested}setActualThickness(thickness){this._actualThickness=thickness}};var WebglPlot=class{constructor(canvas,options){this.debug=false;this.addLine=this.addDataLine;if(options==void 0){this.webgl=canvas.getContext("webgl",{antialias:true,transparent:false})}else{this.webgl=canvas.getContext("webgl",{antialias:options.antialias,transparent:options.transparent,desynchronized:options.deSync,powerPerformance:options.powerPerformance,preserveDrawing:options.preserveDrawing});this.debug=options.debug==void 0?false:options.debug}this.log("canvas type is: "+canvas.constructor.name);this.log(`[webgl-plot]:width=${canvas.width}, height=${canvas.height}`);this._linesData=[];this._linesAux=[];this._thickLines=[];this._surfaces=[];this.gScaleX=1;this.gScaleY=1;this.gXYratio=1;this.gOffsetX=0;this.gOffsetY=0;this.gLog10X=false;this.gLog10Y=false;this.webgl.clear(this.webgl.COLOR_BUFFER_BIT);this.webgl.viewport(0,0,canvas.width,canvas.height);this._progLine=this.webgl.createProgram();this.initThinLineProgram();this.webgl.enable(this.webgl.BLEND);this.webgl.blendFunc(this.webgl.SRC_ALPHA,this.webgl.ONE_MINUS_SRC_ALPHA)}get linesData(){return this._linesData}get linesAux(){return this._linesAux}get thickLines(){return this._thickLines}get surfaces(){return this._surfaces}_drawLines(lines){const webgl=this.webgl;lines.forEach(line=>{if(line.visible){webgl.useProgram(this._progLine);const uscale=webgl.getUniformLocation(this._progLine,"uscale");webgl.uniformMatrix2fv(uscale,false,new Float32Array([line.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,line.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));const uoffset=webgl.getUniformLocation(this._progLine,"uoffset");webgl.uniform2fv(uoffset,new Float32Array([line.offsetX+this.gOffsetX,line.offsetY+this.gOffsetY]));const isLog=webgl.getUniformLocation(this._progLine,"is_log");webgl.uniform2iv(isLog,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));const uColor=webgl.getUniformLocation(this._progLine,"uColor");webgl.uniform4fv(uColor,[line.color.r,line.color.g,line.color.b,line.color.a]);webgl.bufferData(webgl.ARRAY_BUFFER,line.xy,webgl.STREAM_DRAW);webgl.drawArrays(line.loop?webgl.LINE_LOOP:webgl.LINE_STRIP,0,line.webglNumPoints)}})}_drawSurfaces(squares){const webgl=this.webgl;squares.forEach(square=>{if(square.visible){webgl.useProgram(this._progLine);const uscale=webgl.getUniformLocation(this._progLine,"uscale");webgl.uniformMatrix2fv(uscale,false,new Float32Array([square.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,square.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));const uoffset=webgl.getUniformLocation(this._progLine,"uoffset");webgl.uniform2fv(uoffset,new Float32Array([square.offsetX+this.gOffsetX,square.offsetY+this.gOffsetY]));const isLog=webgl.getUniformLocation(this._progLine,"is_log");webgl.uniform2iv(isLog,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));const uColor=webgl.getUniformLocation(this._progLine,"uColor");webgl.uniform4fv(uColor,[square.color.r,square.color.g,square.color.b,square.color.a]);webgl.bufferData(webgl.ARRAY_BUFFER,square.xy,webgl.STREAM_DRAW);webgl.drawArrays(webgl.TRIANGLE_STRIP,0,square.webglNumPoints)}})}_drawTriangles(thickLine){const webgl=this.webgl;webgl.bufferData(webgl.ARRAY_BUFFER,thickLine.xy,webgl.STREAM_DRAW);webgl.useProgram(this._progLine);const uscale=webgl.getUniformLocation(this._progLine,"uscale");webgl.uniformMatrix2fv(uscale,false,new Float32Array([thickLine.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,thickLine.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));const uoffset=webgl.getUniformLocation(this._progLine,"uoffset");webgl.uniform2fv(uoffset,new Float32Array([thickLine.offsetX+this.gOffsetX,thickLine.offsetY+this.gOffsetY]));const isLog=webgl.getUniformLocation(this._progLine,"is_log");webgl.uniform2iv(isLog,new Int32Array([0,0]));const uColor=webgl.getUniformLocation(this._progLine,"uColor");webgl.uniform4fv(uColor,[thickLine.color.r,thickLine.color.g,thickLine.color.b,thickLine.color.a]);webgl.drawArrays(webgl.TRIANGLE_STRIP,0,thickLine.xy.length/2)}_drawThickLines(){this._thickLines.forEach(thickLine=>{if(thickLine.visible){const calibFactor=Math.min(this.gScaleX,this.gScaleY);thickLine.setActualThickness(thickLine.getThickness()/calibFactor);thickLine.convertToTriPoints();this._drawTriangles(thickLine)}})}update(){this.clear();this.draw()}draw(){this._drawLines(this.linesData);this._drawLines(this.linesAux);this._drawThickLines();this._drawSurfaces(this.surfaces)}clear(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}_addLine(line){line._vbuffer=this.webgl.createBuffer();this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,line._vbuffer);this.webgl.bufferData(this.webgl.ARRAY_BUFFER,line.xy,this.webgl.STREAM_DRAW);line._coord=this.webgl.getAttribLocation(this._progLine,"coordinates");this.webgl.vertexAttribPointer(line._coord,2,this.webgl.FLOAT,false,0,0);this.webgl.enableVertexAttribArray(line._coord)}addDataLine(line){this._addLine(line);this.linesData.push(line)}addAuxLine(line){this._addLine(line);this.linesAux.push(line)}addThickLine(thickLine){this._addLine(thickLine);this._thickLines.push(thickLine)}addSurface(surface){this._addLine(surface);this.surfaces.push(surface)}initThinLineProgram(){const vertCode=`\n      attribute vec2 coordinates;\n      uniform mat2 uscale;\n      uniform vec2 uoffset;\n      uniform ivec2 is_log;\n\n      void main(void) {\n         float x = (is_log[0]==1) ? log(coordinates.x) : coordinates.x;\n         float y = (is_log[1]==1) ? log(coordinates.y) : coordinates.y;\n         vec2 line = vec2(x, y);\n         gl_Position = vec4(uscale*line + uoffset, 0.0, 1.0);\n      }`;const vertShader=this.webgl.createShader(this.webgl.VERTEX_SHADER);this.webgl.shaderSource(vertShader,vertCode);this.webgl.compileShader(vertShader);const fragCode=`\n         precision mediump float;\n         uniform highp vec4 uColor;\n         void main(void) {\n            gl_FragColor =  uColor;\n         }`;const fragShader=this.webgl.createShader(this.webgl.FRAGMENT_SHADER);this.webgl.shaderSource(fragShader,fragCode);this.webgl.compileShader(fragShader);this._progLine=this.webgl.createProgram();this.webgl.attachShader(this._progLine,vertShader);this.webgl.attachShader(this._progLine,fragShader);this.webgl.linkProgram(this._progLine)}popDataLine(){this.linesData.pop()}removeAllLines(){this._linesData=[];this._linesAux=[];this._thickLines=[];this._surfaces=[]}removeDataLines(){this._linesData=[]}removeAuxLines(){this._linesAux=[]}viewport(a,b,c,d){this.webgl.viewport(a,b,c,d)}log(str){if(this.debug){console.log("[webgl-plot]:"+str)}}};var WebglLinePlotUtil=class{constructor(){this.plots={}}initPlot(settings,plot){if(!plot)plot=new WebglPlot(settings.canvas,settings.webglOptions);if(!settings._id){settings._id=`plot${Math.floor(Math.random()*1e15)}`}else if(this.plots[settings._id]){let oldsettings=this.plots[settings._id].initial;if(settings.lines)for(const key in settings.lines){if(oldsettings.lines[key]&&Array.isArray(settings.lines[key])){let newdata=settings.lines[key];settings.lines[key]=oldsettings.lines[key]}}settings=Object.assign(oldsettings,settings)}if(settings.overlay){if(typeof settings.overlay!=="object"){settings.overlay=document.createElement("canvas");settings.overlay.style.position="absolute";settings.overlay.width=settings.canvas.width;settings.overlay.height=settings.canvas.height;settings.canvas.appendChild(settings.overlay)}if(!settings.overlayCtx)settings.overlayCtx=settings.overlay.getContext("2d")}if(settings.width){settings.canvas.width=settings.width;if(settings.canvas.style)settings.canvas.style.width=settings.width+"px";if(typeof settings.overlay==="object"){settings.overlay.width=settings.width;if(settings.overlay.style)settings.overlay.style.width=settings.width+"px"}}if(settings.height){settings.canvas.height=settings.height;if(settings.canvas.style)settings.canvas.style.height=settings.height+"px";if(typeof settings.overlay==="object"){settings.overlay.height=settings.height;if(settings.overlay.style)settings.overlay.style.height=settings.height+"px"}}if(settings.lines?.timestamp)delete settings.lines.timestamp;let initialLns={};for(const key in settings.lines){initialLns[key]=Object.assign({},initialLns[key]);if(!("viewing"in settings.lines[key])){settings.lines[key].viewing=true}initialLns[key].viewing=settings.lines[key].viewing;initialLns[key].sps=settings.lines[key].sps;initialLns[key].nSec=settings.lines[key].nSec;initialLns[key].nPoints=settings.lines[key].nPoints;initialLns[key].ymin=settings.lines[key].ymin;initialLns[key].ymax=settings.lines[key].ymax;initialLns[key].units=settings.lines[key].units}let info={plot,settings,initial:Object.assign(Object.assign({},settings),{lines:initialLns}),anim:()=>{plot.update()}};this.plots[settings._id]=info;let i=0;let nLines=0;Object.keys(settings.lines).forEach(k=>{if(settings.lines[k]?.viewing!==false){nLines++}});settings.nLines=nLines;let canvas;let ctx;if(typeof settings.overlay==="object"){canvas=settings.overlay;ctx=settings.overlayCtx;ctx.clearRect(0,0,settings.overlay.width,settings.overlay.height);ctx.font=settings.overlayFont?settings.overlayFont:"1em Courier";ctx.fillStyle=settings.overlayColor?settings.overlayColor:"white"}for(const line in settings.lines){let s=settings.lines[line];if(Array.isArray(s)){s={values:s};settings.lines[line]=s}if(!("viewing"in s))s.viewing=true;if(s.color){if(Array.isArray(s.color)){s.color=new ColorRGBA(...s.color)}}else{let rgb=WebglLinePlotUtil.HSLToRGB(360*(i/nLines)%360,100,50,1);info.initial.lines[line].color=[...rgb,1];s.color=new ColorRGBA(...rgb,1)}let points;if(s.nSec&&s.sps){points=Math.ceil(s.nSec*s.sps)}else if(s.nPoints){points=s.nPoints}else if(s.points){points=s.points}else if(settings.linePoints){points=settings.linePoints}else if(s.values)points=s.values.length;else points=1e3;s.points=points;if(settings.lines[line].viewing===false){continue}if((s.width||settings.lineWidth)&&s.width!==0){let width=settings.lineWidth;if(!width)width=s.width;if(s.width)s.line=new WebglThickLine(s.color,points,s.width);else if(settings.lineWidth)s.line=new WebglThickLine(s.color,points,settings.lineWidth);s.line.lineSpaceX(-1,2/s.line.numPoints)}else{s.line=new WebglLine(s.color,points);s.line.arrangeX()}if(s.values?.length===s.points){if(s.values.length!==points){if(s.interpolate){if(s.values.length>points){s.values=WebglLinePlotUtil.downsample(s.values,points)}else if(s.values.length<points){s.values=WebglLinePlotUtil.upsample(s.values,points)}}else{if(s.values.length>s.points)s.values=s.values.slice(s.values.length-s.points);else s.values=[...new Array(s.points-s.values.length).fill(0),...s.values]}}}else if(Array.isArray(s.values)){if(s.values.length>points)s.values=s.values.slice(s.values.length-points);else if(s.values.length<points)s.values=[...new Array(points-s.values.length).fill(0),...s.values]}else s.values=new Array(s.points).fill(0);let min=s.ymin;let max=s.ymax;if(min===max){max=s.values.length<=1e5?Math.max(...s.values):1;min=s.values.length<=1e5?Math.min(...s.values):0}else if(isNaN(max)){max=s.values.length<=1e5?Math.max(...s.values):1}if(isNaN(min)){min=s.values.length<=1e5?Math.min(...s.values):0}if(min>max){let t=min;max=min;min=t}let abs=Math.abs(min);s.absmax=abs>max?abs:max;if(!("autoscale"in s))s.autoscale=true;if(!s.position)s.position=settings.nLines-i-1;if(s.autoscale){if(s.autoscale===2){if(!("clamp"in s))s.clamp=true;s.scaled=WebglLinePlotUtil.autoscale(s.values,s.position,nLines,s.centerZero,min,max,s.clamp)}else{s.scaled=s.values;s.line.scaleY=WebglLinePlotUtil.getYScalar(s.values,nLines,s.centerZero,min,max);s.line.offsetY=WebglLinePlotUtil.getYOffset(s.position,nLines,min,s.line.scaleY)}}else s.scaled=s.values;s.scaled.forEach((y,i2)=>s.line.setY(i2,y));if(s.line instanceof WebglThickLine)plot.addThickLine(s.line);else if(s.line instanceof WebglLine)plot.addDataLine(s.line);if(!("xAxis"in s))s.xAxis=true;if(s.xAxis){if(s.xColor){if(Array.isArray(s.xColor))s.xColor=new ColorRGBA(...s.xColor)}else s.xColor=new ColorRGBA(1,1,1,.3);let x=new WebglLine(s.xColor,2);let xHeight=s.autoscale?(i+1)*2/nLines-1-1/nLines:0;x.constY(xHeight);x.arrangeX();x.xy[2]=1;s.x=x;plot.addAuxLine(x)}if(nLines>1&&s.autoscale&&i!==nLines-1){if(settings.dividerColor){if(Array.isArray(settings.dividerColor))settings.dividerColor=new ColorRGBA(...settings.dividerColor)}else settings.dividerColor=new ColorRGBA(1,1,1,1);let divider=new WebglLine(settings.dividerColor,2);divider.constY(s.autoscale?(i+1)*2/nLines-1:1);divider.arrangeX();divider.xy[2]=1;s.divider=divider;plot.addAuxLine(divider)}if(typeof settings.overlay==="object"){if(s.useOverlay||!("useOverlay"in s)){let pos=settings.nLines-s.position-1;ctx.fillText(line,20,canvas.height*(pos+.2)/settings.nLines);ctx.fillText(`${Math.floor(max)===max?max:max?.toFixed(5)} ${s.units?s.units:""}`,canvas.width-100,canvas.height*(pos+.2)/settings.nLines);ctx.fillText(`${Math.floor(min)===min?min:min?.toFixed(5)} ${s.units?s.units:""}`,canvas.width-100,canvas.height*(pos+.9)/settings.nLines)}}i++}requestAnimationFrame(info.anim);return this.plots[settings._id]}deinitPlot(info){if(typeof info==="string")info=this.plots[info];info.plot.clear();info.plot.removeAllLines();return true}reinitPlot(info,settings){if(typeof info==="string"){let str=info;info=this.plots[info];if(!settings._id)settings._id=str}if(!info.plot)return void 0;info.plot.clear();info.plot.removeAllLines();if(info.settings.overlayCtx)info.settings.overlayCtx.clearRect(0,0,info.settings.overlay?.width,info.settings.overlay?.height);return this.initPlot(settings,info.plot)}getChartSettings(plotId,getValues){let info=this.plots[plotId];if(info){let settings=Object.assign({},info.initial);for(const l in info.initial.lines){if(typeof info.initial.lines[l]?.ymax!=="number"){settings.lines[l].ymax=info.settings.lines[l]?.ymax}if(typeof info.initial.lines[l]?.ymin!=="number"){settings.lines[l].ymin=info.settings.lines[l]?.ymin}if(getValues)settings.lines[l].values=info.settings.lines[l].values}delete settings.canvas;delete settings.overlay;delete settings.overlayCtx;return settings}return void 0}update(plotInfo,lines,draw=true){if(typeof plotInfo==="string")plotInfo=this.plots[plotInfo];if(!plotInfo)return false;if(lines){let regenerate=false;let canvas;let ctx;if(typeof plotInfo.settings.overlay==="object"){canvas=plotInfo.settings.overlay;ctx=plotInfo.settings.overlayCtx;ctx.font=plotInfo.settings.overlayFont?plotInfo.settings.overlayFont:"1em Courier";ctx.fillStyle=plotInfo.settings.overlayColor?plotInfo.settings.overlayColor:"white"}for(const line in lines){if(plotInfo.settings.lines[line]&&plotInfo.settings.lines[line].line){if(plotInfo.settings.lines[line]?.viewing===false)continue;let s=plotInfo.settings.lines[line];if(Array.isArray(lines[line])&&s.values.length<1e5){if(s.values.length===0)s.values.length=s.points?s.points:1e3;if(lines[line].length===s.values.length)s.values=lines[line];else WebglLinePlotUtil.circularBuffer(s.values,lines[line])}else if(typeof lines[line]==="number"){s.values.push(lines[line]);s.values.shift()}else if(lines[line]?.values){if(s.values.length===0)s.values.length=s.points?s.points:1e3;if(lines[line].values.length===s.values.length)s.values=lines[line].values;else{WebglLinePlotUtil.circularBuffer(s.values,lines[line].values)}}if(s.values){if(s.values.length!==s.points){if(s.interpolate){if(s.values.length>s.points){s.values=WebglLinePlotUtil.downsample(s.values,s.points)}else if(s.scaled.length<s.points){s.values=WebglLinePlotUtil.upsample(s.values,s.points)}}else{if(s.values.length>s.points)s.values.splice(0,s.values.length-s.points);else s.values=new Array(s.points).fill(0).splice(s.points-s.values.length,0,s.values)}}let min=s.ymin;let max=s.ymax;if(min===max){max=s.values.length<=1e5?Math.max(...s.values):1;min=s.values.length<=1e5?Math.min(...s.values):0}else if(isNaN(max)){max=s.values.length<=1e5?Math.max(...s.values):1}if(isNaN(min)){min=s.values.length<=1e5?Math.min(...s.values):0}if(min>max){let t=min;max=min;min=t}let abs=Math.abs(min);s.absmax=abs>max?abs:max;if(s.autoscale){if(s.autoscale===2)s.scaled=WebglLinePlotUtil.autoscale(s.values,s.position,plotInfo.settings.nLines,s.centerZero,min,max,s.clamp);else{s.scaled=s.values;s.line.scaleY=WebglLinePlotUtil.getYScalar(s.values,plotInfo.settings.nLines,s.centerZero,min,max);s.line.offsetY=WebglLinePlotUtil.getYOffset(s.position,plotInfo.settings.nLines,min,s.line.scaleY)}}else s.scaled=s.values;s.scaled.forEach((y,i)=>{if(!s.autoscale&&s.absmax>1){s.line.setY(i,y/s.absmax)}else s.line.setY(i,y)});if(typeof plotInfo.settings.overlay==="object"){if(s.useOverlay||!("useOverlay"in s)){let pos=plotInfo.settings.nLines-s.position-1;ctx.clearRect(0,canvas.height*pos/plotInfo.settings.nLines,canvas.width,canvas.height/plotInfo.settings.nLines);ctx.fillText(line,20,canvas.height*(pos+.2)/plotInfo.settings.nLines);ctx.fillText(`${Math.floor(max)===max?max:max?.toFixed(5)} ${s.units?s.units:""}`,canvas.width-100,canvas.height*(pos+.2)/plotInfo.settings.nLines);ctx.fillText(`${Math.floor(min)===min?min:min?.toFixed(5)} ${s.units?s.units:""}`,canvas.width-100,canvas.height*(pos+.9)/plotInfo.settings.nLines)}}}}else if(plotInfo.settings.generateNewLines&&!line.includes("timestamp")){if(Array.isArray(lines[line])){lines[line]={values:lines[line]}}if(!lines[line].nSec&&!lines[line].nPoints&&!plotInfo.settings.linePoints){lines[line].nPoints=1e3}regenerate=true}}if(regenerate){if(!plotInfo.settings.cleanGeneration){Object.keys(plotInfo.initial.lines).forEach(k=>{if(!lines[k])lines[k]=plotInfo.initial.lines[k];else{lines[k]=Object.assign(plotInfo.initial.lines[k],lines[k])}})}this.reinitPlot(plotInfo,{_id:plotInfo.settings._id,lines});return true}}if(draw)requestAnimationFrame(plotInfo.anim);return true}updateLine(line,values,interpolate,autoscale,autoscalePosition,nLines,centerZero){if(line.numPoints!==values.length){if(interpolate){if(line.numPoints>values.length){values=WebglLinePlotUtil.downsample(values,line.numPoints)}else if(line.numPoints<values.length){values=WebglLinePlotUtil.upsample(values,line.numPoints)}}else{if(values.length>line.numPoints)values=values.slice(values.length-line.numPoints);else values=[...new Array(values.length).fill(0),...values]}}if(autoscale){values=WebglLinePlotUtil.autoscale(values,autoscalePosition,nLines,centerZero)}values.forEach((y,i)=>line.setY(i,y));return true}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=typeof ymax==="number"?ymax:array.length<=1e5?Math.max(...array):1;let min=typeof ymin==="number"?ymin:array.length<=1e5?Math.min(...array):0;let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y=>{if(clamp){if(y<min)y=min;if(y>max)y=max}return y*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y=>{if(clamp){if(y<min)y=min;if(y>max)y=max}return 2*((y-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static getYScalar(array,nLines=1,centerZero=false,ymin,ymax){if(array?.length===0)return array;let max=typeof ymax==="number"?ymax:array.length<=1e5?Math.max(...array):1;let min=typeof ymin==="number"?ymin:array.length<=1e5?Math.min(...array):0;let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return 2*scalar}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return 2*scalar}}static getYOffset(lineIdx=0,nLines=1,min=0,scalar=1){let _lines=1/nLines;let offset=_lines*(lineIdx+1)*2-1-_lines;if(min>0)offset-=min*scalar+1/nLines;return offset}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i=incr;i<array.length;i+=incr){let rounded=Math.round(i);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i=1;i<fitCount-1;i++){var tmp=i*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return WebglLinePlotUtil.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return WebglLinePlotUtil.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x;b=0}else if(60<=h&&h<120){r=x;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x}else if(180<=h&&h<240){r=0;g=x;b=c}else if(240<=h&&h<300){r=x;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,...newEntries.slice(newEntries.length-len))}else{arr.splice(0,arr.length,...newEntries)}return arr}static formatDataForCharts(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d={};data.forEach((arr,i)=>{d[i]=arr});data=d;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(split)split.forEach((val,i)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(!isNaN(fl))data[key2]=[fl]}else{let fl=parseFloat(val);if(!isNaN(fl))data[i]=[fl]}})})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(split){split.forEach((val,i)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(!isNaN(fl))data[key2]=[fl]}else{let fl=parseFloat(val);if(!isNaN(fl))data[i]=[fl]}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i)=>lastValue+slopeIncr*(i+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return WebglLinePlotUtil.interpolate(data,Math.ceil(targetSPS*time))}};if(typeof WorkerGlobalScope!=="undefined"){globalThis.plotter=new WebglLinePlotUtil;const routes={...workerCanvasRoutes};self.onmessage=ev=>{if(ev.data.route){if(Array.isArray(ev.data.args)){routes[ev.data.route](...ev.data.args)}else routes[ev.data.route](ev.data.args)}}}var canvas_worker_default=self;})();\n')],{type:"text/javascript"})),kt=nn;var ve=Ot(["ctrlKey","metaKey","shiftKey","button","pointerType","clientX","clientY","pageX","pageY"]),an=Ot(["deltaX","deltaY"]),on=Ot(["ctrlKey","metaKey","shiftKey","keyCode"]);function ln(s,e){s.preventDefault(),an(s,e)}function cn(s){s.preventDefault()}function fn(s,e,t){for(let r of e)t[r]=s[r]}function Ot(s){return function(t,r){let i={type:t.type};fn(t,s,i),r(i)}}function St(s,e){let t=[],r={type:s.type,touches:t};for(let i=0;i<s.touches.length;++i){let n=s.touches[i];t.push({pageX:n.pageX,pageY:n.pageY})}e(r)}var dn={37:!0,38:!0,39:!0,40:!0};function un(s,e){let{keyCode:t}=s;dn[t]&&(s.preventDefault(),on(s,e))}var hn={contextmenu:cn,mousedown:ve,mousemove:ve,mouseup:ve,pointerdown:ve,pointermove:ve,pointerup:ve,touchstart:St,touchmove:St,touchend:St,wheel:ln,keydown:un};function Ct(s,e,t){t||(t="proxy"+Math.floor(Math.random()*1e15));let r=l=>{e.postMessage({route:"handleProxyEvent",args:[l,t]})},i=Object.entries(hn);for(let[l,a]of i)s.addEventListener(l,function(f){a(f,r)});let n=()=>{let l=s.getBoundingClientRect();r({type:"resize",left:l.left,top:l.top,width:s.clientWidth,height:s.clientHeight})};return n(),globalThis.addEventListener("resize",n),t}var xt=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let n=i.indexOf(t);n!==-1&&i.splice(n,1)}}dispatchEvent(e,t){if(this._listeners===void 0)return;let i=this._listeners[e.type];if(i!==void 0){t?e.target=t:e.target=this;let n=i.slice(0);for(let l=0,a=n.length;l<a;l++)n[l].call(this,e);e.target=null}}};function ks(){}var At=class extends xt{constructor(){super();this._listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height});this.handleEvent=t=>{t.type==="resize"&&(this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),t.preventDefault=ks,t.stopPropagation=ks,this.dispatchEvent(t,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}},me=class{constructor(){this.targets={};this.makeProxy=(e,t=void 0)=>{e||(e=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let r;this.targets[e]?r=this.targets[e]:(r=new At,this.targets[e]=r),typeof t=="object"&&(t.proxy=r,r.proxied=t,typeof WorkerGlobalScope<"u"&&(t.style=r.style),r.width&&(t.style.width=r.width+"px",t.clientWidth=r.width),r.height&&(t.style.height=r.height+"px",t.clientHeight=r.height),t.setPointerCapture=r.setPointerCapture.bind(r),t.releasePointerCapture=r.releasePointerCapture.bind(r),t.getBoundingClientRect=r.getBoundingClientRect.bind(r),t.addEventListener=r.addEventListener.bind(r),t.removeEventListener=r.removeEventListener.bind(r),t.handleEvent=r.handleEvent.bind(r),t.dispatchEvent=r.dispatchEvent.bind(r),t.focus=r.focus.bind(r))};this.getProxy=e=>this.targets[e];this.handleEvent=(e,t)=>{if(this.targets[t]||this.makeProxy(t),this.targets[t])return this.targets[t].handleEvent(e),!0};globalThis.document||(globalThis.document={})}};function pn(s,e){return this.graph?(this.graph.ProxyManager||(this.graph.ProxyManager=new me),this.graph.ProxyManager.makeProxy(s,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new me),globalThis.ProxyManager.makeProxy(s,e)),s}function gn(s,e){if(this.graph){if(this.graph.ProxyManager||(this.graph.ProxyManager=new me),this.graph.ProxyManager.handleEvent(s,e))return s}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new me),globalThis.ProxyManager.handleEvent(s,e))return s}var $e={initProxyElement:Ct,makeProxy:pn,handleProxyEvent:gn};function yn(s){if(s.worker){let e=s.worker,t=s.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete s.worker,delete s.route,Ss(e,s,t)}else return xs(s)}function Ss(s,e,t){if(!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let r=e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let i={route:t||"setupCanvas",args:{...e,canvas:r}};this.graph?this.graph.run("initProxyElement",e.canvas,s,e._id):Ct(e.canvas,s,e._id),e.draw&&(typeof e.draw=="function"?i.args.draw=e.draw.toString():i.args.draw=e.draw),e.update&&(typeof e.update=="function"?i.args.update=e.update.toString():i.args.update=e.update),e.init&&(typeof e.init=="function"?i.args.init=e.init.toString():i.args.init=e.init),e.clear&&(typeof e.clear=="function"?i.args.clear=e.clear.toString():i.args.clear=e.clear);let n=[r];return e.transfer&&(n.push(...e.transfer),delete e.transfer),s.postMessage(i,n),{_id:e._id,width:e.width,height:e.height,worker:s,draw:a=>{s.postMessage({route:"drawFrame",args:[a,e._id]})},update:a=>{s.postMessage({route:"updateCanvas",args:[a,e._id]})},clear:()=>{s.postMessage({route:"clearCanvas",args:e._id})},init:()=>{s.postMessage({route:"initCanvas",args:e._id})},stop:()=>{s.postMessage({route:"stopAnim",args:e._id})},start:()=>{s.postMessage({route:"startAnim",args:e._id})},set:a=>{s.postMessage({route:"setDraw",args:[a,e._id]})},terminate:()=>{s.terminate()}}}function Ke(s,e){let t;if(this.graph?e?t=this.graph.CANVASES?.[s._id]:s._id?t=this.graph.CANVASES?.[s._id]:t=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]:e||s._id?t=globalThis.CANVASES?.[s._id]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t)return s.canvas&&(t.canvas=s.canvas,this.graph?this.graph.run("makeProxy",t._id,t.canvas):$e.makeProxy(t._id,t.canvas)),typeof s.context=="string"?t.context=t.canvas.getContext(s.context):s.context&&(t.context=s.context),s.width&&(t.canvas.width=s.width),s.height&&(t.canvas.height=s.height),typeof s.draw=="string"&&(s.draw=G(s.draw)),typeof s.draw=="function"&&(t.draw=s.draw),typeof s.update=="string"&&(s.update=G(s.update)),typeof s.update=="function"&&(t.update=s.update),typeof s.init=="string"&&(s.init=G(s.init)),typeof s.init=="function"&&(t.init=s.init),typeof s.clear=="string"&&(s.clear=G(s.clear)),typeof s.clear=="function"&&(t.clear=s.clear),s._id}function xs(s){this.graph?this.graph.CANVASES||(this.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=s;if(s._id?e._id=s._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof s.context=="string"?e.context=s.canvas.getContext(s.context):e.context=s.context,"animating"in s?e.animating=s.animating:e.animating=!0,this.graph?.CANVASES[e._id])this.graph.run("setDraw",e);else if(globalThis.CANVASES?.[e._id])Ke(e);else if(e.graph=this.graph,this.graph?this.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,this.graph?this.graph.run("makeProxy",e._id,e.canvas):$e.makeProxy(e._id,e.canvas),s.width&&(e.canvas.width=s.width),s.height&&(e.canvas.height=s.height),typeof e.draw=="string"?e.draw=G(e.draw):typeof e.draw=="function"&&(e.draw=e.draw),typeof e.update=="string"?e.update=G(e.update):typeof e.update=="function"&&(e.update=e.update),typeof e.init=="string"?e.init=G(e.init):typeof e.init=="function"&&(e.init=e.init),typeof e.clear=="string"?e.clear=G(e.clear):typeof e.clear=="function"&&(e.clear=e.clear),typeof e.init=="function"&&e.init(e,e.canvas,e.context),e.stop=()=>{Ze(e._id)},e.start=t=>{Nt(e._id,t)},e.set=t=>{Ke(t,e._id)},typeof e.draw=="function"&&e.animating){let t=(r,i,n)=>{r.animating&&(r.draw(r,i,n),requestAnimationFrame(()=>{t(r,i,n)}))};t(e,e.canvas,e.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?e._id:{_id:s._id,width:s.width,height:s.height,draw:r=>{As(r,s._id)},update:r=>{Ns(r,s._id)},clear:()=>{Os(s._id)},init:()=>{Cs(s._id)},stop:()=>{Ze(s._id)},start:()=>{Nt(s._id)},set:r=>{Ke(r,s._id)},terminate:()=>{Ze(s._id)}}}function As(s,e){let t;if(this.graph?e?t=this.graph.CANVASES?.[e]:t=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]:e?t=globalThis.CANVASES?.[e]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t&&(s&&Object.assign(t,s),t.draw))return t.draw(t,t.canvas,t.context),e}function Os(s){let e;if(this.graph?s?e=this.graph.CANVASES?.[s]:e=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]:s?e=globalThis.CANVASES?.[s]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e?.clear)return e.clear(e,e.canvas,e.context),s}function Cs(s){let e;if(this.graph?s?e=this.graph.CANVASES?.[s]:e=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]:s?e=globalThis.CANVASES?.[s]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e?.init)return e.init(e,e.canvas,e.context),s}function Ns(s,e){let t;if(this.graph?e?t=this.graph.CANVASES?.[e]:t=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]:e?t=globalThis.CANVASES?.[e]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t?.update)return t.update(t,t.canvas,t.context,s),e}function bn(s,e){let t;if(this.graph?e?t=this.graph.CANVASES?.[e]:t=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]:e?t=globalThis.CANVASES?.[e]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t)return Object.assign(t,s),s.width&&(t.canvas.width=s.width),s.height&&(t.canvas.height=s.height),e}function Nt(s,e){let t;if(this.graph?s?t=this.graph.CANVASES?.[s]:t=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]:s?t=globalThis.CANVASES?.[s]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t.animating=!0,t&&e)return typeof e=="string"&&(e=G(e)),typeof e=="function"&&(t.draw=e),s;if(typeof t?.draw=="function"){let r=(i,n,l)=>{i.animating&&(i.draw(i,n,l),requestAnimationFrame(()=>{r(i,n,l)}))};return typeof t.clear=="function"&&t.clear(t,t.canvas,t.context),typeof t.init=="function"&&t.init(t,t.canvas,t.context),r(t,t.canvas,t.context),s}}function Ze(s){let e;if(this.graph?s?e=this.graph.CANVASES?.[s]:e=this.graph.CANVASES?.[Object.keys(this.graph.CANVASES)[0]]:s?e=globalThis.CANVASES?.[s]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e)return e.animating=!1,typeof e.clear=="function"&&e.clear(e,e.canvas,e.context),s}var Et={...$e,Renderer:yn,transferCanvas:Ss,setupCanvas:xs,setDraw:Ke,drawFrame:As,clearCanvas:Os,initCanvas:Cs,updateCanvas:Ns,setProps:bn,startAnim:Nt,stopAnim:Ze};function G(s=""){let e=l=>l.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),r=(l=>{let a=l.indexOf("=>")+1;return a<=0&&(a=l.indexOf("){")),a<=0&&(a=l.indexOf(") {")),l.slice(0,l.indexOf("{",a)+1)})(s),i=e(s),n;if(r.includes("function")){let l=r.split("(")[1].split(")")[0];n=new Function(l,i)}else if(r.substring(0,6)===i.substring(0,6)){let l=r.split("(")[1].split(")")[0];n=new Function(l,i.substring(i.indexOf("{")+1,i.length-1))}else try{n=(0,eval)(r+i+"}")}catch{}return n}globalThis.plotter=new P;var _n=(s,e,t)=>{globalThis.plotter.initPlot(s);let r=i=>{e.width=e.clientWidth,e.height=e.clientHeight,s.overlay.width=e.clientWidth,s.overlay.height=e.clientHeight,globalThis.plotter.plots[s._id].plot.webgl.viewport(0,0,e.width,e.height)};typeof window<"u"?window.addEventListener("resize",r):e.addEventListener("resize",r),setTimeout(()=>{r(e)},10)},vn=(s,e,t,r)=>{globalThis.plotter.update(s._id,r)},mn=(s,e,t)=>{globalThis.plotter.deinitPlot(s._id)},wn,kn,Sn,xn,An=!1;function On(s){let e=s.options;e.init=_n,e.update=vn,e.clear=mn,typeof s.overlay=="string"&&(s.overlay=document.querySelector(s.overlay)),typeof s.canvas=="string"&&(s.canvas=document.querySelector(s.canvas)),e.canvas=s.canvas,e.overlay=s.overlay;let t={...e};try{if(e.worker)try{if(typeof kt=="object"&&(e.worker=!1),e.worker===!0?e.worker=new Worker(kt):(typeof e.worker=="string"||e.worker instanceof Blob)&&(e.worker=new Worker(e.worker)),e.overlay){let r=e.overlay.transferControlToOffscreen();e.overlay=r,e.transfer=[e.overlay]}s.plot=Et.Renderer(e)}catch(r){t.worker=!1,console.warn("Could not create canvas with worker. Will try to use a standard canvas instead.",t,r)}s.plot||(s.plot=Et.Renderer(t))}catch(r){console.error("Could not create a plot using the current options",r),s.failed=!0}return s.plot}function Cn(s){this.failed||(this.plot||On(this),this.plot&&this.plot.update(s))}var re=document.createElement("canvas"),Te=document.createElement("canvas");re.style.backgroundColor="black";re.style.position="absolute";re.style.width="100%";re.style.height="100%";Te.style.position="absolute";Te.style.width=re.style.width;Te.style.height=re.style.height;document.body.appendChild(re);document.body.appendChild(Te);var R=1e3,Es=Object.assign(Object.assign({},Tt),{canvas:re,overlay:Te,options:{worker:!1,overlayFont:"10px Verdana",overlayColor:"orange",generateNewLines:!0,cleanGeneration:!1,lines:{},lineWidth:.004}});console.log("Plot: ",Es);var Nn=0;var Ts=()=>{let s=Date.now(),e=new Array(R).fill(0).map((f,u)=>Math.sin(2*Math.PI*5*(s/1e3+u/R))),t=new Array(R).fill(0).map((f,u)=>1+Math.sin(2*Math.PI*15*(s/1e3+u/R))),r=new Array(R).fill(0).map((f,u)=>2+.5*Math.sin(2*Math.PI*10*(s/1e3+u/R))),i=new Array(R).fill(0).map((f,u)=>.5*Math.sin(2*Math.PI*25*(s/1e3+u/R))),n=new Array(R).fill(0).map((f,u)=>.5*Math.sin(2*Math.PI*1*(s/1e3+u/R))),l=new Array(R).fill(0).map((f,u)=>.5*Math.sin(2*Math.PI*3*(s/1e3+u/R))),a={0:e,1:t,2:r,3:i,4:n,5:l};Es.default(a),Nn+=R,requestAnimationFrame(Ts)};setTimeout(()=>Ts());var Pt=document.createElement("button");Pt.innerText="Connect";Pt.onclick=()=>{vs("BLE","nrf5x",{ondecoded:{"0002cafe-b0ba-8bad-f00d-deadbeef0000":s=>{console.log(s),Ce.default(s),Ne.default(s)},"0003cafe-b0ba-8bad-f00d-deadbeef0000":s=>{console.log(s),Ge.default(s)},"0004cafe-b0ba-8bad-f00d-deadbeef0000":s=>{console.log(s),Ee.accelerometer({x:s.ax,y:s.ay,z:s.az,timestamp:s.timestamp}),Ee.gyroscope({x:s.gx,y:s.gy,timestamp:s.timestamp})},"0005cafe-b0ba-8bad-f00d-deadbeef0000":s=>{console.log(s),Ce.default(s),Ne.default(s)},"0006cafe-b0ba-8bad-f00d-deadbeef0000":s=>{console.log(s),oe.temperature(s),oe.pressure(s),oe.humidity(s),oe.altitude(s)}}})};document.body.insertAdjacentElement("beforeend",Pt);})();
/*! Capacitor: https://capacitorjs.com/ - MIT License */
